function cout(a,b){var c=document.getElementById("terminal_output");if((0!=b||DEBUG_MESSAGES)&&(-1!=b||DEBUG_WINDOWING)){var e=document.createElement("span");e.appendChild(document.createTextNode(a));switch(b){case -1:case 0:e.className="white";break;case 1:e.className="yellow";break;case 2:e.className="red"}c.appendChild(e);c.appendChild(document.createElement("br"));c.scrollTop=c.scrollHeight-c.clientHeight}}
function clear_terminal(){for(var a=document.getElementById("terminal_output");null!=a.firstChild;)a.removeChild(a.firstChild)};var toBase64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".split(""),fromBase64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";
function base64(a){try{var b=window.btoa(a)}catch(c){var b="",e=a.length;if(0<e){for(var f=[0,0,0],h=0,d=e%3;0<a.length%3;)a[a.length]=" ";for(;h<e;)f=[a.charCodeAt(h++)&255,a.charCodeAt(h++)&255,a.charCodeAt(h++)&255],b+=toBase64[f[0]>>2]+toBase64[(f[0]&3)<<4|f[1]>>4]+toBase64[(f[1]&15)<<2|f[2]>>6]+toBase64[f[2]&63];0<d&&(b[b.length-1]="=",2==d?(b[b.length-2]="=",b[b.length-3]=toBase64[(f[0]&3)<<4]):b[b.length-2]=toBase64[(f[1]&15)<<2])}}return b}
function base64_decode(a){try{var b=window.atob(a)}catch(c){var b="",e=a.length;if(3<e&&0==e%4){for(var f=[0,0,0,0],h=0;h<e;)f=[fromBase64.indexOf(a.charAt(h++)),fromBase64.indexOf(a.charAt(h++)),fromBase64.indexOf(a.charAt(h++)),fromBase64.indexOf(a.charAt(h++))],b+=String.fromCharCode(f[0]<<2|f[1]>>4)+String.fromCharCode((f[1]&15)<<4|f[2]>>2)+String.fromCharCode((f[2]&3)<<6|f[3]);64<=f[3]&&(b.length-=1,64<=f[2]&&(b.length-=1))}}return b}
function to_little_endian_dword(a){return to_little_endian_word(a)+String.fromCharCode(a>>16&255,a>>24&255)}function to_little_endian_word(a){return to_byte(a)+String.fromCharCode(a>>8&255)}function to_byte(a){return String.fromCharCode(a&255)}function arrayToBase64(a){for(var b="",c=a.length,e=0;e<c;++e)"number"==typeof a[e]&&(b+=String.fromCharCode(a[e]));return base64(b)}function base64ToArray(a){for(var a=base64_decode(a),b=[],c=a.length,e=0;e<c;)b.push(a.charCodeAt(e++)&255);return b};var swfobject=function(){function a(){if(!y){try{var a=m.getElementsByTagName("body")[0].appendChild(m.createElement("span"));a.parentNode.removeChild(a)}catch(b){return}y=!0;for(var a=G.length,c=0;c<a;c++)G[c]()}}function b(a){y?a():G[G.length]=a}function c(a){if(typeof t.addEventListener!=q)t.addEventListener("load",a,!1);else if(typeof m.addEventListener!=q)m.addEventListener("load",a,!1);else if(typeof t.attachEvent!=q){var b=t;b.attachEvent("onload",a);A[A.length]=[b,"onload",a]}else if("function"==
typeof t.onload){var c=t.onload;t.onload=function(){c();a()}}else t.onload=a}function e(){var a=w.length;if(0<a)for(var b=0;b<a;b++){var c=w[b].id,e=w[b].callbackFn,i={success:!1,id:c};if(0<k.pv[0]){var j=p(c);if(j)if(l(w[b].swfVersion)&&!(k.wk&&312>k.wk))z(c,!0),e&&(i.success=!0,i.ref=f(c),e(i));else if(w[b].expressInstall&&h()){i={};i.data=w[b].expressInstall;i.width=j.getAttribute("width")||"0";i.height=j.getAttribute("height")||"0";j.getAttribute("class")&&(i.styleclass=j.getAttribute("class"));
j.getAttribute("align")&&(i.align=j.getAttribute("align"));for(var m={},j=j.getElementsByTagName("param"),n=j.length,D=0;D<n;D++)"movie"!=j[D].getAttribute("name").toLowerCase()&&(m[j[D].getAttribute("name")]=j[D].getAttribute("value"));d(i,m,c,e)}else g(j),e&&e(i)}else if(z(c,!0),e){if((c=f(c))&&typeof c.SetVariable!=q)i.success=!0,i.ref=c;e(i)}}}function f(a){var b=null;if((a=p(a))&&"OBJECT"==a.nodeName)typeof a.SetVariable!=q?b=a:(a=a.getElementsByTagName(v)[0])&&(b=a);return b}function h(){return!H&&
l("6.0.65")&&(k.win||k.mac)&&!(k.wk&&312>k.wk)}function d(a,b,c,d){H=!0;L=d||null;O={success:!1,id:c};var e=p(c);if(e){"OBJECT"==e.nodeName?(E=i(e),I=null):(E=e,I=c);a.id=P;if(typeof a.width==q||!/%$/.test(a.width)&&310>parseInt(a.width,10))a.width="310";if(typeof a.height==q||!/%$/.test(a.height)&&137>parseInt(a.height,10))a.height="137";m.title=m.title.slice(0,47)+" - Flash Player Installation";d=k.ie&&k.win?"ActiveX":"PlugIn";d="MMredirectURL="+t.location.toString().replace(/&/g,"%26")+"&MMplayerType="+
d+"&MMdoctitle="+m.title;b.flashvars=typeof b.flashvars!=q?b.flashvars+("&"+d):d;k.ie&&(k.win&&4!=e.readyState)&&(d=m.createElement("div"),c+="SWFObjectNew",d.setAttribute("id",c),e.parentNode.insertBefore(d,e),e.style.display="none",function(){4==e.readyState?e.parentNode.removeChild(e):setTimeout(arguments.callee,10)}());j(a,b,c)}}function g(a){if(k.ie&&k.win&&4!=a.readyState){var b=m.createElement("div");a.parentNode.insertBefore(b,a);b.parentNode.replaceChild(i(a),b);a.style.display="none";(function(){4==
a.readyState?a.parentNode.removeChild(a):setTimeout(arguments.callee,10)})()}else a.parentNode.replaceChild(i(a),a)}function i(a){var b=m.createElement("div");if(k.win&&k.ie)b.innerHTML=a.innerHTML;else if(a=a.getElementsByTagName(v)[0])if(a=a.childNodes)for(var c=a.length,d=0;d<c;d++)!(1==a[d].nodeType&&"PARAM"==a[d].nodeName)&&8!=a[d].nodeType&&b.appendChild(a[d].cloneNode(!0));return b}function j(a,b,c){var d,e=p(c);if(k.wk&&312>k.wk)return d;if(e)if(typeof a.id==q&&(a.id=c),k.ie&&k.win){var f=
"",g;for(g in a)a[g]!=Object.prototype[g]&&("data"==g.toLowerCase()?b.movie=a[g]:"styleclass"==g.toLowerCase()?f+=' class="'+a[g]+'"':"classid"!=g.toLowerCase()&&(f+=" "+g+'="'+a[g]+'"'));g="";for(var h in b)b[h]!=Object.prototype[h]&&(g+='<param name="'+h+'" value="'+b[h]+'" />');e.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+f+">"+g+"</object>";J[J.length]=a.id;d=p(a.id)}else{h=m.createElement(v);h.setAttribute("type",K);for(var i in a)a[i]!=Object.prototype[i]&&("styleclass"==
i.toLowerCase()?h.setAttribute("class",a[i]):"classid"!=i.toLowerCase()&&h.setAttribute(i,a[i]));for(f in b)b[f]!=Object.prototype[f]&&"movie"!=f.toLowerCase()&&(a=h,g=f,i=b[f],c=m.createElement("param"),c.setAttribute("name",g),c.setAttribute("value",i),a.appendChild(c));e.parentNode.replaceChild(h,e);d=h}return d}function n(a){var b=p(a);b&&"OBJECT"==b.nodeName&&(k.ie&&k.win?(b.style.display="none",function(){if(4==b.readyState){var c=p(a);if(c){for(var d in c)"function"==typeof c[d]&&(c[d]=null);
c.parentNode.removeChild(c)}}else setTimeout(arguments.callee,10)}()):b.parentNode.removeChild(b))}function p(a){var b=null;try{b=m.getElementById(a)}catch(c){}return b}function l(a){var b=k.pv,a=a.split(".");a[0]=parseInt(a[0],10);a[1]=parseInt(a[1],10)||0;a[2]=parseInt(a[2],10)||0;return b[0]>a[0]||b[0]==a[0]&&b[1]>a[1]||b[0]==a[0]&&b[1]==a[1]&&b[2]>=a[2]?!0:!1}function r(a,b,c,d){if(!k.ie||!k.mac){var e=m.getElementsByTagName("head")[0];if(e){c=c&&"string"==typeof c?c:"screen";d&&(M=u=null);if(!u||
M!=c)d=m.createElement("style"),d.setAttribute("type","text/css"),d.setAttribute("media",c),u=e.appendChild(d),k.ie&&(k.win&&typeof m.styleSheets!=q&&0<m.styleSheets.length)&&(u=m.styleSheets[m.styleSheets.length-1]),M=c;k.ie&&k.win?u&&typeof u.addRule==v&&u.addRule(a,b):u&&typeof m.createTextNode!=q&&u.appendChild(m.createTextNode(a+" {"+b+"}"))}}}function z(a,b){if(Q){var c=b?"visible":"hidden";y&&p(a)?p(a).style.visibility=c:r("#"+a,"visibility:"+c)}}function R(a){return null!=/[\\\"<>\.;]/.exec(a)&&
typeof encodeURIComponent!=q?encodeURIComponent(a):a}var q="undefined",v="object",K="application/x-shockwave-flash",P="SWFObjectExprInst",t=window,m=document,x=navigator,S=!1,G=[function(){if(S){var a=m.getElementsByTagName("body")[0],b=m.createElement(v);b.setAttribute("type",K);var c=a.appendChild(b);if(c){var d=0;(function(){if(typeof c.GetVariable!=q){var f=c.GetVariable("$version");f&&(f=f.split(" ")[1].split(","),k.pv=[parseInt(f[0],10),parseInt(f[1],10),parseInt(f[2],10)])}else if(10>d){d++;
setTimeout(arguments.callee,10);return}a.removeChild(b);c=null;e()})()}else e()}else e()}],w=[],J=[],A=[],E,I,L,O,y=!1,H=!1,u,M,Q=!0,k,U=typeof m.getElementById!=q&&typeof m.getElementsByTagName!=q&&typeof m.createElement!=q,B=x.userAgent.toLowerCase(),C=x.platform.toLowerCase(),V=C?/win/.test(C):/win/.test(B),C=C?/mac/.test(C):/mac/.test(B),B=/webkit/.test(B)?parseFloat(B.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,N=!+"\v1",F=[0,0,0],s=null;if(typeof x.plugins!=q&&typeof x.plugins["Shockwave Flash"]==
v){if((s=x.plugins["Shockwave Flash"].description)&&!(typeof x.mimeTypes!=q&&x.mimeTypes[K]&&!x.mimeTypes[K].enabledPlugin))S=!0,N=!1,s=s.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),F[0]=parseInt(s.replace(/^(.*)\..*$/,"$1"),10),F[1]=parseInt(s.replace(/^.*\.(.*)\s.*$/,"$1"),10),F[2]=/[a-zA-Z]/.test(s)?parseInt(s.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}else if(typeof t.ActiveXObject!=q)try{var T=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");if(T&&(s=T.GetVariable("$version")))N=!0,s=s.split(" ")[1].split(","),
F=[parseInt(s[0],10),parseInt(s[1],10),parseInt(s[2],10)]}catch(W){}k={w3:U,pv:F,wk:B,ie:N,win:V,mac:C};k.w3&&((typeof m.readyState!=q&&"complete"==m.readyState||typeof m.readyState==q&&(m.getElementsByTagName("body")[0]||m.body))&&a(),y||(typeof m.addEventListener!=q&&m.addEventListener("DOMContentLoaded",a,!1),k.ie&&k.win&&(m.attachEvent("onreadystatechange",function(){"complete"==m.readyState&&(m.detachEvent("onreadystatechange",arguments.callee),a())}),t==top&&function(){if(!y){try{m.documentElement.doScroll("left")}catch(b){setTimeout(arguments.callee,
0);return}a()}}()),k.wk&&function(){y||(/loaded|complete/.test(m.readyState)?a():setTimeout(arguments.callee,0))}(),c(a)));k.ie&&k.win&&window.attachEvent("onunload",function(){for(var a=A.length,b=0;b<a;b++)A[b][0].detachEvent(A[b][1],A[b][2]);a=J.length;for(b=0;b<a;b++)n(J[b]);for(var c in k)k[c]=null;k=null;for(var d in swfobject)swfobject[d]=null;swfobject=null});return{registerObject:function(a,b,c,d){if(k.w3&&a&&b){var e={};e.id=a;e.swfVersion=b;e.expressInstall=c;e.callbackFn=d;w[w.length]=
e;z(a,!1)}else d&&d({success:!1,id:a})},getObjectById:function(a){if(k.w3)return f(a)},embedSWF:function(a,c,e,f,g,i,m,n,p,r){var s={success:!1,id:c};k.w3&&!(k.wk&&312>k.wk)&&a&&c&&e&&f&&g?(z(c,!1),b(function(){e+="";f+="";var b={};if(p&&typeof p===v)for(var k in p)b[k]=p[k];b.data=a;b.width=e;b.height=f;k={};if(n&&typeof n===v)for(var t in n)k[t]=n[t];if(m&&typeof m===v)for(var u in m)k.flashvars=typeof k.flashvars!=q?k.flashvars+("&"+u+"="+m[u]):u+"="+m[u];if(l(g))t=j(b,k,c),b.id==c&&z(c,!0),s.success=
!0,s.ref=t;else{if(i&&h()){b.data=i;d(b,k,c,r);return}z(c,!0)}r&&r(s)})):r&&r(s)},switchOffAutoHideShow:function(){Q=!1},ua:k,getFlashPlayerVersion:function(){return{major:k.pv[0],minor:k.pv[1],release:k.pv[2]}},hasFlashPlayerVersion:l,createSWF:function(a,b,c){if(k.w3)return j(a,b,c)},showExpressInstall:function(a,b,c,e){k.w3&&h()&&d(a,b,c,e)},removeSWF:function(a){k.w3&&n(a)},createCSS:function(a,b,c,d){k.w3&&r(a,b,c,d)},addDomLoadEvent:b,addLoadEvent:c,getQueryParamValue:function(a){var b=m.location.search||
m.location.hash;if(b){/\?/.test(b)&&(b=b.split("?")[1]);if(null==a)return R(b);for(var b=b.split("&"),c=0;c<b.length;c++)if(b[c].substring(0,b[c].indexOf("="))==a)return R(b[c].substring(b[c].indexOf("=")+1))}return""},expressInstallCallback:function(){if(H){var a=p(P);a&&E&&(a.parentNode.replaceChild(E,a),I&&(z(I,!0),k.ie&&k.win&&(E.style.display="block")),L&&L(O));H=!1}}}}();function Resampler(a,b,c,e,f){this.fromSampleRate=a;this.toSampleRate=b;this.channels=c|0;this.outputBufferSize=e;this.noReturn=!!f;this.initialize()}
Resampler.prototype.initialize=function(){if(0<this.fromSampleRate&&0<this.toSampleRate&&0<this.channels)this.fromSampleRate==this.toSampleRate?(this.resampler=this.bypassResampler,this.ratioWeight=1):(this.fromSampleRate<this.toSampleRate?(this.compileLinearInterpolationFunction(),this.lastWeight=1):(this.compileMultiTapFunction(),this.tailExists=!1,this.lastWeight=0),this.ratioWeight=this.fromSampleRate/this.toSampleRate,this.initializeBuffers());else throw Error("Invalid settings specified for the resampler.");
};
Resampler.prototype.compileLinearInterpolationFunction=function(){for(var a="var bufferLength = buffer.length;\tvar outLength = this.outputBufferSize;\tif ((bufferLength % "+this.channels+") == 0) {\t\tif (bufferLength > 0) {\t\t\tvar ratioWeight = this.ratioWeight;\t\t\tvar weight = this.lastWeight;\t\t\tvar firstWeight = 0;\t\t\tvar secondWeight = 0;\t\t\tvar sourceOffset = 0;\t\t\tvar outputOffset = 0;\t\t\tvar outputBuffer = this.outputBuffer;\t\t\tfor (; weight < 1; weight += ratioWeight) {\t\t\t\tsecondWeight = weight % 1;\t\t\t\tfirstWeight = 1 - secondWeight;",b=
0;b<this.channels;++b)a+="outputBuffer[outputOffset++] = (this.lastOutput["+b+"] * firstWeight) + (buffer["+b+"] * secondWeight);";a+="}\t\t\tweight -= 1;\t\t\tfor (bufferLength -= "+this.channels+", sourceOffset = Math.floor(weight) * "+this.channels+"; outputOffset < outLength && sourceOffset < bufferLength;) {\t\t\t\tsecondWeight = weight % 1;\t\t\t\tfirstWeight = 1 - secondWeight;";for(b=0;b<this.channels;++b)a+="outputBuffer[outputOffset++] = (buffer[sourceOffset"+(0<b?" + "+b:"")+"] * firstWeight) + (buffer[sourceOffset + "+
(this.channels+b)+"] * secondWeight);";a+="weight += ratioWeight;\t\t\t\tsourceOffset = Math.floor(weight) * "+this.channels+";\t\t\t}";for(b=0;b<this.channels;++b)a+="this.lastOutput["+b+"] = buffer[sourceOffset++];";this.resampler=Function("buffer",a+'this.lastWeight = weight % 1;\t\t\treturn this.bufferSlice(outputOffset);\t\t}\t\telse {\t\t\treturn (this.noReturn) ? 0 : [];\t\t}\t}\telse {\t\tthrow(new Error("Buffer was of incorrect sample length."));\t}')};
Resampler.prototype.compileMultiTapFunction=function(){for(var a="var bufferLength = buffer.length;\tvar outLength = this.outputBufferSize;\tif ((bufferLength % "+this.channels+") == 0) {\t\tif (bufferLength > 0) {\t\t\tvar ratioWeight = this.ratioWeight;\t\t\tvar weight = 0;",b=0;b<this.channels;++b)a+="var output"+b+" = 0;";a+="var actualPosition = 0;\t\t\tvar amountToNext = 0;\t\t\tvar alreadyProcessedTail = !this.tailExists;\t\t\tthis.tailExists = false;\t\t\tvar outputBuffer = this.outputBuffer;\t\t\tvar outputOffset = 0;\t\t\tvar currentPosition = 0;\t\t\tdo {\t\t\t\tif (alreadyProcessedTail) {\t\t\t\t\tweight = ratioWeight;";
for(b=0;b<this.channels;++b)a+="output"+b+" = 0;";a+="}\t\t\t\telse {\t\t\t\t\tweight = this.lastWeight;";for(b=0;b<this.channels;++b)a+="output"+b+" = this.lastOutput["+b+"];";a+="alreadyProcessedTail = true;\t\t\t\t}\t\t\t\twhile (weight > 0 && actualPosition < bufferLength) {\t\t\t\t\tamountToNext = 1 + actualPosition - currentPosition;\t\t\t\t\tif (weight >= amountToNext) {";for(b=0;b<this.channels;++b)a+="output"+b+" += buffer[actualPosition++] * amountToNext;";a+="currentPosition = actualPosition;\t\t\t\t\t\tweight -= amountToNext;\t\t\t\t\t}\t\t\t\t\telse {";
for(b=0;b<this.channels;++b)a+="output"+b+" += buffer[actualPosition"+(0<b?" + "+b:"")+"] * weight;";a+="currentPosition += weight;\t\t\t\t\t\tweight = 0;\t\t\t\t\t\tbreak;\t\t\t\t\t}\t\t\t\t}\t\t\t\tif (weight == 0) {";for(b=0;b<this.channels;++b)a+="outputBuffer[outputOffset++] = output"+b+" / ratioWeight;";a+="}\t\t\t\telse {\t\t\t\t\tthis.lastWeight = weight;";for(b=0;b<this.channels;++b)a+="this.lastOutput["+b+"] = output"+b+";";this.resampler=Function("buffer",a+'this.tailExists = true;\t\t\t\t\tbreak;\t\t\t\t}\t\t\t} while (actualPosition < bufferLength && outputOffset < outLength);\t\t\treturn this.bufferSlice(outputOffset);\t\t}\t\telse {\t\t\treturn (this.noReturn) ? 0 : [];\t\t}\t}\telse {\t\tthrow(new Error("Buffer was of incorrect sample length."));\t}')};
Resampler.prototype.bypassResampler=function(a){return this.noReturn?(this.outputBuffer=a,a.length):a};Resampler.prototype.bufferSlice=function(a){if(this.noReturn)return a;try{return this.outputBuffer.subarray(0,a)}catch(b){try{return this.outputBuffer.length=a,this.outputBuffer}catch(c){return this.outputBuffer.slice(0,a)}}};
Resampler.prototype.initializeBuffers=function(){try{this.outputBuffer=new Float32Array(this.outputBufferSize),this.lastOutput=new Float32Array(this.channels)}catch(a){this.outputBuffer=[],this.lastOutput=[]}};var XAudioJSscriptsHandle=document.getElementsByTagName("script"),XAudioJSsourceHandle=XAudioJSscriptsHandle[XAudioJSscriptsHandle.length-1].src;
function XAudioServer(a,b,c,e,f,h,d){XAudioJSChannelsAllocated=Math.max(a,1);this.XAudioJSSampleRate=Math.abs(b);XAudioJSMinBufferSize=c>=XAudioJSSamplesPerCallback*XAudioJSChannelsAllocated&&c<e?c&-XAudioJSChannelsAllocated:XAudioJSSamplesPerCallback*XAudioJSChannelsAllocated;XAudioJSMaxBufferSize=Math.floor(e)>XAudioJSMinBufferSize+XAudioJSChannelsAllocated?e&-XAudioJSChannelsAllocated:XAudioJSMinBufferSize*XAudioJSChannelsAllocated;this.underRunCallback="function"==typeof f?f:function(){};XAudioJSVolume=
0<=h&&1>=h?h:1;this.failureCallback="function"==typeof d?d:function(){throw Error("XAudioJS has encountered a fatal error.");};this.initializeAudio()}XAudioServer.prototype.MOZWriteAudioNoCallback=function(a){this.samplesAlreadyWritten+=this.audioHandleMoz.mozWriteAudio(a)};XAudioServer.prototype.callbackBasedWriteAudioNoCallback=function(a){for(var b=a.length,c=0;c<b&&XAudioJSAudioBufferSize<XAudioJSMaxBufferSize;)XAudioJSAudioContextSampleBuffer[XAudioJSAudioBufferSize++]=a[c++]};
XAudioServer.prototype.writeAudio=function(a){switch(this.audioType){case 0:this.MOZWriteAudioNoCallback(a);this.MOZExecuteCallback();break;case 2:this.checkFlashInit();case 1:case 3:this.callbackBasedWriteAudioNoCallback(a);this.callbackBasedExecuteCallback();break;default:this.failureCallback()}};
XAudioServer.prototype.writeAudioNoCallback=function(a){switch(this.audioType){case 0:this.MOZWriteAudioNoCallback(a);break;case 2:this.checkFlashInit();case 1:case 3:this.callbackBasedWriteAudioNoCallback(a);break;default:this.failureCallback()}};
XAudioServer.prototype.remainingBuffer=function(){switch(this.audioType){case 0:return this.samplesAlreadyWritten-this.audioHandleMoz.mozCurrentSampleOffset();case 2:this.checkFlashInit();case 1:case 3:return Math.floor(XAudioJSResampledSamplesLeft()*XAudioJSResampleControl.ratioWeight/XAudioJSChannelsAllocated)*XAudioJSChannelsAllocated+XAudioJSAudioBufferSize;default:return this.failureCallback(),null}};
XAudioServer.prototype.MOZExecuteCallback=function(){var a=XAudioJSMinBufferSize-this.remainingBuffer();0<a&&this.MOZWriteAudioNoCallback(this.underRunCallback(a))};XAudioServer.prototype.callbackBasedExecuteCallback=function(){var a=XAudioJSMinBufferSize-this.remainingBuffer();0<a&&this.callbackBasedWriteAudioNoCallback(this.underRunCallback(a))};
XAudioServer.prototype.executeCallback=function(){switch(this.audioType){case 0:this.MOZExecuteCallback();break;case 2:this.checkFlashInit();case 1:case 3:this.callbackBasedExecuteCallback();break;default:this.failureCallback()}};XAudioServer.prototype.initializeAudio=function(){try{this.initializeWebAudio()}catch(a){try{this.initializeMozAudio()}catch(b){try{this.initializeMediaStream()}catch(c){try{this.initializeFlashAudio()}catch(e){this.audioType=-1,this.failureCallback()}}}}};
XAudioServer.prototype.initializeMediaStream=function(){this.audioHandleMediaStream=new Audio;this.resetCallbackAPIAudioBuffer(XAudioJSMediaStreamSampleRate);XAudioJSMediaStreamWorker&&XAudioJSMediaStreamWorker.terminate();XAudioJSMediaStreamWorker=new Worker(XAudioJSsourceHandle.substring(0,XAudioJSsourceHandle.length-3)+"MediaStreamWorker.js");this.audioHandleMediaStreamProcessing=new ProcessedMediaStream(XAudioJSMediaStreamWorker,XAudioJSMediaStreamSampleRate,XAudioJSChannelsAllocated);this.audioHandleMediaStream.src=
this.audioHandleMediaStreamProcessing;this.audioHandleMediaStream.volume=XAudioJSVolume;XAudioJSMediaStreamWorker.onmessage=XAudioJSMediaStreamPushAudio;XAudioJSMediaStreamWorker.postMessage([1,XAudioJSResampleBufferSize,XAudioJSChannelsAllocated]);this.audioHandleMediaStream.play();this.audioType=3};
XAudioServer.prototype.initializeMozAudio=function(){this.audioHandleMoz=new Audio;this.audioHandleMoz.mozSetup(XAudioJSChannelsAllocated,this.XAudioJSSampleRate);this.audioHandleMoz.volume=XAudioJSVolume;this.audioType=this.samplesAlreadyWritten=0;if("MacIntel"!=navigator.platform&&"MacPPC"!=navigator.platform){var a=this.XAudioJSSampleRate*XAudioJSChannelsAllocated/10|0,a=a-a%XAudioJSChannelsAllocated;this.samplesAlreadyWritten-=a}};
XAudioServer.prototype.initializeWebAudio=function(){if(XAudioJSWebAudioLaunchedContext)XAudioJSWebAudioAudioNode&&XAudioJSWebAudioAudioNode.disconnect(0),XAudioJSWebAudioAudioNode=XAudioJSWebAudioContextHandle.createJavaScriptNode(XAudioJSSamplesPerCallback,1,XAudioJSChannelsAllocated),XAudioJSWebAudioAudioNode.onaudioprocess=XAudioJSWebAudioEvent,XAudioJSWebAudioAudioNode.connect(XAudioJSWebAudioContextHandle.destination),this.resetCallbackAPIAudioBuffer(XAudioJSWebAudioContextHandle.sampleRate),
this.audioType=1;else throw Error("");};
XAudioServer.prototype.initializeFlashAudio=function(){var a=document.getElementById("XAudioJS");this.flashInitialized=!1;this.resetCallbackAPIAudioBuffer(44100);switch(XAudioJSChannelsAllocated){case 1:XAudioJSFlashTransportEncoder=XAudioJSGenerateFlashMonoString;break;case 2:XAudioJSFlashTransportEncoder=XAudioJSGenerateFlashStereoString;break;default:XAudioJSFlashTransportEncoder=XAudioJSGenerateFlashSurroundString}if(null==a){this.audioHandleFlash=null;var b=this,a=document.createElement("div");
a.setAttribute("style","position: fixed; bottom: 0px; right: 0px; margin: 0px; padding: 0px; border: none; width: 8px; height: 8px; overflow: hidden; z-index: -1000; ");var c=document.createElement("div");c.setAttribute("style","position: static; border: none; width: 0px; height: 0px; visibility: hidden; margin: 8px; padding: 0px;");c.setAttribute("id","XAudioJS");a.appendChild(c);document.getElementsByTagName("body")[0].appendChild(a);swfobject.embedSWF(XAudioJSsourceHandle.substring(0,XAudioJSsourceHandle.length-
9)+"JS.swf","XAudioJS","8","8","9.0.0","",{},{allowscriptaccess:"always"},{style:"position: static; visibility: hidden; margin: 8px; padding: 0px; border: none"},function(a){a.success?(b.audioHandleFlash=a.ref,b.checkFlashInit()):(b.failureCallback(),b.audioType=-1)})}else this.audioHandleFlash=a,this.checkFlashInit();this.audioType=2};
XAudioServer.prototype.changeVolume=function(a){if(0<=a&&1>=a)switch(XAudioJSVolume=a,this.audioType){case 0:this.audioHandleMoz.volume=XAudioJSVolume;case 1:break;case 2:this.flashInitialized?this.audioHandleFlash.changeVolume(XAudioJSVolume):this.checkFlashInit();break;case 3:this.audioHandleMediaStream.volume=XAudioJSVolume;break;default:this.failureCallback()}};
XAudioServer.prototype.checkFlashInit=function(){if(!this.flashInitialized)try{this.audioHandleFlash&&this.audioHandleFlash.initialize&&(this.flashInitialized=!0,this.audioHandleFlash.initialize(XAudioJSChannelsAllocated,XAudioJSVolume))}catch(a){this.flashInitialized=!1}};
XAudioServer.prototype.resetCallbackAPIAudioBuffer=function(a){XAudioJSAudioContextSampleBuffer=this.getFloat32(XAudioJSMaxBufferSize);XAudioJSAudioBufferSize=XAudioJSResampleBufferEnd=XAudioJSResampleBufferStart=0;XAudioJSResampleBufferSize=Math.max(XAudioJSMaxBufferSize*Math.ceil(a/this.XAudioJSSampleRate)+XAudioJSChannelsAllocated,XAudioJSSamplesPerCallback*XAudioJSChannelsAllocated);XAudioJSResampleControl=new Resampler(this.XAudioJSSampleRate,a,XAudioJSChannelsAllocated,XAudioJSResampleBufferSize,
!0);XAudioJSResampledBuffer=this.getFloat32(XAudioJSResampleBufferSize)};XAudioServer.prototype.getFloat32=function(a){try{return new Float32Array(a)}catch(b){return[]}};function XAudioJSFlashAudioEvent(){XAudioJSResampleRefill();return XAudioJSFlashTransportEncoder()}
function XAudioJSGenerateFlashSurroundString(){var a=XAudioJSSamplesPerCallback<<1;XAudioJSBinaryString.length>a&&(XAudioJSBinaryString=[]);for(var b=a=0;b<XAudioJSSamplesPerCallback&&XAudioJSResampleBufferStart!=XAudioJSResampleBufferEnd;++b)XAudioJSBinaryString[a++]=String.fromCharCode((16383*Math.min(Math.max(XAudioJSResampledBuffer[XAudioJSResampleBufferStart++]+1,0),2)|0)+12288),XAudioJSBinaryString[a++]=String.fromCharCode((16383*Math.min(Math.max(XAudioJSResampledBuffer[XAudioJSResampleBufferStart++]+
1,0),2)|0)+12288),XAudioJSResampleBufferStart+=XAudioJSChannelsAllocated-2,XAudioJSResampleBufferStart==XAudioJSResampleBufferSize&&(XAudioJSResampleBufferStart=0);return XAudioJSBinaryString.join("")}
function XAudioJSGenerateFlashStereoString(){var a=XAudioJSSamplesPerCallback<<1;XAudioJSBinaryString.length>a&&(XAudioJSBinaryString=[]);for(var b=0;b<a&&XAudioJSResampleBufferStart!=XAudioJSResampleBufferEnd;)XAudioJSBinaryString[b++]=String.fromCharCode((16383*Math.min(Math.max(XAudioJSResampledBuffer[XAudioJSResampleBufferStart++]+1,0),2)|0)+12288),XAudioJSBinaryString[b++]=String.fromCharCode((16383*Math.min(Math.max(XAudioJSResampledBuffer[XAudioJSResampleBufferStart++]+1,0),2)|0)+12288),XAudioJSResampleBufferStart==
XAudioJSResampleBufferSize&&(XAudioJSResampleBufferStart=0);return XAudioJSBinaryString.join("")}
function XAudioJSGenerateFlashMonoString(){XAudioJSBinaryString.length>XAudioJSSamplesPerCallback&&(XAudioJSBinaryString=[]);for(var a=0;a<XAudioJSSamplesPerCallback&&XAudioJSResampleBufferStart!=XAudioJSResampleBufferEnd;)XAudioJSBinaryString[a++]=String.fromCharCode((16383*Math.min(Math.max(XAudioJSResampledBuffer[XAudioJSResampleBufferStart++]+1,0),2)|0)+12288),XAudioJSResampleBufferStart==XAudioJSResampleBufferSize&&(XAudioJSResampleBufferStart=0);return XAudioJSBinaryString.join("")}
var XAudioJSWebAudioContextHandle=null,XAudioJSWebAudioAudioNode=null,XAudioJSWebAudioLaunchedContext=!1,XAudioJSAudioContextSampleBuffer=[],XAudioJSResampledBuffer=[],XAudioJSMinBufferSize=15E3,XAudioJSMaxBufferSize=25E3,XAudioJSChannelsAllocated=1,XAudioJSVolume=1,XAudioJSResampleControl=null,XAudioJSAudioBufferSize=0,XAudioJSResampleBufferStart=0,XAudioJSResampleBufferEnd=0,XAudioJSResampleBufferSize=0,XAudioJSMediaStreamWorker=null,XAudioJSMediaStreamBuffer=[],XAudioJSMediaStreamSampleRate=44100,
XAudioJSSamplesPerCallback=2048,XAudioJSFlashTransportEncoder=null,XAudioJSMediaStreamLengthAliasCounter=0,XAudioJSBinaryString=[];
function XAudioJSWebAudioEvent(a){for(var b=0,c=[];b<XAudioJSChannelsAllocated;++b)c[b]=a.outputBuffer.getChannelData(b);XAudioJSResampleRefill();for(a=0;a<XAudioJSSamplesPerCallback&&XAudioJSResampleBufferStart!=XAudioJSResampleBufferEnd;++a){for(b=0;b<XAudioJSChannelsAllocated;++b)c[b][a]=XAudioJSResampledBuffer[XAudioJSResampleBufferStart++]*XAudioJSVolume;XAudioJSResampleBufferStart==XAudioJSResampleBufferSize&&(XAudioJSResampleBufferStart=0)}for(;a<XAudioJSSamplesPerCallback;){for(b=0;b<XAudioJSChannelsAllocated;++b)c[b][a]=
0;++a}}
function XAudioJSMediaStreamPushAudio(a){var b=0,a=a.data,c=XAudioJSSamplesPerCallback*XAudioJSChannelsAllocated,e=a%XAudioJSSamplesPerCallback,a=a-(XAudioJSMediaStreamLengthAliasCounter-XAudioJSMediaStreamLengthAliasCounter%XAudioJSSamplesPerCallback)-e+XAudioJSSamplesPerCallback;XAudioJSMediaStreamLengthAliasCounter-=XAudioJSMediaStreamLengthAliasCounter-XAudioJSMediaStreamLengthAliasCounter%XAudioJSSamplesPerCallback;XAudioJSMediaStreamLengthAliasCounter+=XAudioJSSamplesPerCallback-e;XAudioJSMediaStreamBuffer.length!=c&&
(XAudioJSMediaStreamBuffer=new Float32Array(c));for(XAudioJSResampleRefill();b<a;){for(e=0;e<c&&XAudioJSResampleBufferStart!=XAudioJSResampleBufferEnd;)XAudioJSMediaStreamBuffer[e++]=XAudioJSResampledBuffer[XAudioJSResampleBufferStart++],XAudioJSResampleBufferStart==XAudioJSResampleBufferSize&&(XAudioJSResampleBufferStart=0);XAudioJSMediaStreamWorker.postMessage([0,XAudioJSMediaStreamBuffer]);b+=XAudioJSSamplesPerCallback}}
function XAudioJSResampleRefill(){if(0<XAudioJSAudioBufferSize){for(var a=XAudioJSResampleControl.resampler(XAudioJSGetBufferSamples()),b=XAudioJSResampleControl.outputBuffer,c=0;c<a;)XAudioJSResampledBuffer[XAudioJSResampleBufferEnd++]=b[c++],XAudioJSResampleBufferEnd==XAudioJSResampleBufferSize&&(XAudioJSResampleBufferEnd=0),XAudioJSResampleBufferStart==XAudioJSResampleBufferEnd&&(XAudioJSResampleBufferStart+=XAudioJSChannelsAllocated,XAudioJSResampleBufferStart==XAudioJSResampleBufferSize&&(XAudioJSResampleBufferStart=
0));XAudioJSAudioBufferSize=0}}function XAudioJSResampledSamplesLeft(){return(XAudioJSResampleBufferStart<=XAudioJSResampleBufferEnd?0:XAudioJSResampleBufferSize)+XAudioJSResampleBufferEnd-XAudioJSResampleBufferStart}
function XAudioJSGetBufferSamples(){try{return XAudioJSAudioContextSampleBuffer.subarray(0,XAudioJSAudioBufferSize)}catch(a){try{return XAudioJSAudioContextSampleBuffer.length=XAudioJSAudioBufferSize,XAudioJSAudioContextSampleBuffer}catch(b){return XAudioJSAudioContextSampleBuffer.slice(0,XAudioJSAudioBufferSize)}}}
(function(){if(!XAudioJSWebAudioLaunchedContext){try{XAudioJSWebAudioContextHandle=new webkitAudioContext}catch(a){try{XAudioJSWebAudioContextHandle=new AudioContext}catch(b){return}}XAudioJSWebAudioLaunchedContext=!0}})();var scripts=document.getElementsByTagName("script"),sourceOfWorker=scripts[scripts.length-1].src;
function Resize(a,b,c,e,f,h,d,g){this.widthOriginal=Math.abs(parseInt(a)||0);this.heightOriginal=Math.abs(parseInt(b)||0);this.targetWidth=Math.abs(parseInt(c)||0);this.targetHeight=Math.abs(parseInt(e)||0);this.colorChannels=f?4:3;this.interpolationPass=!!h;this.useWebWorker=!!d;this.resizeCallback="function"==typeof g?g:function(){};this.targetWidthMultipliedByChannels=this.targetWidth*this.colorChannels;this.originalWidthMultipliedByChannels=this.widthOriginal*this.colorChannels;this.originalHeightMultipliedByChannels=
this.heightOriginal*this.colorChannels;this.widthPassResultSize=this.targetWidthMultipliedByChannels*this.heightOriginal;this.finalResultSize=this.targetWidthMultipliedByChannels*this.targetHeight;this.initialize()}
Resize.prototype.initialize=function(){if(0<this.widthOriginal&&0<this.heightOriginal&&0<this.targetWidth&&0<this.targetHeight)this.useWebWorker&&(this.useWebWorker=this.widthOriginal!=this.targetWidth||this.heightOriginal!=this.targetHeight)&&this.configureWorker(),this.useWebWorker||this.configurePasses();else throw Error("Invalid settings specified for the resizer.");};
Resize.prototype.configureWorker=function(){try{var a=this;this.worker=new Worker(sourceOfWorker.substring(0,sourceOfWorker.length-3)+"Worker.js");this.worker.onmessage=function(b){a.heightBuffer=b.data;a.resizeCallback(a.heightBuffer)};this.worker.postMessage(["setup",this.widthOriginal,this.heightOriginal,this.targetWidth,this.targetHeight,this.colorChannels,this.interpolationPass])}catch(b){this.useWebWorker=!1}};
Resize.prototype.configurePasses=function(){this.widthOriginal==this.targetWidth?this.resizeWidth=this.bypassResizer:(this.ratioWeightWidthPass=this.widthOriginal/this.targetWidth,1>this.ratioWeightWidthPass&&this.interpolationPass?(this.initializeFirstPassBuffers(!0),this.resizeWidth=4==this.colorChannels?this.resizeWidthInterpolatedRGBA:this.resizeWidthInterpolatedRGB):(this.initializeFirstPassBuffers(!1),this.resizeWidth=4==this.colorChannels?this.resizeWidthRGBA:this.resizeWidthRGB));this.heightOriginal==
this.targetHeight?this.resizeHeight=this.bypassResizer:(this.ratioWeightHeightPass=this.heightOriginal/this.targetHeight,1>this.ratioWeightHeightPass&&this.interpolationPass?(this.initializeSecondPassBuffers(!0),this.resizeHeight=this.resizeHeightInterpolated):(this.initializeSecondPassBuffers(!1),this.resizeHeight=4==this.colorChannels?this.resizeHeightRGBA:this.resizeHeightRGB))};
Resize.prototype.resizeWidthRGB=function(a){var b=this.ratioWeightWidthPass,c=1/b,e=0,f=0,h=0,d=0,g=0,i=0,j=0,n=this.originalWidthMultipliedByChannels-2,p=this.targetWidthMultipliedByChannels-2,l=this.outputWidthWorkBench,r=this.widthBuffer;do{for(g=0;g<this.originalHeightMultipliedByChannels;)l[g++]=0,l[g++]=0,l[g++]=0;e=b;do if(f=1+h-d,e>=f){g=0;for(i=h;g<this.originalHeightMultipliedByChannels;i+=n)l[g++]+=a[i++]*f,l[g++]+=a[i++]*f,l[g++]+=a[i]*f;d=h+=3;e-=f}else{g=0;for(i=h;g<this.originalHeightMultipliedByChannels;i+=
n)l[g++]+=a[i++]*e,l[g++]+=a[i++]*e,l[g++]+=a[i]*e;d+=e;break}while(0<e&&h<this.originalWidthMultipliedByChannels);g=0;for(i=j;g<this.originalHeightMultipliedByChannels;i+=p)r[i++]=l[g++]*c,r[i++]=l[g++]*c,r[i]=l[g++]*c;j+=3}while(j<this.targetWidthMultipliedByChannels);return r};
Resize.prototype.resizeWidthInterpolatedRGB=function(a){for(var b=this.ratioWeightWidthPass,c=0,e=0,f=0,h=0,d=0,g=this.widthBuffer,i=0;c<1/3;i+=3,c+=b){e=i;for(f=0;e<this.widthPassResultSize;f+=this.originalWidthMultipliedByChannels,e+=this.targetWidthMultipliedByChannels)g[e]=a[f],g[e+1]=a[f+1],g[e+2]=a[f+2]}for(var c=c-1/3,j=this.widthOriginal-1;c<j;i+=3,c+=b){d=c%1;h=1-d;e=i;for(f=3*Math.floor(c);e<this.widthPassResultSize;f+=this.originalWidthMultipliedByChannels,e+=this.targetWidthMultipliedByChannels)g[e]=
a[f]*h+a[f+3]*d,g[e+1]=a[f+1]*h+a[f+4]*d,g[e+2]=a[f+2]*h+a[f+5]*d}for(j=this.originalWidthMultipliedByChannels-3;i<this.targetWidthMultipliedByChannels;i+=3){e=i;for(f=j;e<this.widthPassResultSize;f+=this.originalWidthMultipliedByChannels,e+=this.targetWidthMultipliedByChannels)g[e]=a[f],g[e+1]=a[f+1],g[e+2]=a[f+2]}return g};
Resize.prototype.resizeWidthRGBA=function(a){var b=this.ratioWeightWidthPass,c=1/b,e=0,f=0,h=0,d=0,g=0,i=0,j=0,n=this.originalWidthMultipliedByChannels-3,p=this.targetWidthMultipliedByChannels-3,l=this.outputWidthWorkBench,r=this.widthBuffer;do{for(g=0;g<this.originalHeightMultipliedByChannels;)l[g++]=0,l[g++]=0,l[g++]=0,l[g++]=0;e=b;do if(f=1+h-d,e>=f){g=0;for(i=h;g<this.originalHeightMultipliedByChannels;i+=n)l[g++]+=a[i++]*f,l[g++]+=a[i++]*f,l[g++]+=a[i++]*f,l[g++]+=a[i]*f;d=h+=4;e-=f}else{g=0;
for(i=h;g<this.originalHeightMultipliedByChannels;i+=n)l[g++]+=a[i++]*e,l[g++]+=a[i++]*e,l[g++]+=a[i++]*e,l[g++]+=a[i]*e;d+=e;break}while(0<e&&h<this.originalWidthMultipliedByChannels);g=0;for(i=j;g<this.originalHeightMultipliedByChannels;i+=p)r[i++]=l[g++]*c,r[i++]=l[g++]*c,r[i++]=l[g++]*c,r[i]=l[g++]*c;j+=4}while(j<this.targetWidthMultipliedByChannels);return r};
Resize.prototype.resizeWidthInterpolatedRGBA=function(a){for(var b=this.ratioWeightWidthPass,c=0,e=0,f=0,h=0,d=0,g=this.widthBuffer,i=0;c<1/3;i+=4,c+=b){e=i;for(f=0;e<this.widthPassResultSize;f+=this.originalWidthMultipliedByChannels,e+=this.targetWidthMultipliedByChannels)g[e]=a[f],g[e+1]=a[f+1],g[e+2]=a[f+2],g[e+3]=a[f+3]}for(var c=c-1/3,j=this.widthOriginal-1;c<j;i+=4,c+=b){d=c%1;h=1-d;e=i;for(f=4*Math.floor(c);e<this.widthPassResultSize;f+=this.originalWidthMultipliedByChannels,e+=this.targetWidthMultipliedByChannels)g[e]=
a[f]*h+a[f+4]*d,g[e+1]=a[f+1]*h+a[f+5]*d,g[e+2]=a[f+2]*h+a[f+6]*d,g[e+3]=a[f+3]*h+a[f+7]*d}for(j=this.originalWidthMultipliedByChannels-4;i<this.targetWidthMultipliedByChannels;i+=4){e=i;for(f=j;e<this.widthPassResultSize;f+=this.originalWidthMultipliedByChannels,e+=this.targetWidthMultipliedByChannels)g[e]=a[f],g[e+1]=a[f+1],g[e+2]=a[f+2],g[e+3]=a[f+3]}return g};
Resize.prototype.resizeHeightRGB=function(a){var b=this.ratioWeightHeightPass,c=1/b,e=0,f=0,h=0,d=0,g=0,i=0,j=this.outputHeightWorkBench,n=this.heightBuffer;do{for(g=0;g<this.targetWidthMultipliedByChannels;)j[g++]=0,j[g++]=0,j[g++]=0;e=b;do if(f=1+h-d,e>=f){for(g=0;g<this.targetWidthMultipliedByChannels;)j[g++]+=a[h++]*f,j[g++]+=a[h++]*f,j[g++]+=a[h++]*f;d=h;e-=f}else{g=0;for(f=h;g<this.targetWidthMultipliedByChannels;)j[g++]+=a[f++]*e,j[g++]+=a[f++]*e,j[g++]+=a[f++]*e;d+=e;break}while(0<e&&h<this.widthPassResultSize);
for(g=0;g<this.targetWidthMultipliedByChannels;)n[i++]=Math.round(j[g++]*c),n[i++]=Math.round(j[g++]*c),n[i++]=Math.round(j[g++]*c)}while(i<this.finalResultSize);return n};
Resize.prototype.resizeHeightInterpolated=function(a){for(var b=this.ratioWeightHeightPass,c=0,e=0,f=0,h=0,d=0,g=0,i=0,j=this.heightBuffer;c<1/3;c+=b)for(f=0;f<this.targetWidthMultipliedByChannels;)j[e++]=Math.round(a[f++]);for(var c=c-1/3,n=this.heightOriginal-1;c<n;c+=b){i=c%1;g=1-i;h=Math.floor(c)*this.targetWidthMultipliedByChannels;d=h+this.targetWidthMultipliedByChannels;for(f=0;f<this.targetWidthMultipliedByChannels;++f)j[e++]=Math.round(a[h++]*g+a[d++]*i)}for(;e<this.finalResultSize;){f=0;
for(h=n*this.targetWidthMultipliedByChannels;f<this.targetWidthMultipliedByChannels;++f)j[e++]=Math.round(a[h++])}return j};
Resize.prototype.resizeHeightRGBA=function(a){var b=this.ratioWeightHeightPass,c=1/b,e=0,f=0,h=0,d=0,g=0,i=0,j=this.outputHeightWorkBench,n=this.heightBuffer;do{for(g=0;g<this.targetWidthMultipliedByChannels;)j[g++]=0,j[g++]=0,j[g++]=0,j[g++]=0;e=b;do if(f=1+h-d,e>=f){for(g=0;g<this.targetWidthMultipliedByChannels;)j[g++]+=a[h++]*f,j[g++]+=a[h++]*f,j[g++]+=a[h++]*f,j[g++]+=a[h++]*f;d=h;e-=f}else{g=0;for(f=h;g<this.targetWidthMultipliedByChannels;)j[g++]+=a[f++]*e,j[g++]+=a[f++]*e,j[g++]+=a[f++]*e,
j[g++]+=a[f++]*e;d+=e;break}while(0<e&&h<this.widthPassResultSize);for(g=0;g<this.targetWidthMultipliedByChannels;)n[i++]=Math.round(j[g++]*c),n[i++]=Math.round(j[g++]*c),n[i++]=Math.round(j[g++]*c),n[i++]=Math.round(j[g++]*c)}while(i<this.finalResultSize);return n};Resize.prototype.resize=function(a){this.useWebWorker?this.worker.postMessage(["resize",a]):this.resizeCallback(this.resizeHeight(this.resizeWidth(a)))};Resize.prototype.bypassResizer=function(a){return a};
Resize.prototype.initializeFirstPassBuffers=function(a){this.widthBuffer=this.generateFloatBuffer(this.widthPassResultSize);a||(this.outputWidthWorkBench=this.generateFloatBuffer(this.originalHeightMultipliedByChannels))};Resize.prototype.initializeSecondPassBuffers=function(a){this.heightBuffer=this.generateUint8Buffer(this.finalResultSize);a||(this.outputHeightWorkBench=this.generateFloatBuffer(this.targetWidthMultipliedByChannels))};Resize.prototype.generateFloatBuffer=function(a){try{return new Float32Array(a)}catch(b){return[]}};
Resize.prototype.generateUint8Buffer=function(a){try{return new Uint8Array(a)}catch(b){return[]}};function GameBoyCore(a,b){this.canvas=a;this.drawContext=null;this.ROMImage=b;this.registerA=1;this.FZero=!0;this.FSubtract=!1;this.FCarry=this.FHalfCarry=!0;this.registerB=0;this.registerC=19;this.registerD=0;this.registerE=216;this.registersHL=333;this.stackPointer=65534;this.programCounter=256;this.remainingClocks=this.baseCPUCyclesPerIteration=this.CPUCyclesTotalRoundoff=this.CPUCyclesTotalCurrent=this.CPUCyclesTotalBase=this.CPUCyclesTotal=0;this.inBootstrap=!0;this.skipPCIncrement=this.halt=
this.usedGBCBootROM=this.usedBootROM=!1;this.stopEmulator=3;this.IME=!0;this.interruptsEnabled=this.interruptsRequested=this.IRQLineMatched=0;this.hdmaRunning=!1;this.doubleSpeedShifter=this.CPUTicks=0;this.JoyPad=255;this.CPUStopped=!1;this.memoryReader=[];this.memoryWriter=[];this.memoryHighReader=[];this.memoryHighWriter=[];this.ROM=[];this.memory=[];this.MBCRam=[];this.VRAM=[];this.GBCMemory=[];this.MBCRAMBanksEnabled=this.MBC1Mode=!1;this.currMBCRAMBank=0;this.currMBCRAMBankPosition=-40960;this.cGBC=
!1;this.gbcRamBank=1;this.gbcRamBankPosition=-53248;this.gbcRamBankPositionECHO=-61440;this.RAMBanks=[0,1,2,4,16];this.cartridgeType=this.currentROMBank=this.ROMBank1offs=0;this.gameCode=this.name="";this.fromSaveState=!1;this.savedStateFileName="";this.modeSTAT=this.STATTracker=0;this.spriteCount=252;this.LCDisOn=this.mode0TriggerSTAT=this.mode1TriggerSTAT=this.mode2TriggerSTAT=this.LYCMatchTriggerSTAT=!1;this.LINECONTROL=[];this.DISPLAYOFFCONTROL=[function(){}];this.LCDCONTROL=null;this.initializeLCDController();
this.RTCisLatched=!1;this.RTCDays=this.RTCHours=this.RTCMinutes=this.RTCSeconds=this.latchedHDays=this.latchedLDays=this.latchedHours=this.latchedMinutes=this.latchedSeconds=0;this.RTCHALT=this.RTCDayOverFlow=!1;this.lowY=this.highY=this.lowX=this.highX=127;this.audioHandle=null;this.numSamplesTotal=0;this.dutyLookup=[[!1,!1,!1,!1,!1,!1,!1,!0],[!0,!1,!1,!1,!1,!1,!1,!0],[!0,!1,!1,!1,!1,!0,!0,!0],[!1,!0,!0,!0,!0,!0,!0,!1]];this.bufferContainAmount=0;this.noiseSampleTable=this.LSFR7Table=this.LSFR15Table=
null;this.initializeAudioStartState();this.soundMasterEnabled=!1;this.channel3PCM=null;this.VinRightChannelMasterVolume=this.VinLeftChannelMasterVolume=8;this.rightChannel4=this.rightChannel3=this.rightChannel2=this.rightChannel1=this.leftChannel4=this.leftChannel3=this.leftChannel2=this.leftChannel1=!1;this.audioClocksUntilNextEventCounter=this.audioClocksUntilNextEvent=1;this.mixerOutputCache=this.channel2currentSampleRightTrimary=this.channel2currentSampleLeftTrimary=this.channel1currentSampleRightTrimary=
this.channel1currentSampleLeftTrimary=this.channel4currentSampleRightSecondary=this.channel4currentSampleLeftSecondary=this.channel3currentSampleRightSecondary=this.channel3currentSampleLeftSecondary=this.channel2currentSampleRightSecondary=this.channel2currentSampleLeftSecondary=this.channel1currentSampleRightSecondary=this.channel1currentSampleLeftSecondary=this.channel4currentSampleRight=this.channel4currentSampleLeft=this.channel3currentSampleRight=this.channel3currentSampleLeft=this.channel2currentSampleRight=
this.channel2currentSampleLeft=this.channel1currentSampleRight=this.channel1currentSampleLeft=0;this.emulatorSpeed=1;this.initializeTiming();this.emulatorTicks=this.rollover=this.audioDestinationPosition=this.downsampleInput=this.audioIndex=this.audioTicks=0;this.DIVTicks=56;this.LCDTicks=60;this.timerTicks=0;this.TIMAEnabled=!1;this.TACClocker=1024;this.IRQEnableDelay=this.serialShiftTimerAllocated=this.serialShiftTimer=this.serialTimer=0;var c=new Date;this.lastIteration=c.getTime();c=new Date;
this.firstIteration=c.getTime();this.haltPostClocks=this.totalLinesPassed=this.queuedScanLines=this.lastUnrenderedLine=this.actualScanLine=this.iterations=0;this.cTIMER=this.cHuC1=this.cHuC3=this.cTAMA5=this.cCamera=this.cRUMBLE=this.cMMMO1=this.cSRAM=this.cMBC7=this.cMBC5=this.cMBC3=this.cMBC2=this.cMBC1=!1;this.ROMBanks=[2,4,8,16,32,64,128,256,512];this.ROMBanks[82]=72;this.ROMBanks[83]=80;this.ROMBanks[84]=96;this.backgroundY=this.backgroundX=this.currVRAMBank=this.numRAMBanks=0;this.gfxSpriteShow=
this.gfxWindowDisplay=!1;this.BGPriorityEnabled=this.bgEnabled=this.gfxSpriteNormalHeight=!0;this.gfxBackgroundCHRBankPosition=this.gfxWindowCHRBankPosition=0;this.gfxBackgroundBankOffset=128;this.drewBlank=this.windowX=this.windowY=0;this.drewFrame=!1;this.midScanlineOffset=-1;this.currentX=this.pixelEnd=0;this.tileCache=this.BGCHRCurrentBank=this.BGCHRBank2=this.BGCHRBank1=null;this.colors=[15728606,11392916,5411443,1586242];this.cachedOBJPaletteConversion=this.cachedBGPaletteConversion=this.gbOBJColorizedPalette=
this.gbBGColorizedPalette=this.gbcBGPalette=this.gbcOBJPalette=this.gbBGPalette=this.gbOBJPalette=this.gbcBGRawPalette=this.gbcOBJRawPalette=this.BGPalette=this.OBJPalette=null;this.updateGBBGPalette=this.updateGBRegularBGPalette;this.updateGBOBJPalette=this.updateGBRegularOBJPalette;this.colorizedGBPalettes=!1;this.SpriteLayerRender=this.WindowLayerRender=this.BGLayerRender=null;this.frameBuffer=[];this.canvasBuffer=this.swizzledFrame=null;this.pixelStart=0;this.onscreenWidth=this.offscreenWidth=
160;this.onscreenHeight=this.offScreenheight=144;this.offscreenRGBCount=4*this.onscreenWidth*this.onscreenHeight;this.resizePathClear=!0;this.intializeWhiteNoise()}GameBoyCore.prototype.GBBOOTROM=[];GameBoyCore.prototype.GBCBOOTROM=[];
GameBoyCore.prototype.ffxxDump=[15,0,124,255,0,0,0,248,255,255,255,255,255,255,255,1,128,191,243,255,191,255,63,0,255,191,127,255,159,255,191,255,255,0,0,191,119,243,241,255,255,255,255,255,255,255,255,255,0,255,0,255,0,255,0,255,0,255,0,255,0,255,0,255,145,128,0,0,0,0,0,252,0,0,0,0,255,126,255,254,255,255,255,255,255,255,62,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,192,255,193,0,254,255,255,255,248,255,0,0,0,143,0,0,255,255,255,255,255,255,255,255,206,237,102,102,204,13,
0,11,3,115,0,131,0,12,0,13,0,8,17,31,136,137,0,14,220,204,110,230,221,221,217,153,187,187,103,99,110,14,236,204,221,220,153,159,187,185,51,62,69,236,82,250,8,183,7,93,1,253,192,255,8,252,0,229,11,248,194,206,244,249,15,127,69,109,61,254,70,151,51,94,8,239,241,255,134,131,36,116,18,252,0,159,180,183,6,213,208,122,0,158,4,95,65,47,29,119,54,117,129,170,112,58,152,209,113,2,77,1,193,255,13,0,211,5,249,0,11,0];
GameBoyCore.prototype.OPCODE=[function(){},function(a){a.registerC=a.memoryReader[a.programCounter](a,a.programCounter);a.registerB=a.memoryRead(a.programCounter+1&65535);a.programCounter=a.programCounter+2&65535},function(a){a.memoryWrite(a.registerB<<8|a.registerC,a.registerA)},function(a){var b=(a.registerB<<8|a.registerC)+1;a.registerB=b>>8&255;a.registerC=b&255},function(a){a.registerB=a.registerB+1&255;a.FZero=0==a.registerB;a.FHalfCarry=0==(a.registerB&15);a.FSubtract=!1},function(a){a.registerB=
a.registerB-1&255;a.FZero=0==a.registerB;a.FHalfCarry=15==(a.registerB&15);a.FSubtract=!0},function(a){a.registerB=a.memoryReader[a.programCounter](a,a.programCounter);a.programCounter=a.programCounter+1&65535},function(a){a.FCarry=127<a.registerA;a.registerA=a.registerA<<1&255|a.registerA>>7;a.FZero=a.FSubtract=a.FHalfCarry=!1},function(a){var b=a.memoryRead(a.programCounter+1&65535)<<8|a.memoryReader[a.programCounter](a,a.programCounter);a.programCounter=a.programCounter+2&65535;a.memoryWrite(b,
a.stackPointer&255);a.memoryWrite(b+1&65535,a.stackPointer>>8)},function(a){var b=a.registersHL+(a.registerB<<8|a.registerC);a.FHalfCarry=(a.registersHL&4095)>(b&4095);a.FCarry=65535<b;a.registersHL=b&65535;a.FSubtract=!1},function(a){a.registerA=a.memoryRead(a.registerB<<8|a.registerC)},function(a){var b=(a.registerB<<8|a.registerC)-1&65535;a.registerB=b>>8;a.registerC=b&255},function(a){a.registerC=a.registerC+1&255;a.FZero=0==a.registerC;a.FHalfCarry=0==(a.registerC&15);a.FSubtract=!1},function(a){a.registerC=
a.registerC-1&255;a.FZero=0==a.registerC;a.FHalfCarry=15==(a.registerC&15);a.FSubtract=!0},function(a){a.registerC=a.memoryReader[a.programCounter](a,a.programCounter);a.programCounter=a.programCounter+1&65535},function(a){a.registerA=a.registerA>>1|(a.registerA&1)<<7;a.FCarry=127<a.registerA;a.FZero=a.FSubtract=a.FHalfCarry=!1},function(a){a.cGBC?1==(a.memory[65357]&1)?(127<a.memory[65357]?(cout("Going into single clock speed mode.",0),a.doubleSpeedShifter=0,a.memory[65357]&=127):(cout("Going into double clock speed mode.",
0),a.doubleSpeedShifter=1,a.memory[65357]|=128),a.memory[65357]&=254):a.handleSTOP():a.handleSTOP()},function(a){a.registerE=a.memoryReader[a.programCounter](a,a.programCounter);a.registerD=a.memoryRead(a.programCounter+1&65535);a.programCounter=a.programCounter+2&65535},function(a){a.memoryWrite(a.registerD<<8|a.registerE,a.registerA)},function(a){var b=(a.registerD<<8|a.registerE)+1;a.registerD=b>>8&255;a.registerE=b&255},function(a){a.registerD=a.registerD+1&255;a.FZero=0==a.registerD;a.FHalfCarry=
0==(a.registerD&15);a.FSubtract=!1},function(a){a.registerD=a.registerD-1&255;a.FZero=0==a.registerD;a.FHalfCarry=15==(a.registerD&15);a.FSubtract=!0},function(a){a.registerD=a.memoryReader[a.programCounter](a,a.programCounter);a.programCounter=a.programCounter+1&65535},function(a){var b=a.FCarry?1:0;a.FCarry=127<a.registerA;a.registerA=a.registerA<<1&255|b;a.FZero=a.FSubtract=a.FHalfCarry=!1},function(a){a.programCounter=a.programCounter+(a.memoryReader[a.programCounter](a,a.programCounter)<<24>>
24)+1&65535},function(a){var b=a.registersHL+(a.registerD<<8|a.registerE);a.FHalfCarry=(a.registersHL&4095)>(b&4095);a.FCarry=65535<b;a.registersHL=b&65535;a.FSubtract=!1},function(a){a.registerA=a.memoryRead(a.registerD<<8|a.registerE)},function(a){var b=(a.registerD<<8|a.registerE)-1&65535;a.registerD=b>>8;a.registerE=b&255},function(a){a.registerE=a.registerE+1&255;a.FZero=0==a.registerE;a.FHalfCarry=0==(a.registerE&15);a.FSubtract=!1},function(a){a.registerE=a.registerE-1&255;a.FZero=0==a.registerE;
a.FHalfCarry=15==(a.registerE&15);a.FSubtract=!0},function(a){a.registerE=a.memoryReader[a.programCounter](a,a.programCounter);a.programCounter=a.programCounter+1&65535},function(a){var b=a.FCarry?128:0;a.FCarry=1==(a.registerA&1);a.registerA=a.registerA>>1|b;a.FZero=a.FSubtract=a.FHalfCarry=!1},function(a){a.FZero?a.programCounter=a.programCounter+1&65535:(a.programCounter=a.programCounter+(a.memoryReader[a.programCounter](a,a.programCounter)<<24>>24)+1&65535,a.CPUTicks+=4)},function(a){a.registersHL=
a.memoryRead(a.programCounter+1&65535)<<8|a.memoryReader[a.programCounter](a,a.programCounter);a.programCounter=a.programCounter+2&65535},function(a){a.memoryWriter[a.registersHL](a,a.registersHL,a.registerA);a.registersHL=a.registersHL+1&65535},function(a){a.registersHL=a.registersHL+1&65535},function(a){var b=(a.registersHL>>8)+1&255;a.FZero=0==b;a.FHalfCarry=0==(b&15);a.FSubtract=!1;a.registersHL=b<<8|a.registersHL&255},function(a){var b=(a.registersHL>>8)-1&255;a.FZero=0==b;a.FHalfCarry=15==(b&
15);a.FSubtract=!0;a.registersHL=b<<8|a.registersHL&255},function(a){a.registersHL=a.memoryReader[a.programCounter](a,a.programCounter)<<8|a.registersHL&255;a.programCounter=a.programCounter+1&65535},function(a){if(a.FSubtract)a.FCarry&&a.FHalfCarry?(a.registerA=a.registerA+154&255,a.FHalfCarry=!1):a.FCarry?a.registerA=a.registerA+160&255:a.FHalfCarry&&(a.registerA=a.registerA+250&255,a.FHalfCarry=!1);else{if(a.FCarry||153<a.registerA)a.registerA=a.registerA+96&255,a.FCarry=!0;if(a.FHalfCarry||9<
(a.registerA&15))a.registerA=a.registerA+6&255,a.FHalfCarry=!1}a.FZero=0==a.registerA},function(a){a.FZero?(a.programCounter=a.programCounter+(a.memoryReader[a.programCounter](a,a.programCounter)<<24>>24)+1&65535,a.CPUTicks+=4):a.programCounter=a.programCounter+1&65535},function(a){a.FHalfCarry=2047<(a.registersHL&4095);a.FCarry=32767<a.registersHL;a.registersHL=a.registersHL<<1&65535;a.FSubtract=!1},function(a){a.registerA=a.memoryReader[a.registersHL](a,a.registersHL);a.registersHL=a.registersHL+
1&65535},function(a){a.registersHL=a.registersHL-1&65535},function(a){var b=a.registersHL+1&255;a.FZero=0==b;a.FHalfCarry=0==(b&15);a.FSubtract=!1;a.registersHL=a.registersHL&65280|b},function(a){var b=a.registersHL-1&255;a.FZero=0==b;a.FHalfCarry=15==(b&15);a.FSubtract=!0;a.registersHL=a.registersHL&65280|b},function(a){a.registersHL=a.registersHL&65280|a.memoryReader[a.programCounter](a,a.programCounter);a.programCounter=a.programCounter+1&65535},function(a){a.registerA^=255;a.FSubtract=a.FHalfCarry=
!0},function(a){a.FCarry?a.programCounter=a.programCounter+1&65535:(a.programCounter=a.programCounter+(a.memoryReader[a.programCounter](a,a.programCounter)<<24>>24)+1&65535,a.CPUTicks+=4)},function(a){a.stackPointer=a.memoryRead(a.programCounter+1&65535)<<8|a.memoryReader[a.programCounter](a,a.programCounter);a.programCounter=a.programCounter+2&65535},function(a){a.memoryWriter[a.registersHL](a,a.registersHL,a.registerA);a.registersHL=a.registersHL-1&65535},function(a){a.stackPointer=a.stackPointer+
1&65535},function(a){var b=a.memoryReader[a.registersHL](a,a.registersHL)+1&255;a.FZero=0==b;a.FHalfCarry=0==(b&15);a.FSubtract=!1;a.memoryWriter[a.registersHL](a,a.registersHL,b)},function(a){var b=a.memoryReader[a.registersHL](a,a.registersHL)-1&255;a.FZero=0==b;a.FHalfCarry=15==(b&15);a.FSubtract=!0;a.memoryWriter[a.registersHL](a,a.registersHL,b)},function(a){a.memoryWriter[a.registersHL](a,a.registersHL,a.memoryReader[a.programCounter](a,a.programCounter));a.programCounter=a.programCounter+1&
65535},function(a){a.FCarry=!0;a.FSubtract=a.FHalfCarry=!1},function(a){a.FCarry?(a.programCounter=a.programCounter+(a.memoryReader[a.programCounter](a,a.programCounter)<<24>>24)+1&65535,a.CPUTicks+=4):a.programCounter=a.programCounter+1&65535},function(a){var b=a.registersHL+a.stackPointer;a.FHalfCarry=(a.registersHL&4095)>(b&4095);a.FCarry=65535<b;a.registersHL=b&65535;a.FSubtract=!1},function(a){a.registerA=a.memoryReader[a.registersHL](a,a.registersHL);a.registersHL=a.registersHL-1&65535},function(a){a.stackPointer=
a.stackPointer-1&65535},function(a){a.registerA=a.registerA+1&255;a.FZero=0==a.registerA;a.FHalfCarry=0==(a.registerA&15);a.FSubtract=!1},function(a){a.registerA=a.registerA-1&255;a.FZero=0==a.registerA;a.FHalfCarry=15==(a.registerA&15);a.FSubtract=!0},function(a){a.registerA=a.memoryReader[a.programCounter](a,a.programCounter);a.programCounter=a.programCounter+1&65535},function(a){a.FCarry=!a.FCarry;a.FSubtract=a.FHalfCarry=!1},function(){},function(a){a.registerB=a.registerC},function(a){a.registerB=
a.registerD},function(a){a.registerB=a.registerE},function(a){a.registerB=a.registersHL>>8},function(a){a.registerB=a.registersHL&255},function(a){a.registerB=a.memoryReader[a.registersHL](a,a.registersHL)},function(a){a.registerB=a.registerA},function(a){a.registerC=a.registerB},function(){},function(a){a.registerC=a.registerD},function(a){a.registerC=a.registerE},function(a){a.registerC=a.registersHL>>8},function(a){a.registerC=a.registersHL&255},function(a){a.registerC=a.memoryReader[a.registersHL](a,
a.registersHL)},function(a){a.registerC=a.registerA},function(a){a.registerD=a.registerB},function(a){a.registerD=a.registerC},function(){},function(a){a.registerD=a.registerE},function(a){a.registerD=a.registersHL>>8},function(a){a.registerD=a.registersHL&255},function(a){a.registerD=a.memoryReader[a.registersHL](a,a.registersHL)},function(a){a.registerD=a.registerA},function(a){a.registerE=a.registerB},function(a){a.registerE=a.registerC},function(a){a.registerE=a.registerD},function(){},function(a){a.registerE=
a.registersHL>>8},function(a){a.registerE=a.registersHL&255},function(a){a.registerE=a.memoryReader[a.registersHL](a,a.registersHL)},function(a){a.registerE=a.registerA},function(a){a.registersHL=a.registerB<<8|a.registersHL&255},function(a){a.registersHL=a.registerC<<8|a.registersHL&255},function(a){a.registersHL=a.registerD<<8|a.registersHL&255},function(a){a.registersHL=a.registerE<<8|a.registersHL&255},function(){},function(a){a.registersHL=257*(a.registersHL&255)},function(a){a.registersHL=a.memoryReader[a.registersHL](a,
a.registersHL)<<8|a.registersHL&255},function(a){a.registersHL=a.registerA<<8|a.registersHL&255},function(a){a.registersHL=a.registersHL&65280|a.registerB},function(a){a.registersHL=a.registersHL&65280|a.registerC},function(a){a.registersHL=a.registersHL&65280|a.registerD},function(a){a.registersHL=a.registersHL&65280|a.registerE},function(a){a.registersHL=a.registersHL&65280|a.registersHL>>8},function(){},function(a){a.registersHL=a.registersHL&65280|a.memoryReader[a.registersHL](a,a.registersHL)},
function(a){a.registersHL=a.registersHL&65280|a.registerA},function(a){a.memoryWriter[a.registersHL](a,a.registersHL,a.registerB)},function(a){a.memoryWriter[a.registersHL](a,a.registersHL,a.registerC)},function(a){a.memoryWriter[a.registersHL](a,a.registersHL,a.registerD)},function(a){a.memoryWriter[a.registersHL](a,a.registersHL,a.registerE)},function(a){a.memoryWriter[a.registersHL](a,a.registersHL,a.registersHL>>8)},function(a){a.memoryWriter[a.registersHL](a,a.registersHL,a.registersHL&255)},
function(a){0<(a.interruptsEnabled&a.interruptsRequested&31)?!a.cGBC&&!a.usedBootROM?a.skipPCIncrement=!0:a.CPUTicks+=4:a.calculateHALTPeriod()},function(a){a.memoryWriter[a.registersHL](a,a.registersHL,a.registerA)},function(a){a.registerA=a.registerB},function(a){a.registerA=a.registerC},function(a){a.registerA=a.registerD},function(a){a.registerA=a.registerE},function(a){a.registerA=a.registersHL>>8},function(a){a.registerA=a.registersHL&255},function(a){a.registerA=a.memoryReader[a.registersHL](a,
a.registersHL)},function(){},function(a){var b=a.registerA+a.registerB;a.FHalfCarry=(b&15)<(a.registerA&15);a.FCarry=255<b;a.registerA=b&255;a.FZero=0==a.registerA;a.FSubtract=!1},function(a){var b=a.registerA+a.registerC;a.FHalfCarry=(b&15)<(a.registerA&15);a.FCarry=255<b;a.registerA=b&255;a.FZero=0==a.registerA;a.FSubtract=!1},function(a){var b=a.registerA+a.registerD;a.FHalfCarry=(b&15)<(a.registerA&15);a.FCarry=255<b;a.registerA=b&255;a.FZero=0==a.registerA;a.FSubtract=!1},function(a){var b=a.registerA+
a.registerE;a.FHalfCarry=(b&15)<(a.registerA&15);a.FCarry=255<b;a.registerA=b&255;a.FZero=0==a.registerA;a.FSubtract=!1},function(a){var b=a.registerA+(a.registersHL>>8);a.FHalfCarry=(b&15)<(a.registerA&15);a.FCarry=255<b;a.registerA=b&255;a.FZero=0==a.registerA;a.FSubtract=!1},function(a){var b=a.registerA+(a.registersHL&255);a.FHalfCarry=(b&15)<(a.registerA&15);a.FCarry=255<b;a.registerA=b&255;a.FZero=0==a.registerA;a.FSubtract=!1},function(a){var b=a.registerA+a.memoryReader[a.registersHL](a,a.registersHL);
a.FHalfCarry=(b&15)<(a.registerA&15);a.FCarry=255<b;a.registerA=b&255;a.FZero=0==a.registerA;a.FSubtract=!1},function(a){a.FHalfCarry=8==(a.registerA&8);a.FCarry=127<a.registerA;a.registerA=a.registerA<<1&255;a.FZero=0==a.registerA;a.FSubtract=!1},function(a){var b=a.registerA+a.registerB+(a.FCarry?1:0);a.FHalfCarry=15<(a.registerA&15)+(a.registerB&15)+(a.FCarry?1:0);a.FCarry=255<b;a.registerA=b&255;a.FZero=0==a.registerA;a.FSubtract=!1},function(a){var b=a.registerA+a.registerC+(a.FCarry?1:0);a.FHalfCarry=
15<(a.registerA&15)+(a.registerC&15)+(a.FCarry?1:0);a.FCarry=255<b;a.registerA=b&255;a.FZero=0==a.registerA;a.FSubtract=!1},function(a){var b=a.registerA+a.registerD+(a.FCarry?1:0);a.FHalfCarry=15<(a.registerA&15)+(a.registerD&15)+(a.FCarry?1:0);a.FCarry=255<b;a.registerA=b&255;a.FZero=0==a.registerA;a.FSubtract=!1},function(a){var b=a.registerA+a.registerE+(a.FCarry?1:0);a.FHalfCarry=15<(a.registerA&15)+(a.registerE&15)+(a.FCarry?1:0);a.FCarry=255<b;a.registerA=b&255;a.FZero=0==a.registerA;a.FSubtract=
!1},function(a){var b=a.registersHL>>8,c=a.registerA+b+(a.FCarry?1:0);a.FHalfCarry=15<(a.registerA&15)+(b&15)+(a.FCarry?1:0);a.FCarry=255<c;a.registerA=c&255;a.FZero=0==a.registerA;a.FSubtract=!1},function(a){var b=a.registersHL&255,c=a.registerA+b+(a.FCarry?1:0);a.FHalfCarry=15<(a.registerA&15)+(b&15)+(a.FCarry?1:0);a.FCarry=255<c;a.registerA=c&255;a.FZero=0==a.registerA;a.FSubtract=!1},function(a){var b=a.memoryReader[a.registersHL](a,a.registersHL),c=a.registerA+b+(a.FCarry?1:0);a.FHalfCarry=15<
(a.registerA&15)+(b&15)+(a.FCarry?1:0);a.FCarry=255<c;a.registerA=c&255;a.FZero=0==a.registerA;a.FSubtract=!1},function(a){var b=a.registerA<<1|(a.FCarry?1:0);a.FHalfCarry=15<(a.registerA<<1&30|(a.FCarry?1:0));a.FCarry=255<b;a.registerA=b&255;a.FZero=0==a.registerA;a.FSubtract=!1},function(a){var b=a.registerA-a.registerB;a.FHalfCarry=(a.registerA&15)<(b&15);a.FCarry=0>b;a.registerA=b&255;a.FZero=0==b;a.FSubtract=!0},function(a){var b=a.registerA-a.registerC;a.FHalfCarry=(a.registerA&15)<(b&15);a.FCarry=
0>b;a.registerA=b&255;a.FZero=0==b;a.FSubtract=!0},function(a){var b=a.registerA-a.registerD;a.FHalfCarry=(a.registerA&15)<(b&15);a.FCarry=0>b;a.registerA=b&255;a.FZero=0==b;a.FSubtract=!0},function(a){var b=a.registerA-a.registerE;a.FHalfCarry=(a.registerA&15)<(b&15);a.FCarry=0>b;a.registerA=b&255;a.FZero=0==b;a.FSubtract=!0},function(a){var b=a.registerA-(a.registersHL>>8);a.FHalfCarry=(a.registerA&15)<(b&15);a.FCarry=0>b;a.registerA=b&255;a.FZero=0==b;a.FSubtract=!0},function(a){var b=a.registerA-
(a.registersHL&255);a.FHalfCarry=(a.registerA&15)<(b&15);a.FCarry=0>b;a.registerA=b&255;a.FZero=0==b;a.FSubtract=!0},function(a){var b=a.registerA-a.memoryReader[a.registersHL](a,a.registersHL);a.FHalfCarry=(a.registerA&15)<(b&15);a.FCarry=0>b;a.registerA=b&255;a.FZero=0==b;a.FSubtract=!0},function(a){a.registerA=0;a.FHalfCarry=a.FCarry=!1;a.FZero=a.FSubtract=!0},function(a){var b=a.registerA-a.registerB-(a.FCarry?1:0);a.FHalfCarry=0>(a.registerA&15)-(a.registerB&15)-(a.FCarry?1:0);a.FCarry=0>b;a.registerA=
b&255;a.FZero=0==a.registerA;a.FSubtract=!0},function(a){var b=a.registerA-a.registerC-(a.FCarry?1:0);a.FHalfCarry=0>(a.registerA&15)-(a.registerC&15)-(a.FCarry?1:0);a.FCarry=0>b;a.registerA=b&255;a.FZero=0==a.registerA;a.FSubtract=!0},function(a){var b=a.registerA-a.registerD-(a.FCarry?1:0);a.FHalfCarry=0>(a.registerA&15)-(a.registerD&15)-(a.FCarry?1:0);a.FCarry=0>b;a.registerA=b&255;a.FZero=0==a.registerA;a.FSubtract=!0},function(a){var b=a.registerA-a.registerE-(a.FCarry?1:0);a.FHalfCarry=0>(a.registerA&
15)-(a.registerE&15)-(a.FCarry?1:0);a.FCarry=0>b;a.registerA=b&255;a.FZero=0==a.registerA;a.FSubtract=!0},function(a){var b=a.registersHL>>8,c=a.registerA-b-(a.FCarry?1:0);a.FHalfCarry=0>(a.registerA&15)-(b&15)-(a.FCarry?1:0);a.FCarry=0>c;a.registerA=c&255;a.FZero=0==a.registerA;a.FSubtract=!0},function(a){var b=a.registerA-(a.registersHL&255)-(a.FCarry?1:0);a.FHalfCarry=0>(a.registerA&15)-(a.registersHL&15)-(a.FCarry?1:0);a.FCarry=0>b;a.registerA=b&255;a.FZero=0==a.registerA;a.FSubtract=!0},function(a){var b=
a.memoryReader[a.registersHL](a,a.registersHL),c=a.registerA-b-(a.FCarry?1:0);a.FHalfCarry=0>(a.registerA&15)-(b&15)-(a.FCarry?1:0);a.FCarry=0>c;a.registerA=c&255;a.FZero=0==a.registerA;a.FSubtract=!0},function(a){a.FCarry?(a.FZero=!1,a.FSubtract=a.FHalfCarry=a.FCarry=!0,a.registerA=255):(a.FHalfCarry=a.FCarry=!1,a.FSubtract=a.FZero=!0,a.registerA=0)},function(a){a.registerA&=a.registerB;a.FZero=0==a.registerA;a.FHalfCarry=!0;a.FSubtract=a.FCarry=!1},function(a){a.registerA&=a.registerC;a.FZero=0==
a.registerA;a.FHalfCarry=!0;a.FSubtract=a.FCarry=!1},function(a){a.registerA&=a.registerD;a.FZero=0==a.registerA;a.FHalfCarry=!0;a.FSubtract=a.FCarry=!1},function(a){a.registerA&=a.registerE;a.FZero=0==a.registerA;a.FHalfCarry=!0;a.FSubtract=a.FCarry=!1},function(a){a.registerA&=a.registersHL>>8;a.FZero=0==a.registerA;a.FHalfCarry=!0;a.FSubtract=a.FCarry=!1},function(a){a.registerA&=a.registersHL;a.FZero=0==a.registerA;a.FHalfCarry=!0;a.FSubtract=a.FCarry=!1},function(a){a.registerA&=a.memoryReader[a.registersHL](a,
a.registersHL);a.FZero=0==a.registerA;a.FHalfCarry=!0;a.FSubtract=a.FCarry=!1},function(a){a.FZero=0==a.registerA;a.FHalfCarry=!0;a.FSubtract=a.FCarry=!1},function(a){a.registerA^=a.registerB;a.FZero=0==a.registerA;a.FSubtract=a.FHalfCarry=a.FCarry=!1},function(a){a.registerA^=a.registerC;a.FZero=0==a.registerA;a.FSubtract=a.FHalfCarry=a.FCarry=!1},function(a){a.registerA^=a.registerD;a.FZero=0==a.registerA;a.FSubtract=a.FHalfCarry=a.FCarry=!1},function(a){a.registerA^=a.registerE;a.FZero=0==a.registerA;
a.FSubtract=a.FHalfCarry=a.FCarry=!1},function(a){a.registerA^=a.registersHL>>8;a.FZero=0==a.registerA;a.FSubtract=a.FHalfCarry=a.FCarry=!1},function(a){a.registerA^=a.registersHL&255;a.FZero=0==a.registerA;a.FSubtract=a.FHalfCarry=a.FCarry=!1},function(a){a.registerA^=a.memoryReader[a.registersHL](a,a.registersHL);a.FZero=0==a.registerA;a.FSubtract=a.FHalfCarry=a.FCarry=!1},function(a){a.registerA=0;a.FZero=!0;a.FSubtract=a.FHalfCarry=a.FCarry=!1},function(a){a.registerA|=a.registerB;a.FZero=0==
a.registerA;a.FSubtract=a.FCarry=a.FHalfCarry=!1},function(a){a.registerA|=a.registerC;a.FZero=0==a.registerA;a.FSubtract=a.FCarry=a.FHalfCarry=!1},function(a){a.registerA|=a.registerD;a.FZero=0==a.registerA;a.FSubtract=a.FCarry=a.FHalfCarry=!1},function(a){a.registerA|=a.registerE;a.FZero=0==a.registerA;a.FSubtract=a.FCarry=a.FHalfCarry=!1},function(a){a.registerA|=a.registersHL>>8;a.FZero=0==a.registerA;a.FSubtract=a.FCarry=a.FHalfCarry=!1},function(a){a.registerA|=a.registersHL&255;a.FZero=0==
a.registerA;a.FSubtract=a.FCarry=a.FHalfCarry=!1},function(a){a.registerA|=a.memoryReader[a.registersHL](a,a.registersHL);a.FZero=0==a.registerA;a.FSubtract=a.FCarry=a.FHalfCarry=!1},function(a){a.FZero=0==a.registerA;a.FSubtract=a.FCarry=a.FHalfCarry=!1},function(a){var b=a.registerA-a.registerB;a.FHalfCarry=(b&15)>(a.registerA&15);a.FCarry=0>b;a.FZero=0==b;a.FSubtract=!0},function(a){var b=a.registerA-a.registerC;a.FHalfCarry=(b&15)>(a.registerA&15);a.FCarry=0>b;a.FZero=0==b;a.FSubtract=!0},function(a){var b=
a.registerA-a.registerD;a.FHalfCarry=(b&15)>(a.registerA&15);a.FCarry=0>b;a.FZero=0==b;a.FSubtract=!0},function(a){var b=a.registerA-a.registerE;a.FHalfCarry=(b&15)>(a.registerA&15);a.FCarry=0>b;a.FZero=0==b;a.FSubtract=!0},function(a){var b=a.registerA-(a.registersHL>>8);a.FHalfCarry=(b&15)>(a.registerA&15);a.FCarry=0>b;a.FZero=0==b;a.FSubtract=!0},function(a){var b=a.registerA-(a.registersHL&255);a.FHalfCarry=(b&15)>(a.registerA&15);a.FCarry=0>b;a.FZero=0==b;a.FSubtract=!0},function(a){var b=a.registerA-
a.memoryReader[a.registersHL](a,a.registersHL);a.FHalfCarry=(b&15)>(a.registerA&15);a.FCarry=0>b;a.FZero=0==b;a.FSubtract=!0},function(a){a.FHalfCarry=a.FCarry=!1;a.FZero=a.FSubtract=!0},function(a){a.FZero||(a.programCounter=a.memoryRead(a.stackPointer+1&65535)<<8|a.memoryReader[a.stackPointer](a,a.stackPointer),a.stackPointer=a.stackPointer+2&65535,a.CPUTicks+=12)},function(a){a.registerC=a.memoryReader[a.stackPointer](a,a.stackPointer);a.registerB=a.memoryRead(a.stackPointer+1&65535);a.stackPointer=
a.stackPointer+2&65535},function(a){a.FZero?a.programCounter=a.programCounter+2&65535:(a.programCounter=a.memoryRead(a.programCounter+1&65535)<<8|a.memoryReader[a.programCounter](a,a.programCounter),a.CPUTicks+=4)},function(a){a.programCounter=a.memoryRead(a.programCounter+1&65535)<<8|a.memoryReader[a.programCounter](a,a.programCounter)},function(a){if(a.FZero)a.programCounter=a.programCounter+2&65535;else{var b=a.memoryRead(a.programCounter+1&65535)<<8|a.memoryReader[a.programCounter](a,a.programCounter);
a.programCounter=a.programCounter+2&65535;a.stackPointer=a.stackPointer-1&65535;a.memoryWriter[a.stackPointer](a,a.stackPointer,a.programCounter>>8);a.stackPointer=a.stackPointer-1&65535;a.memoryWriter[a.stackPointer](a,a.stackPointer,a.programCounter&255);a.programCounter=b;a.CPUTicks+=12}},function(a){a.stackPointer=a.stackPointer-1&65535;a.memoryWriter[a.stackPointer](a,a.stackPointer,a.registerB);a.stackPointer=a.stackPointer-1&65535;a.memoryWriter[a.stackPointer](a,a.stackPointer,a.registerC)},
function(a){var b=a.registerA+a.memoryReader[a.programCounter](a,a.programCounter);a.programCounter=a.programCounter+1&65535;a.FHalfCarry=(b&15)<(a.registerA&15);a.FCarry=255<b;a.registerA=b&255;a.FZero=0==a.registerA;a.FSubtract=!1},function(a){a.stackPointer=a.stackPointer-1&65535;a.memoryWriter[a.stackPointer](a,a.stackPointer,a.programCounter>>8);a.stackPointer=a.stackPointer-1&65535;a.memoryWriter[a.stackPointer](a,a.stackPointer,a.programCounter&255);a.programCounter=0},function(a){a.FZero&&
(a.programCounter=a.memoryRead(a.stackPointer+1&65535)<<8|a.memoryReader[a.stackPointer](a,a.stackPointer),a.stackPointer=a.stackPointer+2&65535,a.CPUTicks+=12)},function(a){a.programCounter=a.memoryRead(a.stackPointer+1&65535)<<8|a.memoryReader[a.stackPointer](a,a.stackPointer);a.stackPointer=a.stackPointer+2&65535},function(a){a.FZero?(a.programCounter=a.memoryRead(a.programCounter+1&65535)<<8|a.memoryReader[a.programCounter](a,a.programCounter),a.CPUTicks+=4):a.programCounter=a.programCounter+
2&65535},function(a){var b=a.memoryReader[a.programCounter](a,a.programCounter);a.programCounter=a.programCounter+1&65535;a.CPUTicks+=a.SecondaryTICKTable[b];a.CBOPCODE[b](a)},function(a){if(a.FZero){var b=a.memoryRead(a.programCounter+1&65535)<<8|a.memoryReader[a.programCounter](a,a.programCounter);a.programCounter=a.programCounter+2&65535;a.stackPointer=a.stackPointer-1&65535;a.memoryWriter[a.stackPointer](a,a.stackPointer,a.programCounter>>8);a.stackPointer=a.stackPointer-1&65535;a.memoryWriter[a.stackPointer](a,
a.stackPointer,a.programCounter&255);a.programCounter=b;a.CPUTicks+=12}else a.programCounter=a.programCounter+2&65535},function(a){var b=a.memoryRead(a.programCounter+1&65535)<<8|a.memoryReader[a.programCounter](a,a.programCounter);a.programCounter=a.programCounter+2&65535;a.stackPointer=a.stackPointer-1&65535;a.memoryWriter[a.stackPointer](a,a.stackPointer,a.programCounter>>8);a.stackPointer=a.stackPointer-1&65535;a.memoryWriter[a.stackPointer](a,a.stackPointer,a.programCounter&255);a.programCounter=
b},function(a){var b=a.memoryReader[a.programCounter](a,a.programCounter);a.programCounter=a.programCounter+1&65535;var c=a.registerA+b+(a.FCarry?1:0);a.FHalfCarry=15<(a.registerA&15)+(b&15)+(a.FCarry?1:0);a.FCarry=255<c;a.registerA=c&255;a.FZero=0==a.registerA;a.FSubtract=!1},function(a){a.stackPointer=a.stackPointer-1&65535;a.memoryWriter[a.stackPointer](a,a.stackPointer,a.programCounter>>8);a.stackPointer=a.stackPointer-1&65535;a.memoryWriter[a.stackPointer](a,a.stackPointer,a.programCounter&255);
a.programCounter=8},function(a){a.FCarry||(a.programCounter=a.memoryRead(a.stackPointer+1&65535)<<8|a.memoryReader[a.stackPointer](a,a.stackPointer),a.stackPointer=a.stackPointer+2&65535,a.CPUTicks+=12)},function(a){a.registerE=a.memoryReader[a.stackPointer](a,a.stackPointer);a.registerD=a.memoryRead(a.stackPointer+1&65535);a.stackPointer=a.stackPointer+2&65535},function(a){a.FCarry?a.programCounter=a.programCounter+2&65535:(a.programCounter=a.memoryRead(a.programCounter+1&65535)<<8|a.memoryReader[a.programCounter](a,
a.programCounter),a.CPUTicks+=4)},function(){cout("Illegal op code 0xD3 called, pausing emulation.",2);pause()},function(a){if(a.FCarry)a.programCounter=a.programCounter+2&65535;else{var b=a.memoryRead(a.programCounter+1&65535)<<8|a.memoryReader[a.programCounter](a,a.programCounter);a.programCounter=a.programCounter+2&65535;a.stackPointer=a.stackPointer-1&65535;a.memoryWriter[a.stackPointer](a,a.stackPointer,a.programCounter>>8);a.stackPointer=a.stackPointer-1&65535;a.memoryWriter[a.stackPointer](a,
a.stackPointer,a.programCounter&255);a.programCounter=b;a.CPUTicks+=12}},function(a){a.stackPointer=a.stackPointer-1&65535;a.memoryWriter[a.stackPointer](a,a.stackPointer,a.registerD);a.stackPointer=a.stackPointer-1&65535;a.memoryWriter[a.stackPointer](a,a.stackPointer,a.registerE)},function(a){var b=a.registerA-a.memoryReader[a.programCounter](a,a.programCounter);a.programCounter=a.programCounter+1&65535;a.FHalfCarry=(a.registerA&15)<(b&15);a.FCarry=0>b;a.registerA=b&255;a.FZero=0==b;a.FSubtract=
!0},function(a){a.stackPointer=a.stackPointer-1&65535;a.memoryWriter[a.stackPointer](a,a.stackPointer,a.programCounter>>8);a.stackPointer=a.stackPointer-1&65535;a.memoryWriter[a.stackPointer](a,a.stackPointer,a.programCounter&255);a.programCounter=16},function(a){a.FCarry&&(a.programCounter=a.memoryRead(a.stackPointer+1&65535)<<8|a.memoryReader[a.stackPointer](a,a.stackPointer),a.stackPointer=a.stackPointer+2&65535,a.CPUTicks+=12)},function(a){a.programCounter=a.memoryRead(a.stackPointer+1&65535)<<
8|a.memoryReader[a.stackPointer](a,a.stackPointer);a.stackPointer=a.stackPointer+2&65535;a.IRQEnableDelay=2==a.IRQEnableDelay||118==a.memoryReader[a.programCounter](a,a.programCounter)?1:2},function(a){a.FCarry?(a.programCounter=a.memoryRead(a.programCounter+1&65535)<<8|a.memoryReader[a.programCounter](a,a.programCounter),a.CPUTicks+=4):a.programCounter=a.programCounter+2&65535},function(){cout("Illegal op code 0xDB called, pausing emulation.",2);pause()},function(a){if(a.FCarry){var b=a.memoryRead(a.programCounter+
1&65535)<<8|a.memoryReader[a.programCounter](a,a.programCounter);a.programCounter=a.programCounter+2&65535;a.stackPointer=a.stackPointer-1&65535;a.memoryWriter[a.stackPointer](a,a.stackPointer,a.programCounter>>8);a.stackPointer=a.stackPointer-1&65535;a.memoryWriter[a.stackPointer](a,a.stackPointer,a.programCounter&255);a.programCounter=b;a.CPUTicks+=12}else a.programCounter=a.programCounter+2&65535},function(){cout("Illegal op code 0xDD called, pausing emulation.",2);pause()},function(a){var b=a.memoryReader[a.programCounter](a,
a.programCounter);a.programCounter=a.programCounter+1&65535;var c=a.registerA-b-(a.FCarry?1:0);a.FHalfCarry=0>(a.registerA&15)-(b&15)-(a.FCarry?1:0);a.FCarry=0>c;a.registerA=c&255;a.FZero=0==a.registerA;a.FSubtract=!0},function(a){a.stackPointer=a.stackPointer-1&65535;a.memoryWriter[a.stackPointer](a,a.stackPointer,a.programCounter>>8);a.stackPointer=a.stackPointer-1&65535;a.memoryWriter[a.stackPointer](a,a.stackPointer,a.programCounter&255);a.programCounter=24},function(a){a.memoryHighWrite(a.memoryReader[a.programCounter](a,
a.programCounter),a.registerA);a.programCounter=a.programCounter+1&65535},function(a){a.registersHL=a.memoryRead(a.stackPointer+1&65535)<<8|a.memoryReader[a.stackPointer](a,a.stackPointer);a.stackPointer=a.stackPointer+2&65535},function(a){a.memoryHighWriter[a.registerC](a,a.registerC,a.registerA)},function(){cout("Illegal op code 0xE3 called, pausing emulation.",2);pause()},function(){cout("Illegal op code 0xE4 called, pausing emulation.",2);pause()},function(a){a.stackPointer=a.stackPointer-1&65535;
a.memoryWriter[a.stackPointer](a,a.stackPointer,a.registersHL>>8);a.stackPointer=a.stackPointer-1&65535;a.memoryWriter[a.stackPointer](a,a.stackPointer,a.registersHL&255)},function(a){a.registerA&=a.memoryReader[a.programCounter](a,a.programCounter);a.programCounter=a.programCounter+1&65535;a.FZero=0==a.registerA;a.FHalfCarry=!0;a.FSubtract=a.FCarry=!1},function(a){a.stackPointer=a.stackPointer-1&65535;a.memoryWriter[a.stackPointer](a,a.stackPointer,a.programCounter>>8);a.stackPointer=a.stackPointer-
1&65535;a.memoryWriter[a.stackPointer](a,a.stackPointer,a.programCounter&255);a.programCounter=32},function(a){var b=a.memoryReader[a.programCounter](a,a.programCounter)<<24>>24;a.programCounter=a.programCounter+1&65535;var c=a.stackPointer+b&65535,b=a.stackPointer^b^c;a.stackPointer=c;a.FCarry=256==(b&256);a.FHalfCarry=16==(b&16);a.FZero=a.FSubtract=!1},function(a){a.programCounter=a.registersHL},function(a){a.memoryWrite(a.memoryRead(a.programCounter+1&65535)<<8|a.memoryReader[a.programCounter](a,
a.programCounter),a.registerA);a.programCounter=a.programCounter+2&65535},function(){cout("Illegal op code 0xEB called, pausing emulation.",2);pause()},function(){cout("Illegal op code 0xEC called, pausing emulation.",2);pause()},function(){cout("Illegal op code 0xED called, pausing emulation.",2);pause()},function(a){a.registerA^=a.memoryReader[a.programCounter](a,a.programCounter);a.programCounter=a.programCounter+1&65535;a.FZero=0==a.registerA;a.FSubtract=a.FHalfCarry=a.FCarry=!1},function(a){a.stackPointer=
a.stackPointer-1&65535;a.memoryWriter[a.stackPointer](a,a.stackPointer,a.programCounter>>8);a.stackPointer=a.stackPointer-1&65535;a.memoryWriter[a.stackPointer](a,a.stackPointer,a.programCounter&255);a.programCounter=40},function(a){a.registerA=a.memoryHighRead(a.memoryReader[a.programCounter](a,a.programCounter));a.programCounter=a.programCounter+1&65535},function(a){var b=a.memoryReader[a.stackPointer](a,a.stackPointer);a.FZero=127<b;a.FSubtract=64==(b&64);a.FHalfCarry=32==(b&32);a.FCarry=16==(b&
16);a.registerA=a.memoryRead(a.stackPointer+1&65535);a.stackPointer=a.stackPointer+2&65535},function(a){a.registerA=a.memoryHighReader[a.registerC](a,a.registerC)},function(a){a.IME=!1;a.IRQEnableDelay=0},function(){cout("Illegal op code 0xF4 called, pausing emulation.",2);pause()},function(a){a.stackPointer=a.stackPointer-1&65535;a.memoryWriter[a.stackPointer](a,a.stackPointer,a.registerA);a.stackPointer=a.stackPointer-1&65535;a.memoryWriter[a.stackPointer](a,a.stackPointer,(a.FZero?128:0)|(a.FSubtract?
64:0)|(a.FHalfCarry?32:0)|(a.FCarry?16:0))},function(a){a.registerA|=a.memoryReader[a.programCounter](a,a.programCounter);a.FZero=0==a.registerA;a.programCounter=a.programCounter+1&65535;a.FSubtract=a.FCarry=a.FHalfCarry=!1},function(a){a.stackPointer=a.stackPointer-1&65535;a.memoryWriter[a.stackPointer](a,a.stackPointer,a.programCounter>>8);a.stackPointer=a.stackPointer-1&65535;a.memoryWriter[a.stackPointer](a,a.stackPointer,a.programCounter&255);a.programCounter=48},function(a){var b=a.memoryReader[a.programCounter](a,
a.programCounter)<<24>>24;a.programCounter=a.programCounter+1&65535;a.registersHL=a.stackPointer+b&65535;b=a.stackPointer^b^a.registersHL;a.FCarry=256==(b&256);a.FHalfCarry=16==(b&16);a.FZero=a.FSubtract=!1},function(a){a.stackPointer=a.registersHL},function(a){a.registerA=a.memoryRead(a.memoryRead(a.programCounter+1&65535)<<8|a.memoryReader[a.programCounter](a,a.programCounter));a.programCounter=a.programCounter+2&65535},function(a){a.IRQEnableDelay=2==a.IRQEnableDelay||118==a.memoryReader[a.programCounter](a,
a.programCounter)?1:2},function(){cout("Illegal op code 0xFC called, pausing emulation.",2);pause()},function(){cout("Illegal op code 0xFD called, pausing emulation.",2);pause()},function(a){var b=a.registerA-a.memoryReader[a.programCounter](a,a.programCounter);a.programCounter=a.programCounter+1&65535;a.FHalfCarry=(b&15)>(a.registerA&15);a.FCarry=0>b;a.FZero=0==b;a.FSubtract=!0},function(a){a.stackPointer=a.stackPointer-1&65535;a.memoryWriter[a.stackPointer](a,a.stackPointer,a.programCounter>>8);
a.stackPointer=a.stackPointer-1&65535;a.memoryWriter[a.stackPointer](a,a.stackPointer,a.programCounter&255);a.programCounter=56}];
GameBoyCore.prototype.CBOPCODE=[function(a){a.FCarry=127<a.registerB;a.registerB=a.registerB<<1&255|(a.FCarry?1:0);a.FHalfCarry=a.FSubtract=!1;a.FZero=0==a.registerB},function(a){a.FCarry=127<a.registerC;a.registerC=a.registerC<<1&255|(a.FCarry?1:0);a.FHalfCarry=a.FSubtract=!1;a.FZero=0==a.registerC},function(a){a.FCarry=127<a.registerD;a.registerD=a.registerD<<1&255|(a.FCarry?1:0);a.FHalfCarry=a.FSubtract=!1;a.FZero=0==a.registerD},function(a){a.FCarry=127<a.registerE;a.registerE=a.registerE<<1&
255|(a.FCarry?1:0);a.FHalfCarry=a.FSubtract=!1;a.FZero=0==a.registerE},function(a){a.FCarry=32767<a.registersHL;a.registersHL=a.registersHL<<1&65024|(a.FCarry?256:0)|a.registersHL&255;a.FHalfCarry=a.FSubtract=!1;a.FZero=256>a.registersHL},function(a){a.FCarry=128==(a.registersHL&128);a.registersHL=a.registersHL&65280|a.registersHL<<1&255|(a.FCarry?1:0);a.FHalfCarry=a.FSubtract=!1;a.FZero=0==(a.registersHL&255)},function(a){var b=a.memoryReader[a.registersHL](a,a.registersHL);a.FCarry=127<b;b=b<<1&
255|(a.FCarry?1:0);a.memoryWriter[a.registersHL](a,a.registersHL,b);a.FHalfCarry=a.FSubtract=!1;a.FZero=0==b},function(a){a.FCarry=127<a.registerA;a.registerA=a.registerA<<1&255|(a.FCarry?1:0);a.FHalfCarry=a.FSubtract=!1;a.FZero=0==a.registerA},function(a){a.FCarry=1==(a.registerB&1);a.registerB=(a.FCarry?128:0)|a.registerB>>1;a.FHalfCarry=a.FSubtract=!1;a.FZero=0==a.registerB},function(a){a.FCarry=1==(a.registerC&1);a.registerC=(a.FCarry?128:0)|a.registerC>>1;a.FHalfCarry=a.FSubtract=!1;a.FZero=
0==a.registerC},function(a){a.FCarry=1==(a.registerD&1);a.registerD=(a.FCarry?128:0)|a.registerD>>1;a.FHalfCarry=a.FSubtract=!1;a.FZero=0==a.registerD},function(a){a.FCarry=1==(a.registerE&1);a.registerE=(a.FCarry?128:0)|a.registerE>>1;a.FHalfCarry=a.FSubtract=!1;a.FZero=0==a.registerE},function(a){a.FCarry=256==(a.registersHL&256);a.registersHL=(a.FCarry?32768:0)|a.registersHL>>1&65280|a.registersHL&255;a.FHalfCarry=a.FSubtract=!1;a.FZero=256>a.registersHL},function(a){a.FCarry=1==(a.registersHL&
1);a.registersHL=a.registersHL&65280|(a.FCarry?128:0)|(a.registersHL&255)>>1;a.FHalfCarry=a.FSubtract=!1;a.FZero=0==(a.registersHL&255)},function(a){var b=a.memoryReader[a.registersHL](a,a.registersHL);a.FCarry=1==(b&1);b=(a.FCarry?128:0)|b>>1;a.memoryWriter[a.registersHL](a,a.registersHL,b);a.FHalfCarry=a.FSubtract=!1;a.FZero=0==b},function(a){a.FCarry=1==(a.registerA&1);a.registerA=(a.FCarry?128:0)|a.registerA>>1;a.FHalfCarry=a.FSubtract=!1;a.FZero=0==a.registerA},function(a){var b=127<a.registerB;
a.registerB=a.registerB<<1&255|(a.FCarry?1:0);a.FCarry=b;a.FHalfCarry=a.FSubtract=!1;a.FZero=0==a.registerB},function(a){var b=127<a.registerC;a.registerC=a.registerC<<1&255|(a.FCarry?1:0);a.FCarry=b;a.FHalfCarry=a.FSubtract=!1;a.FZero=0==a.registerC},function(a){var b=127<a.registerD;a.registerD=a.registerD<<1&255|(a.FCarry?1:0);a.FCarry=b;a.FHalfCarry=a.FSubtract=!1;a.FZero=0==a.registerD},function(a){var b=127<a.registerE;a.registerE=a.registerE<<1&255|(a.FCarry?1:0);a.FCarry=b;a.FHalfCarry=a.FSubtract=
!1;a.FZero=0==a.registerE},function(a){var b=32767<a.registersHL;a.registersHL=a.registersHL<<1&65024|(a.FCarry?256:0)|a.registersHL&255;a.FCarry=b;a.FHalfCarry=a.FSubtract=!1;a.FZero=256>a.registersHL},function(a){var b=128==(a.registersHL&128);a.registersHL=a.registersHL&65280|a.registersHL<<1&255|(a.FCarry?1:0);a.FCarry=b;a.FHalfCarry=a.FSubtract=!1;a.FZero=0==(a.registersHL&255)},function(a){var b=a.memoryReader[a.registersHL](a,a.registersHL),c=127<b,b=b<<1&255|(a.FCarry?1:0);a.FCarry=c;a.memoryWriter[a.registersHL](a,
a.registersHL,b);a.FHalfCarry=a.FSubtract=!1;a.FZero=0==b},function(a){var b=127<a.registerA;a.registerA=a.registerA<<1&255|(a.FCarry?1:0);a.FCarry=b;a.FHalfCarry=a.FSubtract=!1;a.FZero=0==a.registerA},function(a){var b=1==(a.registerB&1);a.registerB=(a.FCarry?128:0)|a.registerB>>1;a.FCarry=b;a.FHalfCarry=a.FSubtract=!1;a.FZero=0==a.registerB},function(a){var b=1==(a.registerC&1);a.registerC=(a.FCarry?128:0)|a.registerC>>1;a.FCarry=b;a.FHalfCarry=a.FSubtract=!1;a.FZero=0==a.registerC},function(a){var b=
1==(a.registerD&1);a.registerD=(a.FCarry?128:0)|a.registerD>>1;a.FCarry=b;a.FHalfCarry=a.FSubtract=!1;a.FZero=0==a.registerD},function(a){var b=1==(a.registerE&1);a.registerE=(a.FCarry?128:0)|a.registerE>>1;a.FCarry=b;a.FHalfCarry=a.FSubtract=!1;a.FZero=0==a.registerE},function(a){var b=256==(a.registersHL&256);a.registersHL=(a.FCarry?32768:0)|a.registersHL>>1&65280|a.registersHL&255;a.FCarry=b;a.FHalfCarry=a.FSubtract=!1;a.FZero=256>a.registersHL},function(a){var b=1==(a.registersHL&1);a.registersHL=
a.registersHL&65280|(a.FCarry?128:0)|(a.registersHL&255)>>1;a.FCarry=b;a.FHalfCarry=a.FSubtract=!1;a.FZero=0==(a.registersHL&255)},function(a){var b=a.memoryReader[a.registersHL](a,a.registersHL),c=1==(b&1),b=(a.FCarry?128:0)|b>>1;a.FCarry=c;a.memoryWriter[a.registersHL](a,a.registersHL,b);a.FHalfCarry=a.FSubtract=!1;a.FZero=0==b},function(a){var b=1==(a.registerA&1);a.registerA=(a.FCarry?128:0)|a.registerA>>1;a.FCarry=b;a.FHalfCarry=a.FSubtract=!1;a.FZero=0==a.registerA},function(a){a.FCarry=127<
a.registerB;a.registerB=a.registerB<<1&255;a.FHalfCarry=a.FSubtract=!1;a.FZero=0==a.registerB},function(a){a.FCarry=127<a.registerC;a.registerC=a.registerC<<1&255;a.FHalfCarry=a.FSubtract=!1;a.FZero=0==a.registerC},function(a){a.FCarry=127<a.registerD;a.registerD=a.registerD<<1&255;a.FHalfCarry=a.FSubtract=!1;a.FZero=0==a.registerD},function(a){a.FCarry=127<a.registerE;a.registerE=a.registerE<<1&255;a.FHalfCarry=a.FSubtract=!1;a.FZero=0==a.registerE},function(a){a.FCarry=32767<a.registersHL;a.registersHL=
a.registersHL<<1&65024|a.registersHL&255;a.FHalfCarry=a.FSubtract=!1;a.FZero=256>a.registersHL},function(a){a.FCarry=128==(a.registersHL&128);a.registersHL=a.registersHL&65280|a.registersHL<<1&255;a.FHalfCarry=a.FSubtract=!1;a.FZero=0==(a.registersHL&255)},function(a){var b=a.memoryReader[a.registersHL](a,a.registersHL);a.FCarry=127<b;b=b<<1&255;a.memoryWriter[a.registersHL](a,a.registersHL,b);a.FHalfCarry=a.FSubtract=!1;a.FZero=0==b},function(a){a.FCarry=127<a.registerA;a.registerA=a.registerA<<
1&255;a.FHalfCarry=a.FSubtract=!1;a.FZero=0==a.registerA},function(a){a.FCarry=1==(a.registerB&1);a.registerB=a.registerB&128|a.registerB>>1;a.FHalfCarry=a.FSubtract=!1;a.FZero=0==a.registerB},function(a){a.FCarry=1==(a.registerC&1);a.registerC=a.registerC&128|a.registerC>>1;a.FHalfCarry=a.FSubtract=!1;a.FZero=0==a.registerC},function(a){a.FCarry=1==(a.registerD&1);a.registerD=a.registerD&128|a.registerD>>1;a.FHalfCarry=a.FSubtract=!1;a.FZero=0==a.registerD},function(a){a.FCarry=1==(a.registerE&1);
a.registerE=a.registerE&128|a.registerE>>1;a.FHalfCarry=a.FSubtract=!1;a.FZero=0==a.registerE},function(a){a.FCarry=256==(a.registersHL&256);a.registersHL=a.registersHL>>1&65280|a.registersHL&33023;a.FHalfCarry=a.FSubtract=!1;a.FZero=256>a.registersHL},function(a){a.FCarry=1==(a.registersHL&1);a.registersHL=a.registersHL&65408|(a.registersHL&255)>>1;a.FHalfCarry=a.FSubtract=!1;a.FZero=0==(a.registersHL&255)},function(a){var b=a.memoryReader[a.registersHL](a,a.registersHL);a.FCarry=1==(b&1);b=b&128|
b>>1;a.memoryWriter[a.registersHL](a,a.registersHL,b);a.FHalfCarry=a.FSubtract=!1;a.FZero=0==b},function(a){a.FCarry=1==(a.registerA&1);a.registerA=a.registerA&128|a.registerA>>1;a.FHalfCarry=a.FSubtract=!1;a.FZero=0==a.registerA},function(a){a.registerB=(a.registerB&15)<<4|a.registerB>>4;a.FZero=0==a.registerB;a.FCarry=a.FHalfCarry=a.FSubtract=!1},function(a){a.registerC=(a.registerC&15)<<4|a.registerC>>4;a.FZero=0==a.registerC;a.FCarry=a.FHalfCarry=a.FSubtract=!1},function(a){a.registerD=(a.registerD&
15)<<4|a.registerD>>4;a.FZero=0==a.registerD;a.FCarry=a.FHalfCarry=a.FSubtract=!1},function(a){a.registerE=(a.registerE&15)<<4|a.registerE>>4;a.FZero=0==a.registerE;a.FCarry=a.FHalfCarry=a.FSubtract=!1},function(a){a.registersHL=(a.registersHL&3840)<<4|(a.registersHL&61440)>>4|a.registersHL&255;a.FZero=256>a.registersHL;a.FCarry=a.FHalfCarry=a.FSubtract=!1},function(a){a.registersHL=a.registersHL&65280|(a.registersHL&15)<<4|(a.registersHL&240)>>4;a.FZero=0==(a.registersHL&255);a.FCarry=a.FHalfCarry=
a.FSubtract=!1},function(a){var b=a.memoryReader[a.registersHL](a,a.registersHL),b=(b&15)<<4|b>>4;a.memoryWriter[a.registersHL](a,a.registersHL,b);a.FZero=0==b;a.FCarry=a.FHalfCarry=a.FSubtract=!1},function(a){a.registerA=(a.registerA&15)<<4|a.registerA>>4;a.FZero=0==a.registerA;a.FCarry=a.FHalfCarry=a.FSubtract=!1},function(a){a.FCarry=1==(a.registerB&1);a.registerB>>=1;a.FHalfCarry=a.FSubtract=!1;a.FZero=0==a.registerB},function(a){a.FCarry=1==(a.registerC&1);a.registerC>>=1;a.FHalfCarry=a.FSubtract=
!1;a.FZero=0==a.registerC},function(a){a.FCarry=1==(a.registerD&1);a.registerD>>=1;a.FHalfCarry=a.FSubtract=!1;a.FZero=0==a.registerD},function(a){a.FCarry=1==(a.registerE&1);a.registerE>>=1;a.FHalfCarry=a.FSubtract=!1;a.FZero=0==a.registerE},function(a){a.FCarry=256==(a.registersHL&256);a.registersHL=a.registersHL>>1&65280|a.registersHL&255;a.FHalfCarry=a.FSubtract=!1;a.FZero=256>a.registersHL},function(a){a.FCarry=1==(a.registersHL&1);a.registersHL=a.registersHL&65280|(a.registersHL&255)>>1;a.FHalfCarry=
a.FSubtract=!1;a.FZero=0==(a.registersHL&255)},function(a){var b=a.memoryReader[a.registersHL](a,a.registersHL);a.FCarry=1==(b&1);a.memoryWriter[a.registersHL](a,a.registersHL,b>>1);a.FHalfCarry=a.FSubtract=!1;a.FZero=2>b},function(a){a.FCarry=1==(a.registerA&1);a.registerA>>=1;a.FHalfCarry=a.FSubtract=!1;a.FZero=0==a.registerA},function(a){a.FHalfCarry=!0;a.FSubtract=!1;a.FZero=0==(a.registerB&1)},function(a){a.FHalfCarry=!0;a.FSubtract=!1;a.FZero=0==(a.registerC&1)},function(a){a.FHalfCarry=!0;
a.FSubtract=!1;a.FZero=0==(a.registerD&1)},function(a){a.FHalfCarry=!0;a.FSubtract=!1;a.FZero=0==(a.registerE&1)},function(a){a.FHalfCarry=!0;a.FSubtract=!1;a.FZero=0==(a.registersHL&256)},function(a){a.FHalfCarry=!0;a.FSubtract=!1;a.FZero=0==(a.registersHL&1)},function(a){a.FHalfCarry=!0;a.FSubtract=!1;a.FZero=0==(a.memoryReader[a.registersHL](a,a.registersHL)&1)},function(a){a.FHalfCarry=!0;a.FSubtract=!1;a.FZero=0==(a.registerA&1)},function(a){a.FHalfCarry=!0;a.FSubtract=!1;a.FZero=0==(a.registerB&
2)},function(a){a.FHalfCarry=!0;a.FSubtract=!1;a.FZero=0==(a.registerC&2)},function(a){a.FHalfCarry=!0;a.FSubtract=!1;a.FZero=0==(a.registerD&2)},function(a){a.FHalfCarry=!0;a.FSubtract=!1;a.FZero=0==(a.registerE&2)},function(a){a.FHalfCarry=!0;a.FSubtract=!1;a.FZero=0==(a.registersHL&512)},function(a){a.FHalfCarry=!0;a.FSubtract=!1;a.FZero=0==(a.registersHL&2)},function(a){a.FHalfCarry=!0;a.FSubtract=!1;a.FZero=0==(a.memoryReader[a.registersHL](a,a.registersHL)&2)},function(a){a.FHalfCarry=!0;a.FSubtract=
!1;a.FZero=0==(a.registerA&2)},function(a){a.FHalfCarry=!0;a.FSubtract=!1;a.FZero=0==(a.registerB&4)},function(a){a.FHalfCarry=!0;a.FSubtract=!1;a.FZero=0==(a.registerC&4)},function(a){a.FHalfCarry=!0;a.FSubtract=!1;a.FZero=0==(a.registerD&4)},function(a){a.FHalfCarry=!0;a.FSubtract=!1;a.FZero=0==(a.registerE&4)},function(a){a.FHalfCarry=!0;a.FSubtract=!1;a.FZero=0==(a.registersHL&1024)},function(a){a.FHalfCarry=!0;a.FSubtract=!1;a.FZero=0==(a.registersHL&4)},function(a){a.FHalfCarry=!0;a.FSubtract=
!1;a.FZero=0==(a.memoryReader[a.registersHL](a,a.registersHL)&4)},function(a){a.FHalfCarry=!0;a.FSubtract=!1;a.FZero=0==(a.registerA&4)},function(a){a.FHalfCarry=!0;a.FSubtract=!1;a.FZero=0==(a.registerB&8)},function(a){a.FHalfCarry=!0;a.FSubtract=!1;a.FZero=0==(a.registerC&8)},function(a){a.FHalfCarry=!0;a.FSubtract=!1;a.FZero=0==(a.registerD&8)},function(a){a.FHalfCarry=!0;a.FSubtract=!1;a.FZero=0==(a.registerE&8)},function(a){a.FHalfCarry=!0;a.FSubtract=!1;a.FZero=0==(a.registersHL&2048)},function(a){a.FHalfCarry=
!0;a.FSubtract=!1;a.FZero=0==(a.registersHL&8)},function(a){a.FHalfCarry=!0;a.FSubtract=!1;a.FZero=0==(a.memoryReader[a.registersHL](a,a.registersHL)&8)},function(a){a.FHalfCarry=!0;a.FSubtract=!1;a.FZero=0==(a.registerA&8)},function(a){a.FHalfCarry=!0;a.FSubtract=!1;a.FZero=0==(a.registerB&16)},function(a){a.FHalfCarry=!0;a.FSubtract=!1;a.FZero=0==(a.registerC&16)},function(a){a.FHalfCarry=!0;a.FSubtract=!1;a.FZero=0==(a.registerD&16)},function(a){a.FHalfCarry=!0;a.FSubtract=!1;a.FZero=0==(a.registerE&
16)},function(a){a.FHalfCarry=!0;a.FSubtract=!1;a.FZero=0==(a.registersHL&4096)},function(a){a.FHalfCarry=!0;a.FSubtract=!1;a.FZero=0==(a.registersHL&16)},function(a){a.FHalfCarry=!0;a.FSubtract=!1;a.FZero=0==(a.memoryReader[a.registersHL](a,a.registersHL)&16)},function(a){a.FHalfCarry=!0;a.FSubtract=!1;a.FZero=0==(a.registerA&16)},function(a){a.FHalfCarry=!0;a.FSubtract=!1;a.FZero=0==(a.registerB&32)},function(a){a.FHalfCarry=!0;a.FSubtract=!1;a.FZero=0==(a.registerC&32)},function(a){a.FHalfCarry=
!0;a.FSubtract=!1;a.FZero=0==(a.registerD&32)},function(a){a.FHalfCarry=!0;a.FSubtract=!1;a.FZero=0==(a.registerE&32)},function(a){a.FHalfCarry=!0;a.FSubtract=!1;a.FZero=0==(a.registersHL&8192)},function(a){a.FHalfCarry=!0;a.FSubtract=!1;a.FZero=0==(a.registersHL&32)},function(a){a.FHalfCarry=!0;a.FSubtract=!1;a.FZero=0==(a.memoryReader[a.registersHL](a,a.registersHL)&32)},function(a){a.FHalfCarry=!0;a.FSubtract=!1;a.FZero=0==(a.registerA&32)},function(a){a.FHalfCarry=!0;a.FSubtract=!1;a.FZero=0==
(a.registerB&64)},function(a){a.FHalfCarry=!0;a.FSubtract=!1;a.FZero=0==(a.registerC&64)},function(a){a.FHalfCarry=!0;a.FSubtract=!1;a.FZero=0==(a.registerD&64)},function(a){a.FHalfCarry=!0;a.FSubtract=!1;a.FZero=0==(a.registerE&64)},function(a){a.FHalfCarry=!0;a.FSubtract=!1;a.FZero=0==(a.registersHL&16384)},function(a){a.FHalfCarry=!0;a.FSubtract=!1;a.FZero=0==(a.registersHL&64)},function(a){a.FHalfCarry=!0;a.FSubtract=!1;a.FZero=0==(a.memoryReader[a.registersHL](a,a.registersHL)&64)},function(a){a.FHalfCarry=
!0;a.FSubtract=!1;a.FZero=0==(a.registerA&64)},function(a){a.FHalfCarry=!0;a.FSubtract=!1;a.FZero=0==(a.registerB&128)},function(a){a.FHalfCarry=!0;a.FSubtract=!1;a.FZero=0==(a.registerC&128)},function(a){a.FHalfCarry=!0;a.FSubtract=!1;a.FZero=0==(a.registerD&128)},function(a){a.FHalfCarry=!0;a.FSubtract=!1;a.FZero=0==(a.registerE&128)},function(a){a.FHalfCarry=!0;a.FSubtract=!1;a.FZero=0==(a.registersHL&32768)},function(a){a.FHalfCarry=!0;a.FSubtract=!1;a.FZero=0==(a.registersHL&128)},function(a){a.FHalfCarry=
!0;a.FSubtract=!1;a.FZero=0==(a.memoryReader[a.registersHL](a,a.registersHL)&128)},function(a){a.FHalfCarry=!0;a.FSubtract=!1;a.FZero=0==(a.registerA&128)},function(a){a.registerB&=254},function(a){a.registerC&=254},function(a){a.registerD&=254},function(a){a.registerE&=254},function(a){a.registersHL&=65279},function(a){a.registersHL&=65534},function(a){a.memoryWriter[a.registersHL](a,a.registersHL,a.memoryReader[a.registersHL](a,a.registersHL)&254)},function(a){a.registerA&=254},function(a){a.registerB&=
253},function(a){a.registerC&=253},function(a){a.registerD&=253},function(a){a.registerE&=253},function(a){a.registersHL&=65023},function(a){a.registersHL&=65533},function(a){a.memoryWriter[a.registersHL](a,a.registersHL,a.memoryReader[a.registersHL](a,a.registersHL)&253)},function(a){a.registerA&=253},function(a){a.registerB&=251},function(a){a.registerC&=251},function(a){a.registerD&=251},function(a){a.registerE&=251},function(a){a.registersHL&=64511},function(a){a.registersHL&=65531},function(a){a.memoryWriter[a.registersHL](a,
a.registersHL,a.memoryReader[a.registersHL](a,a.registersHL)&251)},function(a){a.registerA&=251},function(a){a.registerB&=247},function(a){a.registerC&=247},function(a){a.registerD&=247},function(a){a.registerE&=247},function(a){a.registersHL&=63487},function(a){a.registersHL&=65527},function(a){a.memoryWriter[a.registersHL](a,a.registersHL,a.memoryReader[a.registersHL](a,a.registersHL)&247)},function(a){a.registerA&=247},function(a){a.registerB&=239},function(a){a.registerC&=239},function(a){a.registerD&=
239},function(a){a.registerE&=239},function(a){a.registersHL&=61439},function(a){a.registersHL&=65519},function(a){a.memoryWriter[a.registersHL](a,a.registersHL,a.memoryReader[a.registersHL](a,a.registersHL)&239)},function(a){a.registerA&=239},function(a){a.registerB&=223},function(a){a.registerC&=223},function(a){a.registerD&=223},function(a){a.registerE&=223},function(a){a.registersHL&=57343},function(a){a.registersHL&=65503},function(a){a.memoryWriter[a.registersHL](a,a.registersHL,a.memoryReader[a.registersHL](a,
a.registersHL)&223)},function(a){a.registerA&=223},function(a){a.registerB&=191},function(a){a.registerC&=191},function(a){a.registerD&=191},function(a){a.registerE&=191},function(a){a.registersHL&=49151},function(a){a.registersHL&=65471},function(a){a.memoryWriter[a.registersHL](a,a.registersHL,a.memoryReader[a.registersHL](a,a.registersHL)&191)},function(a){a.registerA&=191},function(a){a.registerB&=127},function(a){a.registerC&=127},function(a){a.registerD&=127},function(a){a.registerE&=127},function(a){a.registersHL&=
32767},function(a){a.registersHL&=65407},function(a){a.memoryWriter[a.registersHL](a,a.registersHL,a.memoryReader[a.registersHL](a,a.registersHL)&127)},function(a){a.registerA&=127},function(a){a.registerB|=1},function(a){a.registerC|=1},function(a){a.registerD|=1},function(a){a.registerE|=1},function(a){a.registersHL|=256},function(a){a.registersHL|=1},function(a){a.memoryWriter[a.registersHL](a,a.registersHL,a.memoryReader[a.registersHL](a,a.registersHL)|1)},function(a){a.registerA|=1},function(a){a.registerB|=
2},function(a){a.registerC|=2},function(a){a.registerD|=2},function(a){a.registerE|=2},function(a){a.registersHL|=512},function(a){a.registersHL|=2},function(a){a.memoryWriter[a.registersHL](a,a.registersHL,a.memoryReader[a.registersHL](a,a.registersHL)|2)},function(a){a.registerA|=2},function(a){a.registerB|=4},function(a){a.registerC|=4},function(a){a.registerD|=4},function(a){a.registerE|=4},function(a){a.registersHL|=1024},function(a){a.registersHL|=4},function(a){a.memoryWriter[a.registersHL](a,
a.registersHL,a.memoryReader[a.registersHL](a,a.registersHL)|4)},function(a){a.registerA|=4},function(a){a.registerB|=8},function(a){a.registerC|=8},function(a){a.registerD|=8},function(a){a.registerE|=8},function(a){a.registersHL|=2048},function(a){a.registersHL|=8},function(a){a.memoryWriter[a.registersHL](a,a.registersHL,a.memoryReader[a.registersHL](a,a.registersHL)|8)},function(a){a.registerA|=8},function(a){a.registerB|=16},function(a){a.registerC|=16},function(a){a.registerD|=16},function(a){a.registerE|=
16},function(a){a.registersHL|=4096},function(a){a.registersHL|=16},function(a){a.memoryWriter[a.registersHL](a,a.registersHL,a.memoryReader[a.registersHL](a,a.registersHL)|16)},function(a){a.registerA|=16},function(a){a.registerB|=32},function(a){a.registerC|=32},function(a){a.registerD|=32},function(a){a.registerE|=32},function(a){a.registersHL|=8192},function(a){a.registersHL|=32},function(a){a.memoryWriter[a.registersHL](a,a.registersHL,a.memoryReader[a.registersHL](a,a.registersHL)|32)},function(a){a.registerA|=
32},function(a){a.registerB|=64},function(a){a.registerC|=64},function(a){a.registerD|=64},function(a){a.registerE|=64},function(a){a.registersHL|=16384},function(a){a.registersHL|=64},function(a){a.memoryWriter[a.registersHL](a,a.registersHL,a.memoryReader[a.registersHL](a,a.registersHL)|64)},function(a){a.registerA|=64},function(a){a.registerB|=128},function(a){a.registerC|=128},function(a){a.registerD|=128},function(a){a.registerE|=128},function(a){a.registersHL|=32768},function(a){a.registersHL|=
128},function(a){a.memoryWriter[a.registersHL](a,a.registersHL,a.memoryReader[a.registersHL](a,a.registersHL)|128)},function(a){a.registerA|=128}];
GameBoyCore.prototype.TICKTable=[4,12,8,8,4,4,8,4,20,8,8,8,4,4,8,4,4,12,8,8,4,4,8,4,12,8,8,8,4,4,8,4,8,12,8,8,4,4,8,4,8,8,8,8,4,4,8,4,8,12,8,8,12,12,12,4,8,8,8,8,4,4,8,4,4,4,4,4,4,4,8,4,4,4,4,4,4,4,8,4,4,4,4,4,4,4,8,4,4,4,4,4,4,4,8,4,4,4,4,4,4,4,8,4,4,4,4,4,4,4,8,4,8,8,8,8,8,8,4,8,4,4,4,4,4,4,8,4,4,4,4,4,4,4,8,4,4,4,4,4,4,4,8,4,4,4,4,4,4,4,8,4,4,4,4,4,4,4,8,4,4,4,4,4,4,4,8,4,4,4,4,4,4,4,8,4,4,4,4,4,4,4,8,4,4,4,4,4,4,4,8,4,8,12,12,16,12,16,8,16,8,16,12,0,12,24,8,16,8,12,12,4,12,16,8,16,8,16,12,4,12,
4,8,16,12,12,8,4,4,16,8,16,16,4,16,4,4,4,8,16,12,12,8,4,4,16,8,16,12,8,16,4,0,4,8,16];
GameBoyCore.prototype.SecondaryTICKTable=[8,8,8,8,8,8,16,8,8,8,8,8,8,8,16,8,8,8,8,8,8,8,16,8,8,8,8,8,8,8,16,8,8,8,8,8,8,8,16,8,8,8,8,8,8,8,16,8,8,8,8,8,8,8,16,8,8,8,8,8,8,8,16,8,8,8,8,8,8,8,12,8,8,8,8,8,8,8,12,8,8,8,8,8,8,8,12,8,8,8,8,8,8,8,12,8,8,8,8,8,8,8,12,8,8,8,8,8,8,8,12,8,8,8,8,8,8,8,12,8,8,8,8,8,8,8,12,8,8,8,8,8,8,8,16,8,8,8,8,8,8,8,16,8,8,8,8,8,8,8,16,8,8,8,8,8,8,8,16,8,8,8,8,8,8,8,16,8,8,8,8,8,8,8,16,8,8,8,8,8,8,8,16,8,8,8,8,8,8,8,16,8,8,8,8,8,8,8,16,8,8,8,8,8,8,8,16,8,8,8,8,8,8,8,16,8,
8,8,8,8,8,8,16,8,8,8,8,8,8,8,16,8,8,8,8,8,8,8,16,8,8,8,8,8,8,8,16,8,8,8,8,8,8,8,16,8];GameBoyCore.prototype.saveSRAMState=function(){return!this.cBATT||0==this.MBCRam.length?[]:this.fromTypedArray(this.MBCRam)};
GameBoyCore.prototype.saveRTCState=function(){return this.cTIMER?[this.lastIteration,this.RTCisLatched,this.latchedSeconds,this.latchedMinutes,this.latchedHours,this.latchedLDays,this.latchedHDays,this.RTCSeconds,this.RTCMinutes,this.RTCHours,this.RTCDays,this.RTCDayOverFlow,this.RTCHALT]:[]};
GameBoyCore.prototype.saveState=function(){return[this.fromTypedArray(this.ROM),this.inBootstrap,this.registerA,this.FZero,this.FSubtract,this.FHalfCarry,this.FCarry,this.registerB,this.registerC,this.registerD,this.registerE,this.registersHL,this.stackPointer,this.programCounter,this.halt,this.IME,this.hdmaRunning,this.CPUTicks,this.doubleSpeedShifter,this.fromTypedArray(this.memory),this.fromTypedArray(this.MBCRam),this.fromTypedArray(this.VRAM),this.currVRAMBank,this.fromTypedArray(this.GBCMemory),
this.MBC1Mode,this.MBCRAMBanksEnabled,this.currMBCRAMBank,this.currMBCRAMBankPosition,this.cGBC,this.gbcRamBank,this.gbcRamBankPosition,this.ROMBank1offs,this.currentROMBank,this.cartridgeType,this.name,this.gameCode,this.modeSTAT,this.LYCMatchTriggerSTAT,this.mode2TriggerSTAT,this.mode1TriggerSTAT,this.mode0TriggerSTAT,this.LCDisOn,this.gfxWindowCHRBankPosition,this.gfxWindowDisplay,this.gfxSpriteShow,this.gfxSpriteNormalHeight,this.gfxBackgroundCHRBankPosition,this.gfxBackgroundBankOffset,this.TIMAEnabled,
this.DIVTicks,this.LCDTicks,this.timerTicks,this.TACClocker,this.serialTimer,this.serialShiftTimer,this.serialShiftTimerAllocated,this.IRQEnableDelay,this.lastIteration,this.cMBC1,this.cMBC2,this.cMBC3,this.cMBC5,this.cMBC7,this.cSRAM,this.cMMMO1,this.cRUMBLE,this.cCamera,this.cTAMA5,this.cHuC3,this.cHuC1,this.drewBlank,this.fromTypedArray(this.frameBuffer),this.bgEnabled,this.BGPriorityEnabled,this.channel1FrequencyTracker,this.channel1FrequencyCounter,this.channel1totalLength,this.channel1envelopeVolume,
this.channel1envelopeType,this.channel1envelopeSweeps,this.channel1envelopeSweepsLast,this.channel1consecutive,this.channel1frequency,this.channel1SweepFault,this.channel1ShadowFrequency,this.channel1timeSweep,this.channel1lastTimeSweep,this.channel1Swept,this.channel1frequencySweepDivider,this.channel1decreaseSweep,this.channel2FrequencyTracker,this.channel2FrequencyCounter,this.channel2totalLength,this.channel2envelopeVolume,this.channel2envelopeType,this.channel2envelopeSweeps,this.channel2envelopeSweepsLast,
this.channel2consecutive,this.channel2frequency,this.channel3canPlay,this.channel3totalLength,this.channel3patternType,this.channel3frequency,this.channel3consecutive,this.fromTypedArray(this.channel3PCM),this.channel4FrequencyPeriod,this.channel4lastSampleLookup,this.channel4totalLength,this.channel4envelopeVolume,this.channel4currentVolume,this.channel4envelopeType,this.channel4envelopeSweeps,this.channel4envelopeSweepsLast,this.channel4consecutive,this.channel4BitRange,this.soundMasterEnabled,
this.VinLeftChannelMasterVolume,this.VinRightChannelMasterVolume,this.leftChannel1,this.leftChannel2,this.leftChannel3,this.leftChannel4,this.rightChannel1,this.rightChannel2,this.rightChannel3,this.rightChannel4,this.channel1currentSampleLeft,this.channel1currentSampleRight,this.channel2currentSampleLeft,this.channel2currentSampleRight,this.channel3currentSampleLeft,this.channel3currentSampleRight,this.channel4currentSampleLeft,this.channel4currentSampleRight,this.channel1currentSampleLeftSecondary,
this.channel1currentSampleRightSecondary,this.channel2currentSampleLeftSecondary,this.channel2currentSampleRightSecondary,this.channel3currentSampleLeftSecondary,this.channel3currentSampleRightSecondary,this.channel4currentSampleLeftSecondary,this.channel4currentSampleRightSecondary,this.channel1currentSampleLeftTrimary,this.channel1currentSampleRightTrimary,this.channel2currentSampleLeftTrimary,this.channel2currentSampleRightTrimary,this.mixerOutputCache,this.channel1DutyTracker,this.channel1CachedDuty,
this.channel2DutyTracker,this.channel2CachedDuty,this.channel1Enabled,this.channel2Enabled,this.channel3Enabled,this.channel4Enabled,this.sequencerClocks,this.sequencePosition,this.channel3Counter,this.channel4Counter,this.cachedChannel3Sample,this.cachedChannel4Sample,this.channel3FrequencyPeriod,this.channel3lastSampleLookup,this.actualScanLine,this.lastUnrenderedLine,this.queuedScanLines,this.RTCisLatched,this.latchedSeconds,this.latchedMinutes,this.latchedHours,this.latchedLDays,this.latchedHDays,
this.RTCSeconds,this.RTCMinutes,this.RTCHours,this.RTCDays,this.RTCDayOverFlow,this.RTCHALT,this.usedBootROM,this.skipPCIncrement,this.STATTracker,this.gbcRamBankPositionECHO,this.numRAMBanks,this.windowY,this.windowX,this.fromTypedArray(this.gbcOBJRawPalette),this.fromTypedArray(this.gbcBGRawPalette),this.fromTypedArray(this.gbOBJPalette),this.fromTypedArray(this.gbBGPalette),this.fromTypedArray(this.gbcOBJPalette),this.fromTypedArray(this.gbcBGPalette),this.fromTypedArray(this.gbBGColorizedPalette),
this.fromTypedArray(this.gbOBJColorizedPalette),this.fromTypedArray(this.cachedBGPaletteConversion),this.fromTypedArray(this.cachedOBJPaletteConversion),this.fromTypedArray(this.BGCHRBank1),this.fromTypedArray(this.BGCHRBank2),this.haltPostClocks,this.interruptsRequested,this.interruptsEnabled,this.remainingClocks,this.colorizedGBPalettes,this.backgroundY,this.backgroundX,this.CPUStopped,this.audioClocksUntilNextEvent,this.audioClocksUntilNextEventCounter]};
GameBoyCore.prototype.returnFromState=function(a){var b=0,a=a.slice(0);this.ROM=this.toTypedArray(a[b++],"uint8");this.ROMBankEdge=Math.floor(this.ROM.length/16384);this.inBootstrap=a[b++];this.registerA=a[b++];this.FZero=a[b++];this.FSubtract=a[b++];this.FHalfCarry=a[b++];this.FCarry=a[b++];this.registerB=a[b++];this.registerC=a[b++];this.registerD=a[b++];this.registerE=a[b++];this.registersHL=a[b++];this.stackPointer=a[b++];this.programCounter=a[b++];this.halt=a[b++];this.IME=a[b++];this.hdmaRunning=
a[b++];this.CPUTicks=a[b++];this.doubleSpeedShifter=a[b++];this.memory=this.toTypedArray(a[b++],"uint8");this.MBCRam=this.toTypedArray(a[b++],"uint8");this.VRAM=this.toTypedArray(a[b++],"uint8");this.currVRAMBank=a[b++];this.GBCMemory=this.toTypedArray(a[b++],"uint8");this.MBC1Mode=a[b++];this.MBCRAMBanksEnabled=a[b++];this.currMBCRAMBank=a[b++];this.currMBCRAMBankPosition=a[b++];this.cGBC=a[b++];this.gbcRamBank=a[b++];this.gbcRamBankPosition=a[b++];this.ROMBank1offs=a[b++];this.currentROMBank=a[b++];
this.cartridgeType=a[b++];this.name=a[b++];this.gameCode=a[b++];this.modeSTAT=a[b++];this.LYCMatchTriggerSTAT=a[b++];this.mode2TriggerSTAT=a[b++];this.mode1TriggerSTAT=a[b++];this.mode0TriggerSTAT=a[b++];this.LCDisOn=a[b++];this.gfxWindowCHRBankPosition=a[b++];this.gfxWindowDisplay=a[b++];this.gfxSpriteShow=a[b++];this.gfxSpriteNormalHeight=a[b++];this.gfxBackgroundCHRBankPosition=a[b++];this.gfxBackgroundBankOffset=a[b++];this.TIMAEnabled=a[b++];this.DIVTicks=a[b++];this.LCDTicks=a[b++];this.timerTicks=
a[b++];this.TACClocker=a[b++];this.serialTimer=a[b++];this.serialShiftTimer=a[b++];this.serialShiftTimerAllocated=a[b++];this.IRQEnableDelay=a[b++];this.lastIteration=a[b++];this.cMBC1=a[b++];this.cMBC2=a[b++];this.cMBC3=a[b++];this.cMBC5=a[b++];this.cMBC7=a[b++];this.cSRAM=a[b++];this.cMMMO1=a[b++];this.cRUMBLE=a[b++];this.cCamera=a[b++];this.cTAMA5=a[b++];this.cHuC3=a[b++];this.cHuC1=a[b++];this.drewBlank=a[b++];this.frameBuffer=this.toTypedArray(a[b++],"int32");this.bgEnabled=a[b++];this.BGPriorityEnabled=
a[b++];this.channel1FrequencyTracker=a[b++];this.channel1FrequencyCounter=a[b++];this.channel1totalLength=a[b++];this.channel1envelopeVolume=a[b++];this.channel1envelopeType=a[b++];this.channel1envelopeSweeps=a[b++];this.channel1envelopeSweepsLast=a[b++];this.channel1consecutive=a[b++];this.channel1frequency=a[b++];this.channel1SweepFault=a[b++];this.channel1ShadowFrequency=a[b++];this.channel1timeSweep=a[b++];this.channel1lastTimeSweep=a[b++];this.channel1Swept=a[b++];this.channel1frequencySweepDivider=
a[b++];this.channel1decreaseSweep=a[b++];this.channel2FrequencyTracker=a[b++];this.channel2FrequencyCounter=a[b++];this.channel2totalLength=a[b++];this.channel2envelopeVolume=a[b++];this.channel2envelopeType=a[b++];this.channel2envelopeSweeps=a[b++];this.channel2envelopeSweepsLast=a[b++];this.channel2consecutive=a[b++];this.channel2frequency=a[b++];this.channel3canPlay=a[b++];this.channel3totalLength=a[b++];this.channel3patternType=a[b++];this.channel3frequency=a[b++];this.channel3consecutive=a[b++];
this.channel3PCM=this.toTypedArray(a[b++],"int8");this.channel4FrequencyPeriod=a[b++];this.channel4lastSampleLookup=a[b++];this.channel4totalLength=a[b++];this.channel4envelopeVolume=a[b++];this.channel4currentVolume=a[b++];this.channel4envelopeType=a[b++];this.channel4envelopeSweeps=a[b++];this.channel4envelopeSweepsLast=a[b++];this.channel4consecutive=a[b++];this.channel4BitRange=a[b++];this.soundMasterEnabled=a[b++];this.VinLeftChannelMasterVolume=a[b++];this.VinRightChannelMasterVolume=a[b++];
this.leftChannel1=a[b++];this.leftChannel2=a[b++];this.leftChannel3=a[b++];this.leftChannel4=a[b++];this.rightChannel1=a[b++];this.rightChannel2=a[b++];this.rightChannel3=a[b++];this.rightChannel4=a[b++];this.channel1currentSampleLeft=a[b++];this.channel1currentSampleRight=a[b++];this.channel2currentSampleLeft=a[b++];this.channel2currentSampleRight=a[b++];this.channel3currentSampleLeft=a[b++];this.channel3currentSampleRight=a[b++];this.channel4currentSampleLeft=a[b++];this.channel4currentSampleRight=
a[b++];this.channel1currentSampleLeftSecondary=a[b++];this.channel1currentSampleRightSecondary=a[b++];this.channel2currentSampleLeftSecondary=a[b++];this.channel2currentSampleRightSecondary=a[b++];this.channel3currentSampleLeftSecondary=a[b++];this.channel3currentSampleRightSecondary=a[b++];this.channel4currentSampleLeftSecondary=a[b++];this.channel4currentSampleRightSecondary=a[b++];this.channel1currentSampleLeftTrimary=a[b++];this.channel1currentSampleRightTrimary=a[b++];this.channel2currentSampleLeftTrimary=
a[b++];this.channel2currentSampleRightTrimary=a[b++];this.mixerOutputCache=a[b++];this.channel1DutyTracker=a[b++];this.channel1CachedDuty=a[b++];this.channel2DutyTracker=a[b++];this.channel2CachedDuty=a[b++];this.channel1Enabled=a[b++];this.channel2Enabled=a[b++];this.channel3Enabled=a[b++];this.channel4Enabled=a[b++];this.sequencerClocks=a[b++];this.sequencePosition=a[b++];this.channel3Counter=a[b++];this.channel4Counter=a[b++];this.cachedChannel3Sample=a[b++];this.cachedChannel4Sample=a[b++];this.channel3FrequencyPeriod=
a[b++];this.channel3lastSampleLookup=a[b++];this.actualScanLine=a[b++];this.lastUnrenderedLine=a[b++];this.queuedScanLines=a[b++];this.RTCisLatched=a[b++];this.latchedSeconds=a[b++];this.latchedMinutes=a[b++];this.latchedHours=a[b++];this.latchedLDays=a[b++];this.latchedHDays=a[b++];this.RTCSeconds=a[b++];this.RTCMinutes=a[b++];this.RTCHours=a[b++];this.RTCDays=a[b++];this.RTCDayOverFlow=a[b++];this.RTCHALT=a[b++];this.usedBootROM=a[b++];this.skipPCIncrement=a[b++];this.STATTracker=a[b++];this.gbcRamBankPositionECHO=
a[b++];this.numRAMBanks=a[b++];this.windowY=a[b++];this.windowX=a[b++];this.gbcOBJRawPalette=this.toTypedArray(a[b++],"uint8");this.gbcBGRawPalette=this.toTypedArray(a[b++],"uint8");this.gbOBJPalette=this.toTypedArray(a[b++],"int32");this.gbBGPalette=this.toTypedArray(a[b++],"int32");this.gbcOBJPalette=this.toTypedArray(a[b++],"int32");this.gbcBGPalette=this.toTypedArray(a[b++],"int32");this.gbBGColorizedPalette=this.toTypedArray(a[b++],"int32");this.gbOBJColorizedPalette=this.toTypedArray(a[b++],
"int32");this.cachedBGPaletteConversion=this.toTypedArray(a[b++],"int32");this.cachedOBJPaletteConversion=this.toTypedArray(a[b++],"int32");this.BGCHRBank1=this.toTypedArray(a[b++],"uint8");this.BGCHRBank2=this.toTypedArray(a[b++],"uint8");this.haltPostClocks=a[b++];this.interruptsRequested=a[b++];this.interruptsEnabled=a[b++];this.checkIRQMatching();this.remainingClocks=a[b++];this.colorizedGBPalettes=a[b++];this.backgroundY=a[b++];this.backgroundX=a[b++];this.CPUStopped=a[b++];this.audioClocksUntilNextEvent=
a[b++];this.audioClocksUntilNextEventCounter=a[b];this.fromSaveState=!0;this.TICKTable=this.toTypedArray(this.TICKTable,"uint8");this.SecondaryTICKTable=this.toTypedArray(this.SecondaryTICKTable,"uint8");this.initializeReferencesFromSaveState();this.memoryReadJumpCompile();this.memoryWriteJumpCompile();this.initLCD();this.initSound();this.noiseSampleTable=32767==this.channel4BitRange?this.LSFR15Table:this.LSFR7Table;this.channel4VolumeShifter=32767==this.channel4BitRange?15:7};
GameBoyCore.prototype.returnFromRTCState=function(){if("function"==typeof this.openRTC&&this.cTIMER){var a=this.openRTC(this.name),b=0;this.lastIteration=a[b++];this.RTCisLatched=a[b++];this.latchedSeconds=a[b++];this.latchedMinutes=a[b++];this.latchedHours=a[b++];this.latchedLDays=a[b++];this.latchedHDays=a[b++];this.RTCSeconds=a[b++];this.RTCMinutes=a[b++];this.RTCHours=a[b++];this.RTCDays=a[b++];this.RTCDayOverFlow=a[b++];this.RTCHALT=a[b]}};
GameBoyCore.prototype.start=function(){this.initMemory();this.ROMLoad();this.initLCD();this.initSound();this.run()};GameBoyCore.prototype.initMemory=function(){this.memory=this.getTypedArray(65536,0,"uint8");this.frameBuffer=this.getTypedArray(23040,16316664,"int32");this.BGCHRBank1=this.getTypedArray(2048,0,"uint8");this.TICKTable=this.toTypedArray(this.TICKTable,"uint8");this.SecondaryTICKTable=this.toTypedArray(this.SecondaryTICKTable,"uint8");this.channel3PCM=this.getTypedArray(32,0,"int8")};
GameBoyCore.prototype.generateCacheArray=function(a){for(var b=[],c=0;c<a;)b[c++]=this.getTypedArray(64,0,"uint8");return b};
GameBoyCore.prototype.initSkipBootstrap=function(){for(var a=255;0<=a;){if(48<=a&&64>a)this.memoryWrite(65280|a,this.ffxxDump[a]);else switch(a){case 0:case 1:case 2:case 5:case 7:case 15:case 255:this.memoryWrite(65280|a,this.ffxxDump[a]);break;default:this.memory[65280|a]=this.ffxxDump[a]}--a}this.cGBC?(this.memory[65388]=254,this.memory[65396]=254):(this.memory[65352]=255,this.memory[65353]=255,this.memory[65388]=255,this.memory[65396]=255);cout("Starting without the GBC boot ROM.",0);this.registerA=
this.cGBC?17:1;this.registerB=0;this.registerC=19;this.registerD=0;this.registerE=216;this.FZero=!0;this.FSubtract=!1;this.FCarry=this.FHalfCarry=!0;this.registersHL=333;this.LCDCONTROL=this.LINECONTROL;this.IME=!1;this.IRQLineMatched=0;this.interruptsRequested=225;this.interruptsEnabled=0;this.hdmaRunning=!1;this.CPUTicks=12;this.STATTracker=0;this.modeSTAT=1;this.spriteCount=252;this.mode0TriggerSTAT=this.mode1TriggerSTAT=this.mode2TriggerSTAT=this.LYCMatchTriggerSTAT=!1;this.LCDisOn=!0;this.channel1FrequencyTracker=
8192;this.channel1DutyTracker=0;this.channel1CachedDuty=this.dutyLookup[2];this.channel1envelopeVolume=this.channel1totalLength=0;this.channel1envelopeType=!1;this.channel1envelopeSweepsLast=this.channel1envelopeSweeps=0;this.channel1consecutive=!0;this.channel1frequency=1985;this.channel1SweepFault=!0;this.channel1ShadowFrequency=1985;this.channel1timeSweep=1;this.channel1lastTimeSweep=0;this.channel1Swept=!1;this.channel1frequencySweepDivider=0;this.channel1decreaseSweep=!1;this.channel2FrequencyTracker=
8192;this.channel2DutyTracker=0;this.channel2CachedDuty=this.dutyLookup[2];this.channel2envelopeVolume=this.channel2totalLength=0;this.channel2envelopeType=!1;this.channel2envelopeSweepsLast=this.channel2envelopeSweeps=0;this.channel2consecutive=!0;this.channel2frequency=0;this.channel3canPlay=!1;this.channel3totalLength=0;this.channel3patternType=4;this.channel3frequency=0;this.channel3consecutive=!0;this.channel3Counter=1048;this.channel4FrequencyPeriod=8;this.channel4currentVolume=this.channel4envelopeVolume=
this.channel4totalLength=0;this.channel4envelopeType=!1;this.channel4envelopeSweepsLast=this.channel4envelopeSweeps=0;this.channel4consecutive=!0;this.channel4BitRange=32767;this.channel4VolumeShifter=15;this.channel2FrequencyCounter=this.channel1FrequencyCounter=512;this.channel3FrequencyPeriod=this.channel3Counter=2048;this.channel4lastSampleLookup=this.channel3lastSampleLookup=0;this.VinRightChannelMasterVolume=this.VinLeftChannelMasterVolume=8;this.rightChannel2=this.rightChannel1=this.leftChannel4=
this.leftChannel3=this.leftChannel2=this.leftChannel1=this.soundMasterEnabled=!0;this.rightChannel4=this.rightChannel3=!1;this.DIVTicks=27044;this.LCDTicks=160;this.timerTicks=0;this.TIMAEnabled=!1;this.TACClocker=1024;this.IRQEnableDelay=this.serialShiftTimerAllocated=this.serialShiftTimer=this.serialTimer=0;this.actualScanLine=144;this.lastUnrenderedLine=0;this.gfxSpriteShow=this.gfxWindowDisplay=!1;this.BGPriorityEnabled=this.bgEnabled=this.gfxSpriteNormalHeight=!0;this.drewBlank=this.windowX=
this.windowY=this.gfxBackgroundBankOffset=this.gfxBackgroundCHRBankPosition=this.gfxWindowCHRBankPosition=0;this.midScanlineOffset=-1;this.currentX=0};
GameBoyCore.prototype.initBootstrap=function(){cout("Starting the selected boot ROM.",0);this.stackPointer=this.programCounter=0;this.IME=!1;this.registerE=this.registerD=this.registerC=this.registerB=this.registerA=this.DIVTicks=this.LCDTicks=0;this.FZero=this.FSubtract=this.FHalfCarry=this.FCarry=!1;this.registersHL=0;this.rightChannel4=this.rightChannel3=this.rightChannel2=this.rightChannel1=this.leftChannel4=this.leftChannel3=this.leftChannel2=this.leftChannel1=!1;this.channel2frequency=this.channel1frequency=
0;this.channel4consecutive=this.channel2consecutive=this.channel1consecutive=!1;this.VinRightChannelMasterVolume=this.VinLeftChannelMasterVolume=8;this.memory[65280]=15};
GameBoyCore.prototype.ROMLoad=function(){this.ROM=[];this.usedBootROM=settings[1]&&(!settings[11]&&2048==this.GBCBOOTROM.length||settings[11]&&256==this.GBBOOTROM.length);var a=this.ROMImage.length;if(16384>a)throw Error("ROM image size too small.");this.ROM=this.getTypedArray(a,0,"uint8");var b=0;if(this.usedBootROM)if(settings[11])for(;256>b;++b)this.memory[b]=this.GBBOOTROM[b],this.ROM[b]=this.ROMImage.charCodeAt(b)&255;else{for(;256>b;++b)this.memory[b]=this.GBCBOOTROM[b],this.ROM[b]=this.ROMImage.charCodeAt(b)&
255;for(;512>b;++b)this.memory[b]=this.ROM[b]=this.ROMImage.charCodeAt(b)&255;for(;2304>b;++b)this.memory[b]=this.GBCBOOTROM[b-256],this.ROM[b]=this.ROMImage.charCodeAt(b)&255;this.usedGBCBootROM=!0}for(;16384>b;++b)this.memory[b]=this.ROM[b]=this.ROMImage.charCodeAt(b)&255;for(;b<a;++b)this.ROM[b]=this.ROMImage.charCodeAt(b)&255;this.ROMBankEdge=Math.floor(this.ROM.length/16384);this.interpretCartridge();this.checkIRQMatching()};
GameBoyCore.prototype.getROMImage=function(){if(0<this.ROMImage.length)return this.ROMImage.length;for(var a=this.ROM.length,b=0;b<a;b++)this.ROMImage+=String.fromCharCode(this.ROM[b]);return this.ROMImage};
GameBoyCore.prototype.interpretCartridge=function(){for(var a=308;319>a;a++)0<this.ROMImage.charCodeAt(a)&&(this.name+=this.ROMImage[a]);for(a=319;323>a;a++)0<this.ROMImage.charCodeAt(a)&&(this.gameCode+=this.ROMImage[a]);cout("Game Title: "+this.name+"["+this.gameCode+"]["+this.ROMImage[323]+"]",0);cout("Game Code: "+this.gameCode,0);this.cartridgeType=this.ROM[327];cout("Cartridge type #"+this.cartridgeType,0);a="";switch(this.cartridgeType){case 0:if(!settings[9]){a="ROM";break}case 1:this.cMBC1=
!0;a="MBC1";break;case 2:this.cSRAM=this.cMBC1=!0;a="MBC1 + SRAM";break;case 3:this.cBATT=this.cSRAM=this.cMBC1=!0;a="MBC1 + SRAM + BATT";break;case 5:this.cMBC2=!0;a="MBC2";break;case 6:this.cBATT=this.cMBC2=!0;a="MBC2 + BATT";break;case 8:this.cSRAM=!0;a="ROM + SRAM";break;case 9:this.cBATT=this.cSRAM=!0;a="ROM + SRAM + BATT";break;case 11:this.cMMMO1=!0;a="MMMO1";break;case 12:this.cSRAM=this.cMMMO1=!0;a="MMMO1 + SRAM";break;case 13:this.cBATT=this.cSRAM=this.cMMMO1=!0;a="MMMO1 + SRAM + BATT";
break;case 15:this.cBATT=this.cTIMER=this.cMBC3=!0;a="MBC3 + TIMER + BATT";break;case 16:this.cSRAM=this.cBATT=this.cTIMER=this.cMBC3=!0;a="MBC3 + TIMER + BATT + SRAM";break;case 17:this.cMBC3=!0;a="MBC3";break;case 18:this.cSRAM=this.cMBC3=!0;a="MBC3 + SRAM";break;case 19:this.cBATT=this.cSRAM=this.cMBC3=!0;a="MBC3 + SRAM + BATT";break;case 25:this.cMBC5=!0;a="MBC5";break;case 26:this.cSRAM=this.cMBC5=!0;a="MBC5 + SRAM";break;case 27:this.cBATT=this.cSRAM=this.cMBC5=!0;a="MBC5 + SRAM + BATT";break;
case 28:this.cRUMBLE=!0;a="RUMBLE";break;case 29:this.cSRAM=this.cRUMBLE=!0;a="RUMBLE + SRAM";break;case 30:this.cBATT=this.cSRAM=this.cRUMBLE=!0;a="RUMBLE + SRAM + BATT";break;case 31:this.cCamera=!0;a="GameBoy Camera";break;case 34:this.cBATT=this.cSRAM=this.cMBC7=!0;a="MBC7 + SRAM + BATT";break;case 253:this.cTAMA5=!0;a="TAMA5";break;case 254:this.cHuC3=!0;a="HuC3";break;case 255:this.cHuC1=!0;a="HuC1";break;default:a="Unknown",cout("Cartridge type is unknown.",2),pause()}cout("Cartridge Type: "+
a+".",0);this.numROMBanks=this.ROMBanks[this.ROM[328]];cout(this.numROMBanks+" ROM banks.",0);switch(this.RAMBanks[this.ROM[329]]){case 0:cout("No RAM banking requested for allocation or MBC is of type 2.",0);break;case 2:cout("1 RAM bank requested for allocation.",0);break;case 3:cout("4 RAM banks requested for allocation.",0);break;case 4:cout("16 RAM banks requested for allocation.",0);break;default:cout("RAM bank amount requested is unknown, will use maximum allowed by specified MBC type.",0)}if(this.usedBootROM)this.cGBC=
this.usedGBCBootROM,this.setupRAM(),this.initBootstrap();else{switch(this.ROM[323]){case 0:this.cGBC=!1;cout("Only GB mode detected.",0);break;case 50:!settings[2]&&"Game and Watch 50"==this.name+this.gameCode+this.ROM[323]?(this.cGBC=!0,cout("Created a boot exception for Game and Watch Gallery 2 (GBC ID byte is wrong on the cartridge).",1)):this.cGBC=!1;break;case 128:this.cGBC=!settings[2];cout("GB and GBC mode detected.",0);break;case 192:this.cGBC=!0;cout("Only GBC mode detected.",0);break;default:this.cGBC=
!1,cout("Unknown GameBoy game type code #"+this.ROM[323]+", defaulting to GB mode (Old games don't have a type code).",1)}this.inBootstrap=!1;this.setupRAM();this.initSkipBootstrap()}this.initializeModeSpecificArrays();var a=this.ROM[331],b=this.ROM[324]&65280|this.ROM[325]&255;51!=a?cout("Old style license code: "+a,0):cout("New style license code: "+b,0);this.ROMImage=""};
GameBoyCore.prototype.disableBootROM=function(){for(var a=0;256>a;++a)this.memory[a]=this.ROM[a];if(this.usedGBCBootROM){for(a=512;2304>a;++a)this.memory[a]=this.ROM[a];this.cGBC?this.recompileBootIOWriteHandling():this.GBCtoGBModeAdjust()}else this.recompileBootIOWriteHandling()};
GameBoyCore.prototype.initializeTiming=function(){this.clocksPerSecond=4194304*this.emulatorSpeed;this.baseCPUCyclesPerIteration=this.clocksPerSecond/1E3*settings[6];this.CPUCyclesTotalRoundoff=this.baseCPUCyclesPerIteration%4;this.CPUCyclesTotalBase=this.CPUCyclesTotal=this.baseCPUCyclesPerIteration-this.CPUCyclesTotalRoundoff|0;this.CPUCyclesTotalCurrent=0};GameBoyCore.prototype.setSpeed=function(a){this.emulatorSpeed=a;this.initializeTiming();this.audioHandle&&this.initSound()};
GameBoyCore.prototype.setupRAM=function(){this.cMBC2?this.numRAMBanks=0.0625:this.cMBC1||this.cRUMBLE||this.cMBC3||this.cHuC3?this.numRAMBanks=4:this.cMBC5?this.numRAMBanks=16:this.cSRAM&&(this.numRAMBanks=1);if(0<this.numRAMBanks){this.MBCRAMUtilized()||(this.MBCRAMBanksEnabled=!0);var a="function"==typeof this.openMBC?this.openMBC(this.name):[];this.MBCRam=0<a.length?this.toTypedArray(a,"uint8"):this.getTypedArray(8192*this.numRAMBanks,0,"uint8")}cout("Actual bytes of MBC RAM allocated: "+8192*
this.numRAMBanks,0);this.returnFromRTCState();this.cGBC&&(this.VRAM=this.getTypedArray(8192,0,"uint8"),this.GBCMemory=this.getTypedArray(28672,0,"uint8"));this.memoryReadJumpCompile();this.memoryWriteJumpCompile()};GameBoyCore.prototype.MBCRAMUtilized=function(){return this.cMBC1||this.cMBC2||this.cMBC3||this.cMBC5||this.cMBC7||this.cRUMBLE};
GameBoyCore.prototype.recomputeDimension=function(){initNewCanvas();this.onscreenWidth=this.canvas.width;this.onscreenHeight=this.canvas.height;window&&window.mozRequestAnimationFrame?(this.canvas.width=this.onscreenWidth=!settings[12]?160:this.canvas.width,this.canvas.height=this.onscreenHeight=!settings[12]?144:this.canvas.height):(this.onscreenWidth=this.canvas.width,this.onscreenHeight=this.canvas.height);this.offscreenWidth=!settings[12]?160:this.canvas.width;this.offscreenHeight=!settings[12]?
144:this.canvas.height;this.offscreenRGBCount=4*this.offscreenWidth*this.offscreenHeight};
GameBoyCore.prototype.initLCD=function(){this.recomputeDimension();92160!=this.offscreenRGBCount?this.compileResizeFrameBufferFunction():this.resizer=null;try{this.canvasOffscreen=document.createElement("canvas");this.canvasOffscreen.width=this.offscreenWidth;this.canvasOffscreen.height=this.offscreenHeight;this.drawContextOffscreen=this.canvasOffscreen.getContext("2d");this.drawContextOnscreen=this.canvas.getContext("2d");this.canvas.setAttribute("style",(this.canvas.getAttribute("style")||"")+"; image-rendering: "+
(settings[13]?"auto":"-webkit-optimize-contrast")+";image-rendering: "+(settings[13]?"optimizeQuality":"-o-crisp-edges")+";image-rendering: "+(settings[13]?"optimizeQuality":"-moz-crisp-edges")+";-ms-interpolation-mode: "+(settings[13]?"bicubic":"nearest-neighbor")+";");this.drawContextOffscreen.webkitImageSmoothingEnabled=settings[13];this.drawContextOffscreen.mozImageSmoothingEnabled=settings[13];this.drawContextOnscreen.webkitImageSmoothingEnabled=settings[13];this.drawContextOnscreen.mozImageSmoothingEnabled=
settings[13];try{this.canvasBuffer=this.drawContextOffscreen.createImageData(this.offscreenWidth,this.offscreenHeight)}catch(a){cout('Falling back to the getImageData initialization (Error "'+a.message+'").',1),this.canvasBuffer=this.drawContextOffscreen.getImageData(0,0,this.offscreenWidth,this.offscreenHeight)}for(var b=this.offscreenRGBCount;0<b;)this.canvasBuffer.data[b-=4]=248,this.canvasBuffer.data[b+1]=248,this.canvasBuffer.data[b+2]=248,this.canvasBuffer.data[b+3]=255;this.graphicsBlit();
this.canvas.style.visibility="visible";null==this.swizzledFrame&&(this.swizzledFrame=this.getTypedArray(69120,255,"uint8"));this.drewFrame=!0;this.requestDraw()}catch(c){throw Error("HTML5 Canvas support required: "+c.message+"file: "+c.fileName+", line: "+c.lineNumber);}};
GameBoyCore.prototype.graphicsBlit=function(){this.offscreenWidth==this.onscreenWidth&&this.offscreenHeight==this.onscreenHeight?this.drawContextOnscreen.putImageData(this.canvasBuffer,0,0):(this.drawContextOffscreen.putImageData(this.canvasBuffer,0,0),this.drawContextOnscreen.drawImage(this.canvasOffscreen,0,0,this.onscreenWidth,this.onscreenHeight))};
GameBoyCore.prototype.JoyPadEvent=function(a,b){if(b){if(this.JoyPad&=255^1<<a,!this.cGBC&&(!this.usedBootROM||!this.usedGBCBootROM))this.interruptsRequested|=16,this.remainingClocks=0,this.checkIRQMatching()}else this.JoyPad|=1<<a;this.memory[65280]=(this.memory[65280]&48)+((0==(this.memory[65280]&32)?this.JoyPad>>4:15)&(0==(this.memory[65280]&16)?this.JoyPad&15:15));this.CPUStopped=!1};
GameBoyCore.prototype.GyroEvent=function(a,b){a=-100*a+2047;this.highX=a>>8;this.lowX=a&255;b=-100*b+2047;this.highY=b>>8;this.lowY=b&255};
GameBoyCore.prototype.initSound=function(){this.audioResamplerFirstPassFactor=Math.max(Math.min(Math.floor(this.clocksPerSecond/44100),Math.floor(136.53125)),1);this.downSampleInputDivider=1/(240*this.audioResamplerFirstPassFactor);settings[0]?(this.audioHandle=new XAudioServer(2,this.clocksPerSecond/this.audioResamplerFirstPassFactor,0,Math.max(this.baseCPUCyclesPerIteration*settings[8]/this.audioResamplerFirstPassFactor,8192)<<1,null,settings[3],function(){settings[0]=!1}),this.initAudioBuffer()):
this.audioHandle&&this.audioHandle.changeVolume(0)};GameBoyCore.prototype.changeVolume=function(){settings[0]&&this.audioHandle&&this.audioHandle.changeVolume(settings[3])};
GameBoyCore.prototype.initAudioBuffer=function(){this.downsampleInput=this.audioDestinationPosition=this.audioIndex=0;this.bufferContainAmount=Math.max(this.baseCPUCyclesPerIteration*settings[7]/this.audioResamplerFirstPassFactor,4096)<<1;this.numSamplesTotal=this.baseCPUCyclesPerIteration/this.audioResamplerFirstPassFactor<<1;this.audioBuffer=this.getTypedArray(this.numSamplesTotal,0,"float32")};
GameBoyCore.prototype.intializeWhiteNoise=function(){var a=1;this.LSFR15Table=this.getTypedArray(524288,0,"int8");for(var b=32767,a=16383,c=0;32768>c;++c)a=1-(b&1),this.LSFR15Table[32768|c]=a,this.LSFR15Table[65536|c]=2*a,this.LSFR15Table[98304|c]=3*a,this.LSFR15Table[131072|c]=4*a,this.LSFR15Table[163840|c]=5*a,this.LSFR15Table[196608|c]=6*a,this.LSFR15Table[229376|c]=7*a,this.LSFR15Table[262144|c]=8*a,this.LSFR15Table[294912|c]=9*a,this.LSFR15Table[327680|c]=10*a,this.LSFR15Table[360448|c]=11*a,
this.LSFR15Table[393216|c]=12*a,this.LSFR15Table[425984|c]=13*a,this.LSFR15Table[458752|c]=14*a,this.LSFR15Table[491520|c]=15*a,a=b>>1,b=a|((a^b)&1)<<14;this.LSFR7Table=this.getTypedArray(2048,0,"int8");b=127;for(c=0;128>c;++c)a=1-(b&1),this.LSFR7Table[128|c]=a,this.LSFR7Table[256|c]=2*a,this.LSFR7Table[384|c]=3*a,this.LSFR7Table[512|c]=4*a,this.LSFR7Table[640|c]=5*a,this.LSFR7Table[768|c]=6*a,this.LSFR7Table[896|c]=7*a,this.LSFR7Table[1024|c]=8*a,this.LSFR7Table[1152|c]=9*a,this.LSFR7Table[1280|
c]=10*a,this.LSFR7Table[1408|c]=11*a,this.LSFR7Table[1536|c]=12*a,this.LSFR7Table[1664|c]=13*a,this.LSFR7Table[1792|c]=14*a,this.LSFR7Table[1920|c]=15*a,a=b>>1,b=a|((a^b)&1)<<6;this.noiseSampleTable=this.LSFR15Table};GameBoyCore.prototype.audioUnderrunAdjustment=function(){if(settings[0]){var a=this.audioHandle.remainingBuffer();"number"==typeof a&&(a=this.bufferContainAmount-Math.max(a,0),0<a&&(this.CPUCyclesTotalCurrent+=(a>>1)*this.audioResamplerFirstPassFactor,this.recalculateIterationClockLimit()))}};
GameBoyCore.prototype.initializeAudioStartState=function(){this.channel1FrequencyTracker=8192;this.channel1DutyTracker=0;this.channel1CachedDuty=this.dutyLookup[2];this.channel1envelopeVolume=this.channel1totalLength=0;this.channel1envelopeType=!1;this.channel1envelopeSweepsLast=this.channel1envelopeSweeps=0;this.channel1consecutive=!0;this.channel1frequency=0;this.channel1SweepFault=!1;this.channel1ShadowFrequency=0;this.channel1timeSweep=1;this.channel1lastTimeSweep=0;this.channel1Swept=!1;this.channel1frequencySweepDivider=
0;this.channel1decreaseSweep=!1;this.channel2FrequencyTracker=8192;this.channel2DutyTracker=0;this.channel2CachedDuty=this.dutyLookup[2];this.channel2envelopeVolume=this.channel2totalLength=0;this.channel2envelopeType=!1;this.channel2envelopeSweepsLast=this.channel2envelopeSweeps=0;this.channel2consecutive=!0;this.channel2frequency=0;this.channel3canPlay=!1;this.channel3totalLength=0;this.channel3patternType=4;this.channel3frequency=0;this.channel3consecutive=!0;this.channel3Counter=2048;this.channel4FrequencyPeriod=
8;this.channel4currentVolume=this.channel4envelopeVolume=this.channel4totalLength=0;this.channel4envelopeType=!1;this.channel4envelopeSweepsLast=this.channel4envelopeSweeps=0;this.channel4consecutive=!0;this.channel4BitRange=32767;this.noiseSampleTable=this.LSFR15Table;this.channel4VolumeShifter=15;this.channel2FrequencyCounter=this.channel1FrequencyCounter=8192;this.channel3FrequencyPeriod=this.channel3Counter=2048;this.channel4lastSampleLookup=this.channel3lastSampleLookup=0;this.VinRightChannelMasterVolume=
this.VinLeftChannelMasterVolume=8;this.mixerOutputCache=0;this.sequencerClocks=8192;this.sequencePosition=0;this.channel4Counter=this.channel4FrequencyPeriod=8;this.cachedChannel4Sample=this.cachedChannel3Sample=0;this.channel4canPlay=this.channel2canPlay=this.channel1canPlay=this.channel4Enabled=this.channel3Enabled=this.channel2Enabled=this.channel1Enabled=!1;this.audioClocksUntilNextEventCounter=this.audioClocksUntilNextEvent=1;this.channel1OutputLevelCache();this.channel2OutputLevelCache();this.channel3OutputLevelCache();
this.channel4OutputLevelCache();this.noiseSampleTable=this.LSFR15Table};GameBoyCore.prototype.outputAudio=function(){this.audioBuffer[this.audioDestinationPosition++]=(this.downsampleInput>>>16)*this.downSampleInputDivider-1;this.audioBuffer[this.audioDestinationPosition++]=(this.downsampleInput&65535)*this.downSampleInputDivider-1;this.audioDestinationPosition==this.numSamplesTotal&&(this.audioHandle.writeAudioNoCallback(this.audioBuffer),this.audioDestinationPosition=0);this.downsampleInput=0};
GameBoyCore.prototype.generateAudio=function(a){var b=0;if(this.soundMasterEnabled&&!this.CPUStopped)for(var c=0;0<a;){c=Math.min(this.audioClocksUntilNextEventCounter,this.sequencerClocks,a);this.audioClocksUntilNextEventCounter-=c;this.sequencerClocks-=c;for(a-=c;0<c;)b=Math.min(c,this.audioResamplerFirstPassFactor-this.audioIndex),c-=b,this.audioIndex+=b,this.downsampleInput+=this.mixerOutputCache*b,this.audioIndex==this.audioResamplerFirstPassFactor&&(this.audioIndex=0,this.outputAudio());0==
this.sequencerClocks&&(this.audioComputeSequencer(),this.sequencerClocks=8192);0==this.audioClocksUntilNextEventCounter&&this.computeAudioChannels()}else for(;0<a;)b=Math.min(a,this.audioResamplerFirstPassFactor-this.audioIndex),a-=b,this.audioIndex+=b,this.audioIndex==this.audioResamplerFirstPassFactor&&(this.audioIndex=0,this.outputAudio())};
GameBoyCore.prototype.generateAudioFake=function(a){if(this.soundMasterEnabled&&!this.CPUStopped)for(var b=0;0<a;)b=Math.min(this.audioClocksUntilNextEventCounter,this.sequencerClocks,a),this.audioClocksUntilNextEventCounter-=b,this.sequencerClocks-=b,a-=b,0==this.sequencerClocks&&(this.audioComputeSequencer(),this.sequencerClocks=8192),0==this.audioClocksUntilNextEventCounter&&this.computeAudioChannels()};
GameBoyCore.prototype.audioJIT=function(){settings[0]?this.generateAudio(this.audioTicks):this.generateAudioFake(this.audioTicks);this.audioTicks=0};GameBoyCore.prototype.audioComputeSequencer=function(){switch(this.sequencePosition++){case 0:this.clockAudioLength();break;case 2:this.clockAudioLength();this.clockAudioSweep();break;case 4:this.clockAudioLength();break;case 6:this.clockAudioLength();this.clockAudioSweep();break;case 7:this.clockAudioEnvelope(),this.sequencePosition=0}};
GameBoyCore.prototype.clockAudioLength=function(){1<this.channel1totalLength?--this.channel1totalLength:1==this.channel1totalLength&&(this.channel1totalLength=0,this.channel1EnableCheck(),this.memory[65318]&=254);1<this.channel2totalLength?--this.channel2totalLength:1==this.channel2totalLength&&(this.channel2totalLength=0,this.channel2EnableCheck(),this.memory[65318]&=253);1<this.channel3totalLength?--this.channel3totalLength:1==this.channel3totalLength&&(this.channel3totalLength=0,this.channel3EnableCheck(),
this.memory[65318]&=251);1<this.channel4totalLength?--this.channel4totalLength:1==this.channel4totalLength&&(this.channel4totalLength=0,this.channel4EnableCheck(),this.memory[65318]&=247)};GameBoyCore.prototype.clockAudioSweep=function(){!this.channel1SweepFault&&0<this.channel1timeSweep&&0==--this.channel1timeSweep&&this.runAudioSweep()};
GameBoyCore.prototype.runAudioSweep=function(){0<this.channel1lastTimeSweep&&(0<this.channel1frequencySweepDivider?(this.channel1Swept=!0,this.channel1decreaseSweep?(this.channel1ShadowFrequency-=this.channel1ShadowFrequency>>this.channel1frequencySweepDivider,this.channel1frequency=this.channel1ShadowFrequency&2047,this.channel1FrequencyTracker=2048-this.channel1frequency<<2):(this.channel1frequency=this.channel1ShadowFrequency+=this.channel1ShadowFrequency>>this.channel1frequencySweepDivider,2047>=
this.channel1ShadowFrequency?(this.channel1FrequencyTracker=2048-this.channel1frequency<<2,2047<this.channel1ShadowFrequency+(this.channel1ShadowFrequency>>this.channel1frequencySweepDivider)&&(this.channel1SweepFault=!0,this.channel1EnableCheck(),this.memory[65318]&=254)):(this.channel1frequency&=2047,this.channel1SweepFault=!0,this.channel1EnableCheck(),this.memory[65318]&=254)),this.channel1timeSweep=this.channel1lastTimeSweep):(this.channel1SweepFault=!0,this.channel1EnableCheck()))};
GameBoyCore.prototype.channel1AudioSweepPerformDummy=function(){if(0<this.channel1frequencySweepDivider&&!this.channel1decreaseSweep){var a=this.channel1ShadowFrequency+(this.channel1ShadowFrequency>>this.channel1frequencySweepDivider);2047>=a?2047<a+(a>>this.channel1frequencySweepDivider)&&(this.channel1SweepFault=!0,this.channel1EnableCheck(),this.memory[65318]&=254):(this.channel1SweepFault=!0,this.channel1EnableCheck(),this.memory[65318]&=254)}};
GameBoyCore.prototype.clockAudioEnvelope=function(){-1<this.channel1envelopeSweepsLast&&(0<this.channel1envelopeSweeps?--this.channel1envelopeSweeps:this.channel1envelopeType?15>this.channel1envelopeVolume?(++this.channel1envelopeVolume,this.channel1envelopeSweeps=this.channel1envelopeSweepsLast,this.channel1OutputLevelCache()):this.channel1envelopeSweepsLast=-1:0<this.channel1envelopeVolume?(--this.channel1envelopeVolume,this.channel1envelopeSweeps=this.channel1envelopeSweepsLast,this.channel1OutputLevelCache()):
this.channel1envelopeSweepsLast=-1);-1<this.channel2envelopeSweepsLast&&(0<this.channel2envelopeSweeps?--this.channel2envelopeSweeps:this.channel2envelopeType?15>this.channel2envelopeVolume?(++this.channel2envelopeVolume,this.channel2envelopeSweeps=this.channel2envelopeSweepsLast,this.channel2OutputLevelCache()):this.channel2envelopeSweepsLast=-1:0<this.channel2envelopeVolume?(--this.channel2envelopeVolume,this.channel2envelopeSweeps=this.channel2envelopeSweepsLast,this.channel2OutputLevelCache()):
this.channel2envelopeSweepsLast=-1);-1<this.channel4envelopeSweepsLast&&(0<this.channel4envelopeSweeps?--this.channel4envelopeSweeps:this.channel4envelopeType?15>this.channel4envelopeVolume?(this.channel4currentVolume=++this.channel4envelopeVolume<<this.channel4VolumeShifter,this.channel4envelopeSweeps=this.channel4envelopeSweepsLast,this.channel4UpdateCache()):this.channel4envelopeSweepsLast=-1:0<this.channel4envelopeVolume?(this.channel4currentVolume=--this.channel4envelopeVolume<<this.channel4VolumeShifter,
this.channel4envelopeSweeps=this.channel4envelopeSweepsLast,this.channel4UpdateCache()):this.channel4envelopeSweepsLast=-1)};
GameBoyCore.prototype.computeAudioChannels=function(){this.channel1FrequencyCounter-=this.audioClocksUntilNextEvent;this.channel2FrequencyCounter-=this.audioClocksUntilNextEvent;this.channel3Counter-=this.audioClocksUntilNextEvent;this.channel4Counter-=this.audioClocksUntilNextEvent;0==this.channel1FrequencyCounter&&(this.channel1FrequencyCounter=this.channel1FrequencyTracker,this.channel1DutyTracker=this.channel1DutyTracker+1&7,this.channel1OutputLevelTrimaryCache());0==this.channel2FrequencyCounter&&
(this.channel2FrequencyCounter=this.channel2FrequencyTracker,this.channel2DutyTracker=this.channel2DutyTracker+1&7,this.channel2OutputLevelTrimaryCache());0==this.channel3Counter&&(this.channel3canPlay&&(this.channel3lastSampleLookup=this.channel3lastSampleLookup+1&31),this.channel3Counter=this.channel3FrequencyPeriod,this.channel3UpdateCache());0==this.channel4Counter&&(this.channel4lastSampleLookup=this.channel4lastSampleLookup+1&this.channel4BitRange,this.channel4Counter=this.channel4FrequencyPeriod,
this.channel4UpdateCache());this.audioClocksUntilNextEventCounter=this.audioClocksUntilNextEvent=Math.min(this.channel1FrequencyCounter,this.channel2FrequencyCounter,this.channel3Counter,this.channel4Counter)};GameBoyCore.prototype.channel1EnableCheck=function(){this.channel1Enabled=(this.channel1consecutive||0<this.channel1totalLength)&&!this.channel1SweepFault&&this.channel1canPlay;this.channel1OutputLevelSecondaryCache()};
GameBoyCore.prototype.channel1VolumeEnableCheck=function(){this.channel1canPlay=7<this.memory[65298];this.channel1EnableCheck();this.channel1OutputLevelSecondaryCache()};GameBoyCore.prototype.channel1OutputLevelCache=function(){this.channel1currentSampleLeft=this.leftChannel1?this.channel1envelopeVolume:0;this.channel1currentSampleRight=this.rightChannel1?this.channel1envelopeVolume:0;this.channel1OutputLevelSecondaryCache()};
GameBoyCore.prototype.channel1OutputLevelSecondaryCache=function(){this.channel1Enabled?(this.channel1currentSampleLeftSecondary=this.channel1currentSampleLeft,this.channel1currentSampleRightSecondary=this.channel1currentSampleRight):this.channel1currentSampleRightSecondary=this.channel1currentSampleLeftSecondary=0;this.channel1OutputLevelTrimaryCache()};
GameBoyCore.prototype.channel1OutputLevelTrimaryCache=function(){this.channel1CachedDuty[this.channel1DutyTracker]?(this.channel1currentSampleLeftTrimary=this.channel1currentSampleLeftSecondary,this.channel1currentSampleRightTrimary=this.channel1currentSampleRightSecondary):this.channel1currentSampleRightTrimary=this.channel1currentSampleLeftTrimary=0;this.mixerOutputLevelCache()};
GameBoyCore.prototype.channel2EnableCheck=function(){this.channel2Enabled=(this.channel2consecutive||0<this.channel2totalLength)&&this.channel2canPlay;this.channel2OutputLevelSecondaryCache()};GameBoyCore.prototype.channel2VolumeEnableCheck=function(){this.channel2canPlay=7<this.memory[65303];this.channel2EnableCheck();this.channel2OutputLevelSecondaryCache()};
GameBoyCore.prototype.channel2OutputLevelCache=function(){this.channel2currentSampleLeft=this.leftChannel2?this.channel2envelopeVolume:0;this.channel2currentSampleRight=this.rightChannel2?this.channel2envelopeVolume:0;this.channel2OutputLevelSecondaryCache()};
GameBoyCore.prototype.channel2OutputLevelSecondaryCache=function(){this.channel2Enabled?(this.channel2currentSampleLeftSecondary=this.channel2currentSampleLeft,this.channel2currentSampleRightSecondary=this.channel2currentSampleRight):this.channel2currentSampleRightSecondary=this.channel2currentSampleLeftSecondary=0;this.channel2OutputLevelTrimaryCache()};
GameBoyCore.prototype.channel2OutputLevelTrimaryCache=function(){this.channel2CachedDuty[this.channel2DutyTracker]?(this.channel2currentSampleLeftTrimary=this.channel2currentSampleLeftSecondary,this.channel2currentSampleRightTrimary=this.channel2currentSampleRightSecondary):this.channel2currentSampleRightTrimary=this.channel2currentSampleLeftTrimary=0;this.mixerOutputLevelCache()};
GameBoyCore.prototype.channel3EnableCheck=function(){this.channel3Enabled=this.channel3consecutive||0<this.channel3totalLength;this.channel3OutputLevelSecondaryCache()};GameBoyCore.prototype.channel3OutputLevelCache=function(){this.channel3currentSampleLeft=this.leftChannel3?this.cachedChannel3Sample:0;this.channel3currentSampleRight=this.rightChannel3?this.cachedChannel3Sample:0;this.channel3OutputLevelSecondaryCache()};
GameBoyCore.prototype.channel3OutputLevelSecondaryCache=function(){this.channel3Enabled?(this.channel3currentSampleLeftSecondary=this.channel3currentSampleLeft,this.channel3currentSampleRightSecondary=this.channel3currentSampleRight):this.channel3currentSampleRightSecondary=this.channel3currentSampleLeftSecondary=0;this.mixerOutputLevelCache()};GameBoyCore.prototype.channel4EnableCheck=function(){this.channel4Enabled=(this.channel4consecutive||0<this.channel4totalLength)&&this.channel4canPlay;this.channel4OutputLevelSecondaryCache()};
GameBoyCore.prototype.channel4VolumeEnableCheck=function(){this.channel4canPlay=7<this.memory[65313];this.channel4EnableCheck();this.channel4OutputLevelSecondaryCache()};GameBoyCore.prototype.channel4OutputLevelCache=function(){this.channel4currentSampleLeft=this.leftChannel4?this.cachedChannel4Sample:0;this.channel4currentSampleRight=this.rightChannel4?this.cachedChannel4Sample:0;this.channel4OutputLevelSecondaryCache()};
GameBoyCore.prototype.channel4OutputLevelSecondaryCache=function(){this.channel4Enabled?(this.channel4currentSampleLeftSecondary=this.channel4currentSampleLeft,this.channel4currentSampleRightSecondary=this.channel4currentSampleRight):this.channel4currentSampleRightSecondary=this.channel4currentSampleLeftSecondary=0;this.mixerOutputLevelCache()};
GameBoyCore.prototype.mixerOutputLevelCache=function(){this.mixerOutputCache=(this.channel1currentSampleLeftTrimary+this.channel2currentSampleLeftTrimary+this.channel3currentSampleLeftSecondary+this.channel4currentSampleLeftSecondary)*this.VinLeftChannelMasterVolume<<16|(this.channel1currentSampleRightTrimary+this.channel2currentSampleRightTrimary+this.channel3currentSampleRightSecondary+this.channel4currentSampleRightSecondary)*this.VinRightChannelMasterVolume};
GameBoyCore.prototype.channel3UpdateCache=function(){this.cachedChannel3Sample=this.channel3PCM[this.channel3lastSampleLookup]>>this.channel3patternType;this.channel3OutputLevelCache()};GameBoyCore.prototype.channel3WriteRAM=function(a,b){this.channel3canPlay&&this.audioJIT();this.memory[65328|a]=b;a<<=1;this.channel3PCM[a]=b>>4;this.channel3PCM[a|1]=b&15};
GameBoyCore.prototype.channel4UpdateCache=function(){this.cachedChannel4Sample=this.noiseSampleTable[this.channel4currentVolume|this.channel4lastSampleLookup];this.channel4OutputLevelCache()};
GameBoyCore.prototype.run=function(){0==(this.stopEmulator&2)&&(1==(this.stopEmulator&1)?this.CPUStopped?(this.audioUnderrunAdjustment(),this.audioTicks+=this.CPUCyclesTotal,this.audioJIT(),this.stopEmulator|=1):(this.stopEmulator=0,this.audioUnderrunAdjustment(),this.clockUpdate(),this.halt?(this.CPUTicks=0,this.calculateHALTPeriod(),this.halt?(this.updateCore(),this.iterationEndRoutine()):this.executeIteration()):this.executeIteration(),this.requestDraw()):(cout("Iterator restarted a faulted core.",
2),pause()))};
GameBoyCore.prototype.executeIteration=function(){for(var a=0,a=0;0==this.stopEmulator;){switch(this.IRQEnableDelay){case 1:this.IME=!0,this.checkIRQMatching();case 2:--this.IRQEnableDelay}0<this.IRQLineMatched&&this.launchIRQ();a=this.memoryReader[this.programCounter](this,this.programCounter);this.programCounter=this.programCounter+1&65535;this.skipPCIncrement&&(this.programCounter=this.programCounter-1&65535,this.skipPCIncrement=!1);this.CPUTicks=this.TICKTable[a];this.OPCODE[a](this);this.LCDTicks+=
this.CPUTicks>>this.doubleSpeedShifter;this.LCDCONTROL[this.actualScanLine](this);a=this.CPUTicks>>this.doubleSpeedShifter;this.audioTicks+=a;this.emulatorTicks+=a;this.DIVTicks+=this.CPUTicks;if(this.TIMAEnabled)for(this.timerTicks+=this.CPUTicks;this.timerTicks>=this.TACClocker;)this.timerTicks-=this.TACClocker,256==++this.memory[65285]&&(this.memory[65285]=this.memory[65286],this.interruptsRequested|=4,this.checkIRQMatching());0<this.serialTimer&&(this.serialTimer-=this.CPUTicks,0>=this.serialTimer&&
(this.interruptsRequested|=8,this.checkIRQMatching()),this.serialShiftTimer-=this.CPUTicks,0>=this.serialShiftTimer&&(this.serialShiftTimer=this.serialShiftTimerAllocated,this.memory[65281]=this.memory[65281]<<1&254|1));this.emulatorTicks>=this.CPUCyclesTotal&&this.iterationEndRoutine()}};
GameBoyCore.prototype.iterationEndRoutine=function(){0==(this.stopEmulator&1)&&(this.audioJIT(),this.memory[65284]=this.memory[65284]+(this.DIVTicks>>8)&255,this.DIVTicks&=255,this.stopEmulator|=1,this.emulatorTicks-=this.CPUCyclesTotal,this.CPUCyclesTotalCurrent+=this.CPUCyclesTotalRoundoff,this.recalculateIterationClockLimit())};GameBoyCore.prototype.handleSTOP=function(){this.CPUStopped=!0;this.iterationEndRoutine();0>this.emulatorTicks&&(this.audioTicks-=this.emulatorTicks,this.audioJIT())};
GameBoyCore.prototype.recalculateIterationClockLimit=function(){var a=this.CPUCyclesTotalCurrent%4;this.CPUCyclesTotal=this.CPUCyclesTotalBase+this.CPUCyclesTotalCurrent-a;this.CPUCyclesTotalCurrent=a};GameBoyCore.prototype.scanLineMode2=function(){1!=this.STATTracker&&(this.mode2TriggerSTAT&&(this.interruptsRequested|=2,this.checkIRQMatching()),this.STATTracker=1,this.modeSTAT=2)};
GameBoyCore.prototype.scanLineMode3=function(){3!=this.modeSTAT&&(0==this.STATTracker&&this.mode2TriggerSTAT&&(this.interruptsRequested|=2,this.checkIRQMatching()),this.STATTracker=1,this.modeSTAT=3)};
GameBoyCore.prototype.scanLineMode0=function(){0!=this.modeSTAT&&(2!=this.STATTracker&&(0==this.STATTracker&&(this.mode2TriggerSTAT&&(this.interruptsRequested|=2,this.checkIRQMatching()),this.modeSTAT=3),this.incrementScanLineQueue(),this.updateSpriteCount(this.actualScanLine),this.STATTracker=2),this.LCDTicks>=this.spriteCount&&(this.hdmaRunning&&this.executeHDMA(),this.mode0TriggerSTAT&&(this.interruptsRequested|=2,this.checkIRQMatching()),this.STATTracker=3,this.modeSTAT=0))};
GameBoyCore.prototype.clocksUntilLYCMatch=function(){return 0!=this.memory[65349]?this.memory[65349]>this.actualScanLine?456*(this.memory[65349]-this.actualScanLine):456*(154-this.actualScanLine+this.memory[65349]):456*(153==this.actualScanLine&&0==this.memory[65348]?154:153-this.actualScanLine)+8};
GameBoyCore.prototype.clocksUntilMode0=function(){switch(this.modeSTAT){case 0:if(143==this.actualScanLine)return this.updateSpriteCount(0),this.spriteCount+5016;this.updateSpriteCount(this.actualScanLine+1);return this.spriteCount+456;case 2:case 3:return this.updateSpriteCount(this.actualScanLine),this.spriteCount;case 1:return this.updateSpriteCount(0),this.spriteCount+456*(154-this.actualScanLine)}};
GameBoyCore.prototype.updateSpriteCount=function(a){this.spriteCount=252;if(this.cGBC&&this.gfxSpriteShow)for(var a=a+16,b=0,c=this.gfxSpriteNormalHeight?8:16,e=65024;65184>e&&312>this.spriteCount;e+=4)b=a-this.memory[e],-1<b&&b<c&&(this.spriteCount+=6)};GameBoyCore.prototype.matchLYC=function(){this.memory[65348]==this.memory[65349]?(this.memory[65345]|=4,this.LYCMatchTriggerSTAT&&(this.interruptsRequested|=2,this.checkIRQMatching())):this.memory[65345]&=123};
GameBoyCore.prototype.updateCore=function(){this.LCDTicks+=this.CPUTicks>>this.doubleSpeedShifter;this.LCDCONTROL[this.actualScanLine](this);var a=this.CPUTicks>>this.doubleSpeedShifter;this.audioTicks+=a;this.emulatorTicks+=a;this.DIVTicks+=this.CPUTicks;if(this.TIMAEnabled)for(this.timerTicks+=this.CPUTicks;this.timerTicks>=this.TACClocker;)this.timerTicks-=this.TACClocker,256==++this.memory[65285]&&(this.memory[65285]=this.memory[65286],this.interruptsRequested|=4,this.checkIRQMatching());0<this.serialTimer&&
(this.serialTimer-=this.CPUTicks,0>=this.serialTimer&&(this.interruptsRequested|=8,this.checkIRQMatching()),this.serialShiftTimer-=this.CPUTicks,0>=this.serialShiftTimer&&(this.serialShiftTimer=this.serialShiftTimerAllocated,this.memory[65281]=this.memory[65281]<<1&254|1))};GameBoyCore.prototype.updateCoreFull=function(){this.updateCore();this.emulatorTicks>=this.CPUCyclesTotal&&this.iterationEndRoutine()};
GameBoyCore.prototype.initializeLCDController=function(){for(var a=0;154>a;)143>a?this.LINECONTROL[a]=function(a){80>a.LCDTicks?a.scanLineMode2():252>a.LCDTicks?a.scanLineMode3():456>a.LCDTicks?a.scanLineMode0():(a.LCDTicks-=456,3!=a.STATTracker&&(2!=a.STATTracker&&(0==a.STATTracker&&a.mode2TriggerSTAT&&(a.interruptsRequested|=2),a.incrementScanLineQueue()),a.hdmaRunning&&a.executeHDMA(),a.mode0TriggerSTAT&&(a.interruptsRequested|=2)),a.actualScanLine=++a.memory[65348],a.actualScanLine==a.memory[65349]?
(a.memory[65345]|=4,a.LYCMatchTriggerSTAT&&(a.interruptsRequested|=2)):a.memory[65345]&=123,a.checkIRQMatching(),a.STATTracker=0,a.modeSTAT=2,a.LINECONTROL[a.actualScanLine](a))}:143==a?this.LINECONTROL[143]=function(a){if(80>a.LCDTicks)a.scanLineMode2();else if(252>a.LCDTicks)a.scanLineMode3();else if(456>a.LCDTicks)a.scanLineMode0();else{a.LCDTicks-=456;3!=a.STATTracker&&(2!=a.STATTracker&&(0==a.STATTracker&&a.mode2TriggerSTAT&&(a.interruptsRequested|=2),a.incrementScanLineQueue()),a.hdmaRunning&&
a.executeHDMA(),a.mode0TriggerSTAT&&(a.interruptsRequested|=2));a.actualScanLine=a.memory[65348]=144;144==a.memory[65349]?(a.memory[65345]|=4,a.LYCMatchTriggerSTAT&&(a.interruptsRequested|=2)):a.memory[65345]&=123;a.STATTracker=0;a.modeSTAT=1;a.interruptsRequested|=a.mode1TriggerSTAT?3:1;a.checkIRQMatching();if(0==a.drewBlank){if(144>a.totalLinesPassed||144==a.totalLinesPassed&&-1<a.midScanlineOffset)a.graphicsJITVBlank(),a.prepareFrame()}else--a.drewBlank;a.LINECONTROL[144](a)}}:153>a?this.LINECONTROL[a]=
function(a){456<=a.LCDTicks&&(a.LCDTicks-=456,a.actualScanLine=++a.memory[65348],a.actualScanLine==a.memory[65349]?(a.memory[65345]|=4,a.LYCMatchTriggerSTAT&&(a.interruptsRequested|=2,a.checkIRQMatching())):a.memory[65345]&=123,a.LINECONTROL[a.actualScanLine](a))}:this.LINECONTROL[153]=function(a){8<=a.LCDTicks&&(4!=a.STATTracker&&153==a.memory[65348]&&(a.memory[65348]=0,0==a.memory[65349]?(a.memory[65345]|=4,a.LYCMatchTriggerSTAT&&(a.interruptsRequested|=2,a.checkIRQMatching())):a.memory[65345]&=
123,a.STATTracker=4),456<=a.LCDTicks&&(a.LCDTicks-=456,a.STATTracker=a.actualScanLine=0,a.LINECONTROL[0](a)))},++a};GameBoyCore.prototype.DisplayShowOff=function(){0==this.drewBlank&&(this.clearFrameBuffer(),this.drewFrame=!0);this.drewBlank=2};
GameBoyCore.prototype.executeHDMA=function(){this.DMAWrite(1);this.halt?this.LCDTicks-this.spriteCount<(4>>this.doubleSpeedShifter|32)&&(this.CPUTicks=4+(32+this.spriteCount<<this.doubleSpeedShifter),this.LCDTicks=this.spriteCount+(4>>this.doubleSpeedShifter|32)):this.LCDTicks+=4>>this.doubleSpeedShifter|32;0==this.memory[65365]?(this.hdmaRunning=!1,this.memory[65365]=255):--this.memory[65365]};
GameBoyCore.prototype.clockUpdate=function(){if(this.cTIMER){var a=(new Date).getTime(),b=a-this.lastIteration;this.lastIteration=a;if(this.cTIMER&&!this.RTCHALT)for(this.RTCSeconds+=b/1E3;60<=this.RTCSeconds;)this.RTCSeconds-=60,++this.RTCMinutes,60<=this.RTCMinutes&&(this.RTCMinutes-=60,++this.RTCHours,24<=this.RTCHours&&(this.RTCHours-=24,++this.RTCDays,512<=this.RTCDays&&(this.RTCDays-=512,this.RTCDayOverFlow=!0)))}};
GameBoyCore.prototype.prepareFrame=function(){this.swizzleFrameBuffer();this.drewFrame=!0};GameBoyCore.prototype.requestDraw=function(){this.drewFrame&&this.dispatchDraw()};GameBoyCore.prototype.dispatchDraw=function(){0<this.offscreenRGBCount&&(92160==this.offscreenRGBCount?this.processDraw(this.swizzledFrame):this.resizeFrameBuffer())};
GameBoyCore.prototype.processDraw=function(a){for(var b=this.offscreenRGBCount,c=this.canvasBuffer.data,e=0,f=0;f<b;++f)c[f++]=a[e++],c[f++]=a[e++],c[f++]=a[e++];this.graphicsBlit();this.drewFrame=!1};GameBoyCore.prototype.swizzleFrameBuffer=function(){for(var a=this.frameBuffer,b=this.swizzledFrame,c=0,e=0;69120>e;)b[e++]=a[c]>>16&255,b[e++]=a[c]>>8&255,b[e++]=a[c++]&255};
GameBoyCore.prototype.clearFrameBuffer=function(){var a=0,b=this.swizzledFrame;if(this.cGBC||this.colorizedGBPalettes)for(;69120>a;)b[a++]=248;else for(;69120>a;)b[a++]=239,b[a++]=255,b[a++]=222};GameBoyCore.prototype.resizeFrameBuffer=function(){this.resizePathClear&&(this.resizePathClear=!1,this.resizer.resize(this.swizzledFrame))};
GameBoyCore.prototype.compileResizeFrameBufferFunction=function(){if(0<this.offscreenRGBCount){var a=this;this.resizer=new Resize(160,144,this.offscreenWidth,this.offscreenHeight,!1,settings[13],!1,function(b){4*(b.length/3)==a.offscreenRGBCount&&a.processDraw(b);a.resizePathClear=!0})}};
GameBoyCore.prototype.renderScanLine=function(a){this.pixelStart=160*a;if(this.bgEnabled)this.pixelEnd=160,this.BGLayerRender(a),this.WindowLayerRender(a);else for(var b=160*(a+1),c=this.cGBC||this.colorizedGBPalettes?16316664:15728606,e=160*a+this.currentX;e<b;e++)this.frameBuffer[e]=c;this.SpriteLayerRender(a);this.currentX=0;this.midScanlineOffset=-1};
GameBoyCore.prototype.renderMidScanLine=function(){if(144>this.actualScanLine&&3==this.modeSTAT&&(-1==this.midScanlineOffset&&(this.midScanlineOffset=this.backgroundX&7),82<=this.LCDTicks)){this.pixelEnd=this.LCDTicks-74;this.pixelEnd=Math.min(this.pixelEnd-this.midScanlineOffset-this.pixelEnd%8,160);if(this.bgEnabled)this.pixelStart=160*this.lastUnrenderedLine,this.BGLayerRender(this.lastUnrenderedLine),this.WindowLayerRender(this.lastUnrenderedLine);else for(var a=160*this.lastUnrenderedLine+this.pixelEnd,
b=this.cGBC||this.colorizedGBPalettes?16316664:15728606,c=160*this.lastUnrenderedLine+this.currentX;c<a;c++)this.frameBuffer[c]=b;this.currentX=this.pixelEnd}};
GameBoyCore.prototype.initializeModeSpecificArrays=function(){this.LCDCONTROL=this.LCDisOn?this.LINECONTROL:this.DISPLAYOFFCONTROL;this.cGBC?(this.gbcOBJRawPalette=this.getTypedArray(64,0,"uint8"),this.gbcBGRawPalette=this.getTypedArray(64,0,"uint8"),this.gbcOBJPalette=this.getTypedArray(32,16777216,"int32"),this.gbcBGPalette=this.getTypedArray(64,0,"int32"),this.BGCHRBank2=this.getTypedArray(2048,0,"uint8"),this.BGCHRCurrentBank=0<this.currVRAMBank?this.BGCHRBank2:this.BGCHRBank1,this.tileCache=
this.generateCacheArray(3968)):(this.gbOBJPalette=this.getTypedArray(8,0,"int32"),this.BGPalette=this.gbBGPalette=this.getTypedArray(4,0,"int32"),this.OBJPalette=this.gbOBJPalette,this.tileCache=this.generateCacheArray(1792),this.sortBuffer=this.getTypedArray(256,0,"uint8"),this.OAMAddressCache=this.getTypedArray(10,0,"int32"));this.renderPathBuild()};
GameBoyCore.prototype.GBCtoGBModeAdjust=function(){cout("Stepping down from GBC mode.",0);this.VRAM=this.GBCMemory=this.BGCHRCurrentBank=this.BGCHRBank2=null;this.tileCache.length=1792;settings[4]?(this.gbBGColorizedPalette=this.getTypedArray(4,0,"int32"),this.gbOBJColorizedPalette=this.getTypedArray(8,0,"int32"),this.cachedBGPaletteConversion=this.getTypedArray(4,0,"int32"),this.cachedOBJPaletteConversion=this.getTypedArray(8,0,"int32"),this.BGPalette=this.gbBGColorizedPalette,this.OBJPalette=this.gbOBJColorizedPalette,
this.gbOBJPalette=this.gbBGPalette=null,this.getGBCColor()):(this.gbOBJPalette=this.getTypedArray(8,0,"int32"),this.BGPalette=this.gbBGPalette=this.getTypedArray(4,0,"int32"),this.OBJPalette=this.gbOBJPalette);this.sortBuffer=this.getTypedArray(256,0,"uint8");this.OAMAddressCache=this.getTypedArray(10,0,"int32");this.renderPathBuild();this.memoryReadJumpCompile();this.memoryWriteJumpCompile()};
GameBoyCore.prototype.renderPathBuild=function(){this.cGBC?(this.priorityFlaggingPathRebuild(),this.SpriteLayerRender=this.SpriteGBCLayerRender):(this.BGLayerRender=this.BGGBLayerRender,this.WindowLayerRender=this.WindowGBLayerRender,this.SpriteLayerRender=this.SpriteGBLayerRender)};
GameBoyCore.prototype.priorityFlaggingPathRebuild=function(){this.BGPriorityEnabled?(this.BGLayerRender=this.BGGBCLayerRender,this.WindowLayerRender=this.WindowGBCLayerRender):(this.BGLayerRender=this.BGGBCLayerRenderNoPriorityFlagging,this.WindowLayerRender=this.WindowGBCLayerRenderNoPriorityFlagging)};
GameBoyCore.prototype.initializeReferencesFromSaveState=function(){this.LCDCONTROL=this.LCDisOn?this.LINECONTROL:this.DISPLAYOFFCONTROL;var a=0;if(this.cGBC){this.BGCHRCurrentBank=0<this.currVRAMBank?this.BGCHRBank2:this.BGCHRBank1;for(this.tileCache=this.generateCacheArray(3968);6144>a;a+=16)this.generateGBCTileBank1(a),this.generateGBCTileBank2(a)}else{this.colorizedGBPalettes?(this.BGPalette=this.gbBGColorizedPalette,this.OBJPalette=this.gbOBJColorizedPalette,this.updateGBBGPalette=this.updateGBColorizedBGPalette,
this.updateGBOBJPalette=this.updateGBColorizedOBJPalette):(this.BGPalette=this.gbBGPalette,this.OBJPalette=this.gbOBJPalette);this.tileCache=this.generateCacheArray(1792);for(a=32768;36864>a;a+=2)this.generateGBOAMTileLine(a);for(a=36864;38912>a;a+=2)this.generateGBTileLine(a);this.sortBuffer=this.getTypedArray(256,0,"uint8");this.OAMAddressCache=this.getTypedArray(10,0,"int32")}this.renderPathBuild()};
GameBoyCore.prototype.RGBTint=function(a){var b=a&31,c=a>>5&31,a=a>>10&31;return 13*b+2*c+a>>1<<16|3*c+a<<9|3*b+2*c+11*a>>1};
GameBoyCore.prototype.getGBCColor=function(){for(var a=0;4>a;a++){var b=a<<1;this.cachedBGPaletteConversion[a]=this.RGBTint(this.gbcBGRawPalette[b|1]<<8|this.gbcBGRawPalette[b]);this.cachedOBJPaletteConversion[a]=this.RGBTint(this.gbcOBJRawPalette[b|1]<<8|this.gbcOBJRawPalette[b])}for(a=4;8>a;a++)b=a<<1,this.cachedOBJPaletteConversion[a]=this.RGBTint(this.gbcOBJRawPalette[b|1]<<8|this.gbcOBJRawPalette[b]);this.updateGBBGPalette=this.updateGBColorizedBGPalette;this.updateGBOBJPalette=this.updateGBColorizedOBJPalette;
this.updateGBBGPalette(this.memory[65351]);this.updateGBOBJPalette(0,this.memory[65352]);this.updateGBOBJPalette(1,this.memory[65353]);this.colorizedGBPalettes=!0};GameBoyCore.prototype.updateGBRegularBGPalette=function(a){this.gbBGPalette[0]=this.colors[a&3]|33554432;this.gbBGPalette[1]=this.colors[a>>2&3];this.gbBGPalette[2]=this.colors[a>>4&3];this.gbBGPalette[3]=this.colors[a>>6]};
GameBoyCore.prototype.updateGBColorizedBGPalette=function(a){this.gbBGColorizedPalette[0]=this.cachedBGPaletteConversion[a&3]|33554432;this.gbBGColorizedPalette[1]=this.cachedBGPaletteConversion[a>>2&3];this.gbBGColorizedPalette[2]=this.cachedBGPaletteConversion[a>>4&3];this.gbBGColorizedPalette[3]=this.cachedBGPaletteConversion[a>>6]};
GameBoyCore.prototype.updateGBRegularOBJPalette=function(a,b){this.gbOBJPalette[a|1]=this.colors[b>>2&3];this.gbOBJPalette[a|2]=this.colors[b>>4&3];this.gbOBJPalette[a|3]=this.colors[b>>6]};GameBoyCore.prototype.updateGBColorizedOBJPalette=function(a,b){this.gbOBJColorizedPalette[a|1]=this.cachedOBJPaletteConversion[a|b>>2&3];this.gbOBJColorizedPalette[a|2]=this.cachedOBJPaletteConversion[a|b>>4&3];this.gbOBJColorizedPalette[a|3]=this.cachedOBJPaletteConversion[a|b>>6]};
GameBoyCore.prototype.updateGBCBGPalette=function(a,b){this.gbcBGRawPalette[a]!=b&&(this.midScanLineJIT(),this.gbcBGRawPalette[a]=b,b=0==(a&6)?33554432|this.RGBTint(this.gbcBGRawPalette[a|1]<<8|this.gbcBGRawPalette[a&62]):this.RGBTint(this.gbcBGRawPalette[a|1]<<8|this.gbcBGRawPalette[a&62]),a>>=1,this.gbcBGPalette[a]=b,this.gbcBGPalette[32|a]=16777216|b)};
GameBoyCore.prototype.updateGBCOBJPalette=function(a,b){this.gbcOBJRawPalette[a]!=b&&(this.gbcOBJRawPalette[a]=b,0<(a&6)&&(this.midScanLineJIT(),this.gbcOBJPalette[a>>1]=16777216|this.RGBTint(this.gbcOBJRawPalette[a|1]<<8|this.gbcOBJRawPalette[a&62])))};
GameBoyCore.prototype.BGGBLayerRender=function(a){var b=this.backgroundY+a&255,c=(b&7)<<3,b=this.gfxBackgroundCHRBankPosition|(b&248)<<2,e=this.backgroundX+this.currentX&255,f=this.pixelStart+this.currentX,a=this.pixelStart+(this.gfxWindowDisplay&&0<=a-this.windowY?Math.min(Math.max(this.windowX,0)+this.currentX,this.pixelEnd):this.pixelEnd),h=b+(e>>3),d=this.BGCHRBank1[h];d<this.gfxBackgroundBankOffset&&(d|=256);for(var d=this.tileCache[d],g=e&7;8>g&&f<a&&256>e;++e)this.frameBuffer[f++]=this.BGPalette[d[c|
g++]];for(var i=Math.min(a-f,256-e)>>3,e=e+(i<<3),i=i+h;h<i;)d=this.BGCHRBank1[++h],d<this.gfxBackgroundBankOffset&&(d|=256),d=this.tileCache[d],g=c,this.frameBuffer[f++]=this.BGPalette[d[g++]],this.frameBuffer[f++]=this.BGPalette[d[g++]],this.frameBuffer[f++]=this.BGPalette[d[g++]],this.frameBuffer[f++]=this.BGPalette[d[g++]],this.frameBuffer[f++]=this.BGPalette[d[g++]],this.frameBuffer[f++]=this.BGPalette[d[g++]],this.frameBuffer[f++]=this.BGPalette[d[g++]],this.frameBuffer[f++]=this.BGPalette[d[g]];
if(f<a){if(256>e){d=this.BGCHRBank1[++h];d<this.gfxBackgroundBankOffset&&(d|=256);d=this.tileCache[d];for(g=c-1;f<a&&256>e;++e)this.frameBuffer[f++]=this.BGPalette[d[++g]]}for(i=(a-f>>3)+b;b<i;)d=this.BGCHRBank1[b++],d<this.gfxBackgroundBankOffset&&(d|=256),d=this.tileCache[d],g=c,this.frameBuffer[f++]=this.BGPalette[d[g++]],this.frameBuffer[f++]=this.BGPalette[d[g++]],this.frameBuffer[f++]=this.BGPalette[d[g++]],this.frameBuffer[f++]=this.BGPalette[d[g++]],this.frameBuffer[f++]=this.BGPalette[d[g++]],
this.frameBuffer[f++]=this.BGPalette[d[g++]],this.frameBuffer[f++]=this.BGPalette[d[g++]],this.frameBuffer[f++]=this.BGPalette[d[g]];if(f<a)switch(d=this.BGCHRBank1[b],d<this.gfxBackgroundBankOffset&&(d|=256),d=this.tileCache[d],a-f){case 7:this.frameBuffer[f+6]=this.BGPalette[d[c|6]];case 6:this.frameBuffer[f+5]=this.BGPalette[d[c|5]];case 5:this.frameBuffer[f+4]=this.BGPalette[d[c|4]];case 4:this.frameBuffer[f+3]=this.BGPalette[d[c|3]];case 3:this.frameBuffer[f+2]=this.BGPalette[d[c|2]];case 2:this.frameBuffer[f+
1]=this.BGPalette[d[c|1]];case 1:this.frameBuffer[f]=this.BGPalette[d[c]]}}};
GameBoyCore.prototype.BGGBCLayerRender=function(a){var b=this.backgroundY+a&255,c=(b&7)<<3,b=this.gfxBackgroundCHRBankPosition|(b&248)<<2,e=this.backgroundX+this.currentX&255,f=this.pixelStart+this.currentX,a=this.pixelStart+(this.gfxWindowDisplay&&0<=a-this.windowY?Math.min(Math.max(this.windowX,0)+this.currentX,this.pixelEnd):this.pixelEnd),h=b+(e>>3),d=this.BGCHRBank1[h];d<this.gfxBackgroundBankOffset&&(d|=256);for(var g=this.BGCHRBank2[h],d=this.tileCache[(g&8)<<8|(g&96)<<4|d],g=(g&7)<<2|(g&128)>>
2,i=e&7;8>i&&f<a&&256>e;++e)this.frameBuffer[f++]=this.gbcBGPalette[g|d[c|i++]];for(var j=Math.min(a-f,256-e)>>3,e=e+(j<<3),j=j+h;h<j;)d=this.BGCHRBank1[++h],d<this.gfxBackgroundBankOffset&&(d|=256),g=this.BGCHRBank2[h],d=this.tileCache[(g&8)<<8|(g&96)<<4|d],g=(g&7)<<2|(g&128)>>2,i=c,this.frameBuffer[f++]=this.gbcBGPalette[g|d[i++]],this.frameBuffer[f++]=this.gbcBGPalette[g|d[i++]],this.frameBuffer[f++]=this.gbcBGPalette[g|d[i++]],this.frameBuffer[f++]=this.gbcBGPalette[g|d[i++]],this.frameBuffer[f++]=
this.gbcBGPalette[g|d[i++]],this.frameBuffer[f++]=this.gbcBGPalette[g|d[i++]],this.frameBuffer[f++]=this.gbcBGPalette[g|d[i++]],this.frameBuffer[f++]=this.gbcBGPalette[g|d[i]];if(f<a){if(256>e){d=this.BGCHRBank1[++h];d<this.gfxBackgroundBankOffset&&(d|=256);g=this.BGCHRBank2[h];d=this.tileCache[(g&8)<<8|(g&96)<<4|d];g=(g&7)<<2|(g&128)>>2;for(i=c-1;f<a&&256>e;++e)this.frameBuffer[f++]=this.gbcBGPalette[g|d[++i]]}for(j=(a-f>>3)+b;b<j;)d=this.BGCHRBank1[b],d<this.gfxBackgroundBankOffset&&(d|=256),g=
this.BGCHRBank2[b++],d=this.tileCache[(g&8)<<8|(g&96)<<4|d],g=(g&7)<<2|(g&128)>>2,i=c,this.frameBuffer[f++]=this.gbcBGPalette[g|d[i++]],this.frameBuffer[f++]=this.gbcBGPalette[g|d[i++]],this.frameBuffer[f++]=this.gbcBGPalette[g|d[i++]],this.frameBuffer[f++]=this.gbcBGPalette[g|d[i++]],this.frameBuffer[f++]=this.gbcBGPalette[g|d[i++]],this.frameBuffer[f++]=this.gbcBGPalette[g|d[i++]],this.frameBuffer[f++]=this.gbcBGPalette[g|d[i++]],this.frameBuffer[f++]=this.gbcBGPalette[g|d[i]];if(f<a)switch(d=this.BGCHRBank1[b],
d<this.gfxBackgroundBankOffset&&(d|=256),g=this.BGCHRBank2[b],d=this.tileCache[(g&8)<<8|(g&96)<<4|d],g=(g&7)<<2|(g&128)>>2,a-f){case 7:this.frameBuffer[f+6]=this.gbcBGPalette[g|d[c|6]];case 6:this.frameBuffer[f+5]=this.gbcBGPalette[g|d[c|5]];case 5:this.frameBuffer[f+4]=this.gbcBGPalette[g|d[c|4]];case 4:this.frameBuffer[f+3]=this.gbcBGPalette[g|d[c|3]];case 3:this.frameBuffer[f+2]=this.gbcBGPalette[g|d[c|2]];case 2:this.frameBuffer[f+1]=this.gbcBGPalette[g|d[c|1]];case 1:this.frameBuffer[f]=this.gbcBGPalette[g|
d[c]]}}};
GameBoyCore.prototype.BGGBCLayerRenderNoPriorityFlagging=function(a){var b=this.backgroundY+a&255,c=(b&7)<<3,b=this.gfxBackgroundCHRBankPosition|(b&248)<<2,e=this.backgroundX+this.currentX&255,f=this.pixelStart+this.currentX,a=this.pixelStart+(this.gfxWindowDisplay&&0<=a-this.windowY?Math.min(Math.max(this.windowX,0)+this.currentX,this.pixelEnd):this.pixelEnd),h=b+(e>>3),d=this.BGCHRBank1[h];d<this.gfxBackgroundBankOffset&&(d|=256);for(var g=this.BGCHRBank2[h],d=this.tileCache[(g&8)<<8|(g&96)<<4|
d],g=(g&7)<<2,i=e&7;8>i&&f<a&&256>e;++e)this.frameBuffer[f++]=this.gbcBGPalette[g|d[c|i++]];for(var j=Math.min(a-f,256-e)>>3,e=e+(j<<3),j=j+h;h<j;)d=this.BGCHRBank1[++h],d<this.gfxBackgroundBankOffset&&(d|=256),g=this.BGCHRBank2[h],d=this.tileCache[(g&8)<<8|(g&96)<<4|d],g=(g&7)<<2,i=c,this.frameBuffer[f++]=this.gbcBGPalette[g|d[i++]],this.frameBuffer[f++]=this.gbcBGPalette[g|d[i++]],this.frameBuffer[f++]=this.gbcBGPalette[g|d[i++]],this.frameBuffer[f++]=this.gbcBGPalette[g|d[i++]],this.frameBuffer[f++]=
this.gbcBGPalette[g|d[i++]],this.frameBuffer[f++]=this.gbcBGPalette[g|d[i++]],this.frameBuffer[f++]=this.gbcBGPalette[g|d[i++]],this.frameBuffer[f++]=this.gbcBGPalette[g|d[i]];if(f<a){if(256>e){d=this.BGCHRBank1[++h];d<this.gfxBackgroundBankOffset&&(d|=256);g=this.BGCHRBank2[h];d=this.tileCache[(g&8)<<8|(g&96)<<4|d];g=(g&7)<<2;for(i=c-1;f<a&&256>e;++e)this.frameBuffer[f++]=this.gbcBGPalette[g|d[++i]]}for(j=(a-f>>3)+b;b<j;)d=this.BGCHRBank1[b],d<this.gfxBackgroundBankOffset&&(d|=256),g=this.BGCHRBank2[b++],
d=this.tileCache[(g&8)<<8|(g&96)<<4|d],g=(g&7)<<2,i=c,this.frameBuffer[f++]=this.gbcBGPalette[g|d[i++]],this.frameBuffer[f++]=this.gbcBGPalette[g|d[i++]],this.frameBuffer[f++]=this.gbcBGPalette[g|d[i++]],this.frameBuffer[f++]=this.gbcBGPalette[g|d[i++]],this.frameBuffer[f++]=this.gbcBGPalette[g|d[i++]],this.frameBuffer[f++]=this.gbcBGPalette[g|d[i++]],this.frameBuffer[f++]=this.gbcBGPalette[g|d[i++]],this.frameBuffer[f++]=this.gbcBGPalette[g|d[i]];if(f<a)switch(d=this.BGCHRBank1[b],d<this.gfxBackgroundBankOffset&&
(d|=256),g=this.BGCHRBank2[b],d=this.tileCache[(g&8)<<8|(g&96)<<4|d],g=(g&7)<<2,a-f){case 7:this.frameBuffer[f+6]=this.gbcBGPalette[g|d[c|6]];case 6:this.frameBuffer[f+5]=this.gbcBGPalette[g|d[c|5]];case 5:this.frameBuffer[f+4]=this.gbcBGPalette[g|d[c|4]];case 4:this.frameBuffer[f+3]=this.gbcBGPalette[g|d[c|3]];case 3:this.frameBuffer[f+2]=this.gbcBGPalette[g|d[c|2]];case 2:this.frameBuffer[f+1]=this.gbcBGPalette[g|d[c|1]];case 1:this.frameBuffer[f]=this.gbcBGPalette[g|d[c]]}}};
GameBoyCore.prototype.WindowGBLayerRender=function(a){if(this.gfxWindowDisplay){var b=a-this.windowY;if(0<=b){var a=0<this.windowX?this.windowX+this.currentX:this.currentX,c=this.pixelStart+a,e=this.pixelStart+this.pixelEnd;if(c<e){var f=(b&7)<<3,b=(this.gfxWindowCHRBankPosition|(b&248)<<2)+(this.currentX>>3),h=this.BGCHRBank1[b];h<this.gfxBackgroundBankOffset&&(h|=256);for(var h=this.tileCache[h],d=a-this.windowX&7,a=Math.min(8,d+e-c);d<a;)this.frameBuffer[c++]=this.BGPalette[h[f|d++]];for(a=b+(e-
c>>3);b<a;)h=this.BGCHRBank1[++b],h<this.gfxBackgroundBankOffset&&(h|=256),h=this.tileCache[h],d=f,this.frameBuffer[c++]=this.BGPalette[h[d++]],this.frameBuffer[c++]=this.BGPalette[h[d++]],this.frameBuffer[c++]=this.BGPalette[h[d++]],this.frameBuffer[c++]=this.BGPalette[h[d++]],this.frameBuffer[c++]=this.BGPalette[h[d++]],this.frameBuffer[c++]=this.BGPalette[h[d++]],this.frameBuffer[c++]=this.BGPalette[h[d++]],this.frameBuffer[c++]=this.BGPalette[h[d]];if(c<e)switch(h=this.BGCHRBank1[++b],h<this.gfxBackgroundBankOffset&&
(h|=256),h=this.tileCache[h],e-c){case 7:this.frameBuffer[c+6]=this.BGPalette[h[f|6]];case 6:this.frameBuffer[c+5]=this.BGPalette[h[f|5]];case 5:this.frameBuffer[c+4]=this.BGPalette[h[f|4]];case 4:this.frameBuffer[c+3]=this.BGPalette[h[f|3]];case 3:this.frameBuffer[c+2]=this.BGPalette[h[f|2]];case 2:this.frameBuffer[c+1]=this.BGPalette[h[f|1]];case 1:this.frameBuffer[c]=this.BGPalette[h[f]]}}}}};
GameBoyCore.prototype.WindowGBCLayerRender=function(a){if(this.gfxWindowDisplay){var b=a-this.windowY;if(0<=b){var a=0<this.windowX?this.windowX+this.currentX:this.currentX,c=this.pixelStart+a,e=this.pixelStart+this.pixelEnd;if(c<e){var f=(b&7)<<3,b=(this.gfxWindowCHRBankPosition|(b&248)<<2)+(this.currentX>>3),h=this.BGCHRBank1[b];h<this.gfxBackgroundBankOffset&&(h|=256);for(var d=this.BGCHRBank2[b],h=this.tileCache[(d&8)<<8|(d&96)<<4|h],d=(d&7)<<2|(d&128)>>2,g=a-this.windowX&7,a=Math.min(8,g+e-c);g<
a;)this.frameBuffer[c++]=this.gbcBGPalette[d|h[f|g++]];for(a=b+(e-c>>3);b<a;)h=this.BGCHRBank1[++b],h<this.gfxBackgroundBankOffset&&(h|=256),d=this.BGCHRBank2[b],h=this.tileCache[(d&8)<<8|(d&96)<<4|h],d=(d&7)<<2|(d&128)>>2,g=f,this.frameBuffer[c++]=this.gbcBGPalette[d|h[g++]],this.frameBuffer[c++]=this.gbcBGPalette[d|h[g++]],this.frameBuffer[c++]=this.gbcBGPalette[d|h[g++]],this.frameBuffer[c++]=this.gbcBGPalette[d|h[g++]],this.frameBuffer[c++]=this.gbcBGPalette[d|h[g++]],this.frameBuffer[c++]=this.gbcBGPalette[d|
h[g++]],this.frameBuffer[c++]=this.gbcBGPalette[d|h[g++]],this.frameBuffer[c++]=this.gbcBGPalette[d|h[g]];if(c<e)switch(h=this.BGCHRBank1[++b],h<this.gfxBackgroundBankOffset&&(h|=256),d=this.BGCHRBank2[b],h=this.tileCache[(d&8)<<8|(d&96)<<4|h],d=(d&7)<<2|(d&128)>>2,e-c){case 7:this.frameBuffer[c+6]=this.gbcBGPalette[d|h[f|6]];case 6:this.frameBuffer[c+5]=this.gbcBGPalette[d|h[f|5]];case 5:this.frameBuffer[c+4]=this.gbcBGPalette[d|h[f|4]];case 4:this.frameBuffer[c+3]=this.gbcBGPalette[d|h[f|3]];case 3:this.frameBuffer[c+
2]=this.gbcBGPalette[d|h[f|2]];case 2:this.frameBuffer[c+1]=this.gbcBGPalette[d|h[f|1]];case 1:this.frameBuffer[c]=this.gbcBGPalette[d|h[f]]}}}}};
GameBoyCore.prototype.WindowGBCLayerRenderNoPriorityFlagging=function(a){if(this.gfxWindowDisplay){var b=a-this.windowY;if(0<=b){var a=0<this.windowX?this.windowX+this.currentX:this.currentX,c=this.pixelStart+a,e=this.pixelStart+this.pixelEnd;if(c<e){var f=(b&7)<<3,b=(this.gfxWindowCHRBankPosition|(b&248)<<2)+(this.currentX>>3),h=this.BGCHRBank1[b];h<this.gfxBackgroundBankOffset&&(h|=256);for(var d=this.BGCHRBank2[b],h=this.tileCache[(d&8)<<8|(d&96)<<4|h],d=(d&7)<<2,g=a-this.windowX&7,a=Math.min(8,
g+e-c);g<a;)this.frameBuffer[c++]=this.gbcBGPalette[d|h[f|g++]];for(a=b+(e-c>>3);b<a;)h=this.BGCHRBank1[++b],h<this.gfxBackgroundBankOffset&&(h|=256),d=this.BGCHRBank2[b],h=this.tileCache[(d&8)<<8|(d&96)<<4|h],d=(d&7)<<2,g=f,this.frameBuffer[c++]=this.gbcBGPalette[d|h[g++]],this.frameBuffer[c++]=this.gbcBGPalette[d|h[g++]],this.frameBuffer[c++]=this.gbcBGPalette[d|h[g++]],this.frameBuffer[c++]=this.gbcBGPalette[d|h[g++]],this.frameBuffer[c++]=this.gbcBGPalette[d|h[g++]],this.frameBuffer[c++]=this.gbcBGPalette[d|
h[g++]],this.frameBuffer[c++]=this.gbcBGPalette[d|h[g++]],this.frameBuffer[c++]=this.gbcBGPalette[d|h[g]];if(c<e)switch(h=this.BGCHRBank1[++b],h<this.gfxBackgroundBankOffset&&(h|=256),d=this.BGCHRBank2[b],h=this.tileCache[(d&8)<<8|(d&96)<<4|h],d=(d&7)<<2,e-c){case 7:this.frameBuffer[c+6]=this.gbcBGPalette[d|h[f|6]];case 6:this.frameBuffer[c+5]=this.gbcBGPalette[d|h[f|5]];case 5:this.frameBuffer[c+4]=this.gbcBGPalette[d|h[f|4]];case 4:this.frameBuffer[c+3]=this.gbcBGPalette[d|h[f|3]];case 3:this.frameBuffer[c+
2]=this.gbcBGPalette[d|h[f|2]];case 2:this.frameBuffer[c+1]=this.gbcBGPalette[d|h[f|1]];case 1:this.frameBuffer[c]=this.gbcBGPalette[d|h[f]]}}}}};
GameBoyCore.prototype.SpriteGBLayerRender=function(a){if(this.gfxSpriteShow){for(var a=a+16,b=65024,c=0,b=1,e=0,f=0,h=0,d=0,g=null,i=0,j=0,n=0,p=0,l=0;168>b;)this.sortBuffer[b++]=255;if(this.gfxSpriteNormalHeight)for(n=this.findLowestSpriteDrawable(a,7);j<n;++j){b=this.OAMAddressCache[j];c=a-this.memory[b]<<3;h=this.memory[b|3];d=(h&16)>>2;g=this.tileCache[(h&96)<<4|this.memory[b|2]];l=e=this.memory[b|1];f=Math.min(168-l,8);b=7<l?0:8-l;for(p=this.pixelStart+(8<l?l-8:0);b<f;++b,++p,++l)this.sortBuffer[l]>
e&&(33554432<=this.frameBuffer[p]?(i=g[c|b],0<i&&(this.frameBuffer[p]=this.OBJPalette[d|i],this.sortBuffer[l]=e)):16777216>this.frameBuffer[p]&&(i=g[c|b],0<i&&128>h&&(this.frameBuffer[p]=this.OBJPalette[d|i],this.sortBuffer[l]=e)))}else for(n=this.findLowestSpriteDrawable(a,15);j<n;++j){b=this.OAMAddressCache[j];c=a-this.memory[b]<<3;h=this.memory[b|3];d=(h&16)>>2;g=(h&64)==(64&c)?this.tileCache[(h&96)<<4|this.memory[b|2]&254]:this.tileCache[(h&96)<<4|this.memory[b|2]|1];c&=63;l=e=this.memory[b|1];
f=Math.min(168-l,8);b=7<l?0:8-l;for(p=this.pixelStart+(8<l?l-8:0);b<f;++b,++p,++l)this.sortBuffer[l]>e&&(33554432<=this.frameBuffer[p]?(i=g[c|b],0<i&&(this.frameBuffer[p]=this.OBJPalette[d|i],this.sortBuffer[l]=e)):16777216>this.frameBuffer[p]&&(i=g[c|b],0<i&&128>h&&(this.frameBuffer[p]=this.OBJPalette[d|i],this.sortBuffer[l]=e)))}}};GameBoyCore.prototype.findLowestSpriteDrawable=function(a,b){for(var c=65024,e=0,f=0;65184>c&&10>e;)f=a-this.memory[c],(f&b)==f&&(this.OAMAddressCache[e++]=c),c+=4;return e};
GameBoyCore.prototype.SpriteGBCLayerRender=function(a){if(this.gfxSpriteShow){var b=65024,a=a+16,c=0,e=0,f=0,h=0,d=0,g=0,i=null,j=c=0,n=0;if(this.gfxSpriteNormalHeight)for(;65184>b&&10>n;b+=4){if(c=a-this.memory[b],(c&7)==c){e=this.memory[b|1]-8;f=Math.min(160,e+8);d=this.memory[b|3];g=(d&7)<<2;i=this.tileCache[(d&8)<<8|(d&96)<<4|this.memory[b|2]];h=0<e?e:0;e-=c<<3;for(j=this.pixelStart+h;h<f;++h,++j)33554432<=this.frameBuffer[j]?(c=i[h-e],0<c&&(this.frameBuffer[j]=this.gbcOBJPalette[g|c])):16777216>
this.frameBuffer[j]&&(c=i[h-e],0<c&&128>d&&(this.frameBuffer[j]=this.gbcOBJPalette[g|c]));++n}}else for(;65184>b&&10>n;b+=4)if(c=a-this.memory[b],(c&15)==c){e=this.memory[b|1]-8;f=Math.min(160,e+8);d=this.memory[b|3];g=(d&7)<<2;i=(d&64)==(64&c<<3)?this.tileCache[(d&8)<<8|(d&96)<<4|this.memory[b|2]&254]:this.tileCache[(d&8)<<8|(d&96)<<4|this.memory[b|2]|1];h=0<e?e:0;e-=(c&7)<<3;for(j=this.pixelStart+h;h<f;++h,++j)33554432<=this.frameBuffer[j]?(c=i[h-e],0<c&&(this.frameBuffer[j]=this.gbcOBJPalette[g|
c])):16777216>this.frameBuffer[j]&&(c=i[h-e],0<c&&128>d&&(this.frameBuffer[j]=this.gbcOBJPalette[g|c]));++n}}};GameBoyCore.prototype.generateGBTileLine=function(a){var b=this.memory[1|a]<<8|this.memory[40958&a],c=this.tileCache[(a&8176)>>4],a=(a&14)<<2;c[a|7]=(b&256)>>7|b&1;c[a|6]=(b&512)>>8|(b&2)>>1;c[a|5]=(b&1024)>>9|(b&4)>>2;c[a|4]=(b&2048)>>10|(b&8)>>3;c[a|3]=(b&4096)>>11|(b&16)>>4;c[a|2]=(b&8192)>>12|(b&32)>>5;c[a|1]=(b&16384)>>13|(b&64)>>6;c[a]=(b&32768)>>14|(b&128)>>7};
GameBoyCore.prototype.generateGBCTileLineBank1=function(a){var b=this.memory[1|a]<<8|this.memory[40958&a],a=a&8190,c=this.tileCache[a>>4],e=this.tileCache[512|a>>4],f=this.tileCache[1024|a>>4],h=this.tileCache[1536|a>>4],a=(a&14)<<2,d=56-a;h[d]=e[a]=f[d|7]=c[a|7]=(b&256)>>7|b&1;h[d|1]=e[a|1]=f[d|6]=c[a|6]=(b&512)>>8|(b&2)>>1;h[d|2]=e[a|2]=f[d|5]=c[a|5]=(b&1024)>>9|(b&4)>>2;h[d|3]=e[a|3]=f[d|4]=c[a|4]=(b&2048)>>10|(b&8)>>3;h[d|4]=e[a|4]=f[d|3]=c[a|3]=(b&4096)>>11|(b&16)>>4;h[d|5]=e[a|5]=f[d|2]=c[a|
2]=(b&8192)>>12|(b&32)>>5;h[d|6]=e[a|6]=f[d|1]=c[a|1]=(b&16384)>>13|(b&64)>>6;h[d|7]=e[a|7]=f[d]=c[a]=(b&32768)>>14|(b&128)>>7};
GameBoyCore.prototype.generateGBCTileBank1=function(a){var b=a>>4,c=this.tileCache[b],e=this.tileCache[512|b],f=this.tileCache[1024|b],h=this.tileCache[1536|b],d=0,a=a|32768,b=0,g=56;do d=this.memory[1|a]<<8|this.memory[a],h[g]=e[b]=f[g|7]=c[b|7]=(d&256)>>7|d&1,h[g|1]=e[b|1]=f[g|6]=c[b|6]=(d&512)>>8|(d&2)>>1,h[g|2]=e[b|2]=f[g|5]=c[b|5]=(d&1024)>>9|(d&4)>>2,h[g|3]=e[b|3]=f[g|4]=c[b|4]=(d&2048)>>10|(d&8)>>3,h[g|4]=e[b|4]=f[g|3]=c[b|3]=(d&4096)>>11|(d&16)>>4,h[g|5]=e[b|5]=f[g|2]=c[b|2]=(d&8192)>>12|
(d&32)>>5,h[g|6]=e[b|6]=f[g|1]=c[b|1]=(d&16384)>>13|(d&64)>>6,h[g|7]=e[b|7]=f[g]=c[b]=(d&32768)>>14|(d&128)>>7,b+=8,g-=8,a+=2;while(-1<g)};
GameBoyCore.prototype.generateGBCTileLineBank2=function(a){var b=this.VRAM[1|a]<<8|this.VRAM[8190&a],c=this.tileCache[2048|a>>4],e=this.tileCache[2560|a>>4],f=this.tileCache[3072|a>>4],h=this.tileCache[3584|a>>4],a=(a&14)<<2,d=56-a;h[d]=e[a]=f[d|7]=c[a|7]=(b&256)>>7|b&1;h[d|1]=e[a|1]=f[d|6]=c[a|6]=(b&512)>>8|(b&2)>>1;h[d|2]=e[a|2]=f[d|5]=c[a|5]=(b&1024)>>9|(b&4)>>2;h[d|3]=e[a|3]=f[d|4]=c[a|4]=(b&2048)>>10|(b&8)>>3;h[d|4]=e[a|4]=f[d|3]=c[a|3]=(b&4096)>>11|(b&16)>>4;h[d|5]=e[a|5]=f[d|2]=c[a|2]=(b&8192)>>
12|(b&32)>>5;h[d|6]=e[a|6]=f[d|1]=c[a|1]=(b&16384)>>13|(b&64)>>6;h[d|7]=e[a|7]=f[d]=c[a]=(b&32768)>>14|(b&128)>>7};
GameBoyCore.prototype.generateGBCTileBank2=function(a){var b=a>>4,c=this.tileCache[2048|b],e=this.tileCache[2560|b],f=this.tileCache[3072|b],h=this.tileCache[3584|b],d=0,b=0,g=56;do d=this.VRAM[1|a]<<8|this.VRAM[a],h[g]=e[b]=f[g|7]=c[b|7]=(d&256)>>7|d&1,h[g|1]=e[b|1]=f[g|6]=c[b|6]=(d&512)>>8|(d&2)>>1,h[g|2]=e[b|2]=f[g|5]=c[b|5]=(d&1024)>>9|(d&4)>>2,h[g|3]=e[b|3]=f[g|4]=c[b|4]=(d&2048)>>10|(d&8)>>3,h[g|4]=e[b|4]=f[g|3]=c[b|3]=(d&4096)>>11|(d&16)>>4,h[g|5]=e[b|5]=f[g|2]=c[b|2]=(d&8192)>>12|(d&32)>>
5,h[g|6]=e[b|6]=f[g|1]=c[b|1]=(d&16384)>>13|(d&64)>>6,h[g|7]=e[b|7]=f[g]=c[b]=(d&32768)>>14|(d&128)>>7,b+=8,g-=8,a+=2;while(-1<g)};
GameBoyCore.prototype.generateGBOAMTileLine=function(a){var b=this.memory[1|a]<<8|this.memory[40958&a],a=a&8190,c=this.tileCache[a>>4],e=this.tileCache[512|a>>4],f=this.tileCache[1024|a>>4],h=this.tileCache[1536|a>>4],a=(a&14)<<2,d=56-a;h[d]=e[a]=f[d|7]=c[a|7]=(b&256)>>7|b&1;h[d|1]=e[a|1]=f[d|6]=c[a|6]=(b&512)>>8|(b&2)>>1;h[d|2]=e[a|2]=f[d|5]=c[a|5]=(b&1024)>>9|(b&4)>>2;h[d|3]=e[a|3]=f[d|4]=c[a|4]=(b&2048)>>10|(b&8)>>3;h[d|4]=e[a|4]=f[d|3]=c[a|3]=(b&4096)>>11|(b&16)>>4;h[d|5]=e[a|5]=f[d|2]=c[a|2]=
(b&8192)>>12|(b&32)>>5;h[d|6]=e[a|6]=f[d|1]=c[a|1]=(b&16384)>>13|(b&64)>>6;h[d|7]=e[a|7]=f[d]=c[a]=(b&32768)>>14|(b&128)>>7};GameBoyCore.prototype.graphicsJIT=function(){this.LCDisOn&&(this.totalLinesPassed=0,this.graphicsJITScanlineGroup())};GameBoyCore.prototype.graphicsJITVBlank=function(){this.totalLinesPassed+=this.queuedScanLines;this.graphicsJITScanlineGroup()};
GameBoyCore.prototype.graphicsJITScanlineGroup=function(){for(;0<this.queuedScanLines;)this.renderScanLine(this.lastUnrenderedLine),143>this.lastUnrenderedLine?++this.lastUnrenderedLine:this.lastUnrenderedLine=0,--this.queuedScanLines};GameBoyCore.prototype.incrementScanLineQueue=function(){144>this.queuedScanLines?++this.queuedScanLines:(this.currentX=0,this.midScanlineOffset=-1,143>this.lastUnrenderedLine?++this.lastUnrenderedLine:this.lastUnrenderedLine=0)};
GameBoyCore.prototype.midScanLineJIT=function(){this.graphicsJIT();this.renderMidScanLine()};
GameBoyCore.prototype.launchIRQ=function(){var a=0,b=1;do{if((b&this.IRQLineMatched)==b){this.IME=!1;this.interruptsRequested-=b;this.IRQLineMatched=0;this.CPUTicks=20;this.stackPointer=this.stackPointer-1&65535;this.memoryWriter[this.stackPointer](this,this.stackPointer,this.programCounter>>8);this.stackPointer=this.stackPointer-1&65535;this.memoryWriter[this.stackPointer](this,this.stackPointer,this.programCounter&255);this.programCounter=64|a<<3;this.updateCore();break}b=1<<++a}while(5>a)};
GameBoyCore.prototype.checkIRQMatching=function(){this.IME&&(this.IRQLineMatched=this.interruptsEnabled&this.interruptsRequested&31)};
GameBoyCore.prototype.calculateHALTPeriod=function(){if(this.halt)a=this.remainingClocks;else{this.halt=!0;var a=-1,b=0;if(this.LCDisOn&&(1==(this.interruptsEnabled&1)&&(a=456*((1==this.modeSTAT?298:144)-this.actualScanLine)-this.LCDTicks<<this.doubleSpeedShifter),2==(this.interruptsEnabled&2))){if(this.mode0TriggerSTAT&&(b=this.clocksUntilMode0()-this.LCDTicks<<this.doubleSpeedShifter,b<=a||-1==a))a=b;if(this.mode1TriggerSTAT&&0==(this.interruptsEnabled&1)&&(b=456*((1==this.modeSTAT?298:144)-this.actualScanLine)-
this.LCDTicks<<this.doubleSpeedShifter,b<=a||-1==a))a=b;if(this.mode2TriggerSTAT&&(b=(143<=this.actualScanLine?456*(154-this.actualScanLine):456)-this.LCDTicks<<this.doubleSpeedShifter,b<=a||-1==a))a=b;if(this.LYCMatchTriggerSTAT&&153>=this.memory[65349]&&(b=this.clocksUntilLYCMatch()-this.LCDTicks<<this.doubleSpeedShifter,b<=a||-1==a))a=b}if(this.TIMAEnabled&&4==(this.interruptsEnabled&4)&&(b=(256-this.memory[65285])*this.TACClocker-this.timerTicks,b<=a||-1==a))a=b;if(0<this.serialTimer&&8==(this.interruptsEnabled&
8)&&(this.serialTimer<=a||-1==a))a=this.serialTimer}b=this.CPUCyclesTotal-this.emulatorTicks<<this.doubleSpeedShifter;0<=a?a<=b?(this.CPUTicks=Math.max(a,this.CPUTicks),this.updateCoreFull(),this.halt=!1,this.CPUTicks=0):(this.CPUTicks=Math.max(b,this.CPUTicks),this.remainingClocks=a-this.CPUTicks):this.CPUTicks+=b};GameBoyCore.prototype.memoryRead=function(a){return this.memoryReader[a](this,a)};GameBoyCore.prototype.memoryHighRead=function(a){return this.memoryHighReader[a](this,a)};
GameBoyCore.prototype.memoryReadJumpCompile=function(){for(var a=0;65535>=a;a++)if(16384>a)this.memoryReader[a]=this.memoryReadNormal;else if(32768>a)this.memoryReader[a]=this.memoryReadROM;else if(38912>a)this.memoryReader[a]=this.cGBC?this.VRAMDATAReadCGBCPU:this.VRAMDATAReadDMGCPU;else if(40960>a)this.memoryReader[a]=this.cGBC?this.VRAMCHRReadCGBCPU:this.VRAMCHRReadDMGCPU;else if(40960<=a&&49152>a)this.memoryReader[a]=0.0625==this.numRAMBanks&&41472>a||1<=this.numRAMBanks?this.cMBC7?this.memoryReadMBC7:
this.cMBC3?this.memoryReadMBC3:this.memoryReadMBC:this.memoryReadBAD;else if(49152<=a&&57344>a)this.memoryReader[a]=!this.cGBC||53248>a?this.memoryReadNormal:this.memoryReadGBCMemory;else if(57344<=a&&65024>a)this.memoryReader[a]=!this.cGBC||61440>a?this.memoryReadECHONormal:this.memoryReadECHOGBCMemory;else if(65184>a)this.memoryReader[a]=this.memoryReadOAM;else if(this.cGBC&&65184<=a&&65280>a)this.memoryReader[a]=this.memoryReadNormal;else if(65280<=a)switch(a){case 65280:this.memoryHighReader[0]=
this.memoryReader[65280]=function(a){return 192|a.memory[65280]};break;case 65281:this.memoryHighReader[1]=this.memoryReader[65281]=function(a){return 128>a.memory[65282]?a.memory[65281]:255};break;case 65282:this.memoryHighReader[2]=this.cGBC?this.memoryReader[65282]=function(a){return(0>=a.serialTimer?124:252)|a.memory[65282]}:this.memoryReader[65282]=function(a){return(0>=a.serialTimer?126:254)|a.memory[65282]};break;case 65283:this.memoryHighReader[3]=this.memoryReader[65283]=this.memoryReadBAD;
break;case 65284:this.memoryHighReader[4]=this.memoryReader[65284]=function(a){a.memory[65284]=a.memory[65284]+(a.DIVTicks>>8)&255;a.DIVTicks&=255;return a.memory[65284]};break;case 65285:case 65286:this.memoryHighReader[a&255]=this.memoryHighReadNormal;this.memoryReader[a]=this.memoryReadNormal;break;case 65287:this.memoryHighReader[7]=this.memoryReader[65287]=function(a){return 248|a.memory[65287]};break;case 65288:case 65289:case 65290:case 65291:case 65292:case 65293:case 65294:this.memoryHighReader[a&
255]=this.memoryReader[a]=this.memoryReadBAD;break;case 65295:this.memoryHighReader[15]=this.memoryReader[65295]=function(a){return 224|a.interruptsRequested};break;case 65296:this.memoryHighReader[16]=this.memoryReader[65296]=function(a){return 128|a.memory[65296]};break;case 65297:this.memoryHighReader[17]=this.memoryReader[65297]=function(a){return 63|a.memory[65297]};break;case 65298:this.memoryHighReader[18]=this.memoryHighReadNormal;this.memoryReader[65298]=this.memoryReadNormal;break;case 65299:this.memoryHighReader[19]=
this.memoryReader[65299]=this.memoryReadBAD;break;case 65300:this.memoryHighReader[20]=this.memoryReader[65300]=function(a){return 191|a.memory[65300]};break;case 65301:this.memoryHighReader[21]=this.memoryReadBAD;this.memoryReader[65301]=this.memoryReadBAD;break;case 65302:this.memoryHighReader[22]=this.memoryReader[65302]=function(a){return 63|a.memory[65302]};break;case 65303:this.memoryHighReader[23]=this.memoryHighReadNormal;this.memoryReader[65303]=this.memoryReadNormal;break;case 65304:this.memoryHighReader[24]=
this.memoryReader[65304]=this.memoryReadBAD;break;case 65305:this.memoryHighReader[25]=this.memoryReader[65305]=function(a){return 191|a.memory[65305]};break;case 65306:this.memoryHighReader[26]=this.memoryReader[65306]=function(a){return 127|a.memory[65306]};break;case 65307:this.memoryHighReader[27]=this.memoryReader[65307]=this.memoryReadBAD;break;case 65308:this.memoryHighReader[28]=this.memoryReader[65308]=function(a){return 159|a.memory[65308]};break;case 65309:this.memoryHighReader[29]=this.memoryReader[65309]=
this.memoryReadBAD;break;case 65310:this.memoryHighReader[30]=this.memoryReader[65310]=function(a){return 191|a.memory[65310]};break;case 65311:case 65312:this.memoryHighReader[a&255]=this.memoryReader[a]=this.memoryReadBAD;break;case 65313:case 65314:this.memoryHighReader[a&255]=this.memoryHighReadNormal;this.memoryReader[a]=this.memoryReadNormal;break;case 65315:this.memoryHighReader[35]=this.memoryReader[65315]=function(a){return 191|a.memory[65315]};break;case 65316:case 65317:this.memoryHighReader[a&
255]=this.memoryHighReadNormal;this.memoryReader[a]=this.memoryReadNormal;break;case 65318:this.memoryHighReader[38]=this.memoryReader[65318]=function(a){a.audioJIT();return 112|a.memory[65318]};break;case 65319:case 65320:case 65321:case 65322:case 65323:case 65324:case 65325:case 65326:case 65327:this.memoryHighReader[a&255]=this.memoryReader[a]=this.memoryReadBAD;break;case 65328:case 65329:case 65330:case 65331:case 65332:case 65333:case 65334:case 65335:case 65336:case 65337:case 65338:case 65339:case 65340:case 65341:case 65342:case 65343:this.memoryReader[a]=
function(a,c){return a.channel3canPlay?a.memory[65280|a.channel3lastSampleLookup>>1]:a.memory[c]};this.memoryHighReader[a&255]=function(a,c){return a.channel3canPlay?a.memory[65280|a.channel3lastSampleLookup>>1]:a.memory[65280|c]};break;case 65344:this.memoryHighReader[64]=this.memoryHighReadNormal;this.memoryReader[65344]=this.memoryReadNormal;break;case 65345:this.memoryHighReader[65]=this.memoryReader[65345]=function(a){return 128|a.memory[65345]|a.modeSTAT};break;case 65346:this.memoryHighReader[66]=
this.memoryReader[65346]=function(a){return a.backgroundY};break;case 65347:this.memoryHighReader[67]=this.memoryReader[65347]=function(a){return a.backgroundX};break;case 65348:this.memoryHighReader[68]=this.memoryReader[65348]=function(a){return a.LCDisOn?a.memory[65348]:0};break;case 65349:case 65350:case 65351:case 65352:case 65353:this.memoryHighReader[a&255]=this.memoryHighReadNormal;this.memoryReader[a]=this.memoryReadNormal;break;case 65354:this.memoryHighReader[74]=this.memoryReader[65354]=
function(a){return a.windowY};break;case 65355:this.memoryHighReader[75]=this.memoryHighReadNormal;this.memoryReader[65355]=this.memoryReadNormal;break;case 65356:this.memoryHighReader[76]=this.memoryReader[65356]=this.memoryReadBAD;break;case 65357:this.memoryHighReader[77]=this.memoryHighReadNormal;this.memoryReader[65357]=this.memoryReadNormal;break;case 65358:this.memoryHighReader[78]=this.memoryReader[65358]=this.memoryReadBAD;break;case 65359:this.memoryHighReader[79]=this.memoryReader[65359]=
function(a){return a.currVRAMBank};break;case 65360:case 65361:case 65362:case 65363:case 65364:this.memoryHighReader[a&255]=this.memoryHighReadNormal;this.memoryReader[a]=this.memoryReadNormal;break;case 65365:this.cGBC?this.memoryHighReader[85]=this.memoryReader[65365]=function(a){!a.LCDisOn&&a.hdmaRunning&&(a.DMAWrite((a.memory[65365]&127)+1),a.memory[65365]=255,a.hdmaRunning=!1);return a.memory[65365]}:(this.memoryReader[65365]=this.memoryReadNormal,this.memoryHighReader[85]=this.memoryHighReadNormal);
break;case 65366:this.cGBC?this.memoryHighReader[86]=this.memoryReader[65366]=function(a){return 60|(192<=a.memory[65366]?2|a.memory[65366]&193:a.memory[65366]&195)}:(this.memoryReader[65366]=this.memoryReadNormal,this.memoryHighReader[86]=this.memoryHighReadNormal);break;case 65367:case 65368:case 65369:case 65370:case 65371:case 65372:case 65373:case 65374:case 65375:case 65376:case 65377:case 65378:case 65379:case 65380:case 65381:case 65382:case 65383:this.memoryHighReader[a&255]=this.memoryReader[a]=
this.memoryReadBAD;break;case 65384:case 65385:case 65386:case 65387:this.memoryHighReader[a&255]=this.memoryHighReadNormal;this.memoryReader[a]=this.memoryReadNormal;break;case 65388:this.memoryHighReader[108]=this.cGBC?this.memoryReader[65388]=function(a){return 254|a.memory[65388]}:this.memoryReader[65388]=this.memoryReadBAD;break;case 65389:case 65390:case 65391:this.memoryHighReader[a&255]=this.memoryReader[a]=this.memoryReadBAD;break;case 65392:this.memoryHighReader[112]=this.cGBC?this.memoryReader[65392]=
function(a){return 64|a.memory[65392]}:this.memoryReader[65392]=this.memoryReadBAD;break;case 65393:this.memoryHighReader[113]=this.memoryReader[65393]=this.memoryReadBAD;break;case 65394:case 65395:this.memoryHighReader[a&255]=this.memoryReader[a]=this.memoryReadNormal;break;case 65396:this.memoryHighReader[116]=this.cGBC?this.memoryReader[65396]=this.memoryReadNormal:this.memoryReader[65396]=this.memoryReadBAD;break;case 65397:this.memoryHighReader[117]=this.memoryReader[65397]=function(a){return 143|
a.memory[65397]};break;case 65398:case 65399:this.memoryHighReader[a&255]=this.memoryReader[a]=function(){return 0};break;case 65400:case 65401:case 65402:case 65403:case 65404:case 65405:case 65406:case 65407:this.memoryHighReader[a&255]=this.memoryReader[a]=this.memoryReadBAD;break;case 65535:this.memoryHighReader[255]=this.memoryReader[65535]=function(a){return a.interruptsEnabled};break;default:this.memoryReader[a]=this.memoryReadNormal,this.memoryHighReader[a&255]=this.memoryHighReadNormal}else this.memoryReader[a]=
this.memoryReadBAD};GameBoyCore.prototype.memoryReadNormal=function(a,b){return a.memory[b]};GameBoyCore.prototype.memoryHighReadNormal=function(a,b){return a.memory[65280|b]};GameBoyCore.prototype.memoryReadROM=function(a,b){return a.ROM[a.currentROMBank+b]};GameBoyCore.prototype.memoryReadMBC=function(a,b){return a.MBCRAMBanksEnabled||settings[10]?a.MBCRam[b+a.currMBCRAMBankPosition]:255};
GameBoyCore.prototype.memoryReadMBC7=function(a,b){if(a.MBCRAMBanksEnabled||settings[10])switch(b){case 40960:case 41056:case 41072:return 0;case 41088:return 0;case 41040:return a.highY;case 41024:return a.lowY;case 41008:return a.highX;case 40992:return a.lowX;default:return a.MBCRam[b+a.currMBCRAMBankPosition]}return 255};
GameBoyCore.prototype.memoryReadMBC3=function(a,b){if(a.MBCRAMBanksEnabled||settings[10])switch(a.currMBCRAMBank){case 0:case 1:case 2:case 3:return a.MBCRam[b+a.currMBCRAMBankPosition];case 8:return a.latchedSeconds;case 9:return a.latchedMinutes;case 10:return a.latchedHours;case 11:return a.latchedLDays;case 12:return(a.RTCDayOverFlow?128:0)+(a.RTCHALT?64:0)+a.latchedHDays}return 255};GameBoyCore.prototype.memoryReadGBCMemory=function(a,b){return a.GBCMemory[b+a.gbcRamBankPosition]};
GameBoyCore.prototype.memoryReadOAM=function(a,b){return 1<a.modeSTAT?255:a.memory[b]};GameBoyCore.prototype.memoryReadECHOGBCMemory=function(a,b){return a.GBCMemory[b+a.gbcRamBankPositionECHO]};GameBoyCore.prototype.memoryReadECHONormal=function(a,b){return a.memory[b-8192]};GameBoyCore.prototype.memoryReadBAD=function(){return 255};GameBoyCore.prototype.VRAMDATAReadCGBCPU=function(a,b){return 2<a.modeSTAT?255:0==a.currVRAMBank?a.memory[b]:a.VRAM[b&8191]};
GameBoyCore.prototype.VRAMDATAReadDMGCPU=function(a,b){return 2<a.modeSTAT?255:a.memory[b]};GameBoyCore.prototype.VRAMCHRReadCGBCPU=function(a,b){return 2<a.modeSTAT?255:a.BGCHRCurrentBank[b&2047]};GameBoyCore.prototype.VRAMCHRReadDMGCPU=function(a,b){return 2<a.modeSTAT?255:a.BGCHRBank1[b&2047]};
GameBoyCore.prototype.setCurrentMBC1ROMBank=function(){switch(this.ROMBank1offs){case 0:case 32:case 64:case 96:this.currentROMBank=this.ROMBank1offs%this.ROMBankEdge<<14;break;default:this.currentROMBank=this.ROMBank1offs%this.ROMBankEdge-1<<14}};GameBoyCore.prototype.setCurrentMBC2AND3ROMBank=function(){this.currentROMBank=Math.max(this.ROMBank1offs%this.ROMBankEdge-1,0)<<14};GameBoyCore.prototype.setCurrentMBC5ROMBank=function(){this.currentROMBank=this.ROMBank1offs%this.ROMBankEdge-1<<14};
GameBoyCore.prototype.memoryWrite=function(a,b){this.memoryWriter[a](this,a,b)};GameBoyCore.prototype.memoryHighWrite=function(a,b){this.memoryHighWriter[a](this,a,b)};
GameBoyCore.prototype.memoryWriteJumpCompile=function(){for(var a=0;65535>=a;a++)32768>a?this.memoryWriter[a]=this.cMBC1?8192>a?this.MBCWriteEnable:16384>a?this.MBC1WriteROMBank:24576>a?this.MBC1WriteRAMBank:this.MBC1WriteType:this.cMBC2?4096>a?this.MBCWriteEnable:8448<=a&&8704>a?this.MBC2WriteROMBank:this.cartIgnoreWrite:this.cMBC3?8192>a?this.MBCWriteEnable:16384>a?this.MBC3WriteROMBank:24576>a?this.MBC3WriteRAMBank:this.MBC3WriteRTCLatch:this.cMBC5||this.cRUMBLE||this.cMBC7?8192>a?this.MBCWriteEnable:
12288>a?this.MBC5WriteROMBankLow:16384>a?this.MBC5WriteROMBankHigh:24576>a?this.cRUMBLE?this.RUMBLEWriteRAMBank:this.MBC5WriteRAMBank:this.cartIgnoreWrite:this.cHuC3?8192>a?this.MBCWriteEnable:16384>a?this.MBC3WriteROMBank:24576>a?this.HuC3WriteRAMBank:this.cartIgnoreWrite:this.cartIgnoreWrite:36864>a?this.memoryWriter[a]=this.cGBC?this.VRAMGBCDATAWrite:this.VRAMGBDATAWrite:38912>a?this.memoryWriter[a]=this.cGBC?this.VRAMGBCDATAWrite:this.VRAMGBDATAUpperWrite:40960>a?this.memoryWriter[a]=this.cGBC?
this.VRAMGBCCHRMAPWrite:this.VRAMGBCHRMAPWrite:49152>a?this.memoryWriter[a]=0.0625==this.numRAMBanks&&41472>a||1<=this.numRAMBanks?this.cMBC3?this.memoryWriteMBC3RAM:this.memoryWriteMBCRAM:this.cartIgnoreWrite:57344>a?this.memoryWriter[a]=this.cGBC&&53248<=a?this.memoryWriteGBCRAM:this.memoryWriteNormal:65024>a?this.memoryWriter[a]=this.cGBC&&61440<=a?this.memoryWriteECHOGBCRAM:this.memoryWriteECHONormal:65184>=a?this.memoryWriter[a]=this.memoryWriteOAMRAM:65280>a?this.memoryWriter[a]=this.cGBC?this.memoryWriteNormal:
this.cartIgnoreWrite:(this.memoryWriter[a]=this.memoryWriteNormal,this.memoryHighWriter[a&255]=this.memoryHighWriteNormal);this.registerWriteJumpCompile()};GameBoyCore.prototype.MBCWriteEnable=function(a,b,c){a.MBCRAMBanksEnabled=10==(c&15)};GameBoyCore.prototype.MBC1WriteROMBank=function(a,b,c){a.ROMBank1offs=a.ROMBank1offs&96|c&31;a.setCurrentMBC1ROMBank()};
GameBoyCore.prototype.MBC1WriteRAMBank=function(a,b,c){a.MBC1Mode?(a.currMBCRAMBank=c&3,a.currMBCRAMBankPosition=(a.currMBCRAMBank<<13)-40960):(a.ROMBank1offs=(c&3)<<5|a.ROMBank1offs&31,a.setCurrentMBC1ROMBank())};GameBoyCore.prototype.MBC1WriteType=function(a,b,c){a.MBC1Mode=1==(c&1);a.MBC1Mode?(a.ROMBank1offs&=31,a.setCurrentMBC1ROMBank()):(a.currMBCRAMBank=0,a.currMBCRAMBankPosition=-40960)};GameBoyCore.prototype.MBC2WriteROMBank=function(a,b,c){a.ROMBank1offs=c&15;a.setCurrentMBC2AND3ROMBank()};
GameBoyCore.prototype.MBC3WriteROMBank=function(a,b,c){a.ROMBank1offs=c&127;a.setCurrentMBC2AND3ROMBank()};GameBoyCore.prototype.MBC3WriteRAMBank=function(a,b,c){a.currMBCRAMBank=c;4>c&&(a.currMBCRAMBankPosition=(a.currMBCRAMBank<<13)-40960)};GameBoyCore.prototype.MBC3WriteRTCLatch=function(a,b,c){0==c?a.RTCisLatched=!1:a.RTCisLatched||(a.RTCisLatched=!0,a.latchedSeconds=a.RTCSeconds|0,a.latchedMinutes=a.RTCMinutes,a.latchedHours=a.RTCHours,a.latchedLDays=a.RTCDays&255,a.latchedHDays=a.RTCDays>>8)};
GameBoyCore.prototype.MBC5WriteROMBankLow=function(a,b,c){a.ROMBank1offs=a.ROMBank1offs&256|c;a.setCurrentMBC5ROMBank()};GameBoyCore.prototype.MBC5WriteROMBankHigh=function(a,b,c){a.ROMBank1offs=(c&1)<<8|a.ROMBank1offs&255;a.setCurrentMBC5ROMBank()};GameBoyCore.prototype.MBC5WriteRAMBank=function(a,b,c){a.currMBCRAMBank=c&15;a.currMBCRAMBankPosition=(a.currMBCRAMBank<<13)-40960};
GameBoyCore.prototype.RUMBLEWriteRAMBank=function(a,b,c){a.currMBCRAMBank=c&3;a.currMBCRAMBankPosition=(a.currMBCRAMBank<<13)-40960};GameBoyCore.prototype.HuC3WriteRAMBank=function(a,b,c){a.currMBCRAMBank=c&3;a.currMBCRAMBankPosition=(a.currMBCRAMBank<<13)-40960};GameBoyCore.prototype.cartIgnoreWrite=function(){};GameBoyCore.prototype.memoryWriteNormal=function(a,b,c){a.memory[b]=c};GameBoyCore.prototype.memoryHighWriteNormal=function(a,b,c){a.memory[65280|b]=c};
GameBoyCore.prototype.memoryWriteMBCRAM=function(a,b,c){if(a.MBCRAMBanksEnabled||settings[10])a.MBCRam[b+a.currMBCRAMBankPosition]=c};
GameBoyCore.prototype.memoryWriteMBC3RAM=function(a,b,c){if(a.MBCRAMBanksEnabled||settings[10])switch(a.currMBCRAMBank){case 0:case 1:case 2:case 3:a.MBCRam[b+a.currMBCRAMBankPosition]=c;break;case 8:60>c?a.RTCSeconds=c:cout("(Bank #"+a.currMBCRAMBank+") RTC write out of range: "+c,1);break;case 9:60>c?a.RTCMinutes=c:cout("(Bank #"+a.currMBCRAMBank+") RTC write out of range: "+c,1);break;case 10:24>c?a.RTCHours=c:cout("(Bank #"+a.currMBCRAMBank+") RTC write out of range: "+c,1);break;case 11:a.RTCDays=
c&255|a.RTCDays&256;break;case 12:a.RTCDayOverFlow=127<c;a.RTCHalt=64==(c&64);a.RTCDays=(c&1)<<8|a.RTCDays&255;break;default:cout("Invalid MBC3 bank address selected: "+a.currMBCRAMBank,0)}};GameBoyCore.prototype.memoryWriteGBCRAM=function(a,b,c){a.GBCMemory[b+a.gbcRamBankPosition]=c};GameBoyCore.prototype.memoryWriteOAMRAM=function(a,b,c){2>a.modeSTAT&&a.memory[b]!=c&&(a.graphicsJIT(),a.memory[b]=c)};
GameBoyCore.prototype.memoryWriteECHOGBCRAM=function(a,b,c){a.GBCMemory[b+a.gbcRamBankPositionECHO]=c};GameBoyCore.prototype.memoryWriteECHONormal=function(a,b,c){a.memory[b-8192]=c};GameBoyCore.prototype.VRAMGBDATAWrite=function(a,b,c){3>a.modeSTAT&&a.memory[b]!=c&&(a.graphicsJIT(),a.memory[b]=c,a.generateGBOAMTileLine(b))};GameBoyCore.prototype.VRAMGBDATAUpperWrite=function(a,b,c){3>a.modeSTAT&&a.memory[b]!=c&&(a.graphicsJIT(),a.memory[b]=c,a.generateGBTileLine(b))};
GameBoyCore.prototype.VRAMGBCDATAWrite=function(a,b,c){3>a.modeSTAT&&(0==a.currVRAMBank?a.memory[b]!=c&&(a.graphicsJIT(),a.memory[b]=c,a.generateGBCTileLineBank1(b)):(b&=8191,a.VRAM[b]!=c&&(a.graphicsJIT(),a.VRAM[b]=c,a.generateGBCTileLineBank2(b))))};GameBoyCore.prototype.VRAMGBCHRMAPWrite=function(a,b,c){3>a.modeSTAT&&(b&=2047,a.BGCHRBank1[b]!=c&&(a.graphicsJIT(),a.BGCHRBank1[b]=c))};
GameBoyCore.prototype.VRAMGBCCHRMAPWrite=function(a,b,c){3>a.modeSTAT&&(b&=2047,a.BGCHRCurrentBank[b]!=c&&(a.graphicsJIT(),a.BGCHRCurrentBank[b]=c))};
GameBoyCore.prototype.DMAWrite=function(a){this.halt||(this.CPUTicks+=4|a<<5<<this.doubleSpeedShifter);var b=this.memory[65361]<<8|this.memory[65362],c=this.memory[65363]<<8|this.memory[65364],e=this.memoryReader;this.graphicsJIT();var f=this.memory;if(0==this.currVRAMBank){do 6144>c?(f[32768|c]=e[b](this,b++),f[32769|c]=e[b](this,b++),f[32770|c]=e[b](this,b++),f[32771|c]=e[b](this,b++),f[32772|c]=e[b](this,b++),f[32773|c]=e[b](this,b++),f[32774|c]=e[b](this,b++),f[32775|c]=e[b](this,b++),f[32776|
c]=e[b](this,b++),f[32777|c]=e[b](this,b++),f[32778|c]=e[b](this,b++),f[32779|c]=e[b](this,b++),f[32780|c]=e[b](this,b++),f[32781|c]=e[b](this,b++),f[32782|c]=e[b](this,b++),f[32783|c]=e[b](this,b++),this.generateGBCTileBank1(c),c+=16):(c&=2032,this.BGCHRBank1[c++]=e[b](this,b++),this.BGCHRBank1[c++]=e[b](this,b++),this.BGCHRBank1[c++]=e[b](this,b++),this.BGCHRBank1[c++]=e[b](this,b++),this.BGCHRBank1[c++]=e[b](this,b++),this.BGCHRBank1[c++]=e[b](this,b++),this.BGCHRBank1[c++]=e[b](this,b++),this.BGCHRBank1[c++]=
e[b](this,b++),this.BGCHRBank1[c++]=e[b](this,b++),this.BGCHRBank1[c++]=e[b](this,b++),this.BGCHRBank1[c++]=e[b](this,b++),this.BGCHRBank1[c++]=e[b](this,b++),this.BGCHRBank1[c++]=e[b](this,b++),this.BGCHRBank1[c++]=e[b](this,b++),this.BGCHRBank1[c++]=e[b](this,b++),this.BGCHRBank1[c++]=e[b](this,b++),c=c+6144&8176),b&=65520,--a;while(0<a)}else{var h=this.VRAM;do 6144>c?(h[c]=e[b](this,b++),h[c|1]=e[b](this,b++),h[c|2]=e[b](this,b++),h[c|3]=e[b](this,b++),h[c|4]=e[b](this,b++),h[c|5]=e[b](this,b++),
h[c|6]=e[b](this,b++),h[c|7]=e[b](this,b++),h[c|8]=e[b](this,b++),h[c|9]=e[b](this,b++),h[c|10]=e[b](this,b++),h[c|11]=e[b](this,b++),h[c|12]=e[b](this,b++),h[c|13]=e[b](this,b++),h[c|14]=e[b](this,b++),h[c|15]=e[b](this,b++),this.generateGBCTileBank2(c),c+=16):(c&=2032,this.BGCHRBank2[c++]=e[b](this,b++),this.BGCHRBank2[c++]=e[b](this,b++),this.BGCHRBank2[c++]=e[b](this,b++),this.BGCHRBank2[c++]=e[b](this,b++),this.BGCHRBank2[c++]=e[b](this,b++),this.BGCHRBank2[c++]=e[b](this,b++),this.BGCHRBank2[c++]=
e[b](this,b++),this.BGCHRBank2[c++]=e[b](this,b++),this.BGCHRBank2[c++]=e[b](this,b++),this.BGCHRBank2[c++]=e[b](this,b++),this.BGCHRBank2[c++]=e[b](this,b++),this.BGCHRBank2[c++]=e[b](this,b++),this.BGCHRBank2[c++]=e[b](this,b++),this.BGCHRBank2[c++]=e[b](this,b++),this.BGCHRBank2[c++]=e[b](this,b++),this.BGCHRBank2[c++]=e[b](this,b++),c=c+6144&8176),b&=65520,--a;while(0<a)}f[65361]=b>>8;f[65362]=b&240;f[65363]=c>>8;f[65364]=c&240};
GameBoyCore.prototype.registerWriteJumpCompile=function(){this.memoryHighWriter[0]=this.memoryWriter[65280]=function(a,b,c){a.memory[65280]=c&48|(0==(c&32)?a.JoyPad>>4:15)&(0==(c&16)?a.JoyPad&15:15)};this.memoryHighWriter[1]=this.memoryWriter[65281]=function(a,b,c){128>a.memory[65282]&&(a.memory[65281]=c)};this.memoryHighWriter[2]=this.memoryHighWriteNormal;this.memoryWriter[65282]=this.memoryWriteNormal;this.memoryHighWriter[3]=this.memoryWriter[65283]=this.cartIgnoreWrite;this.memoryHighWriter[4]=
this.memoryWriter[65284]=function(a){a.DIVTicks&=255;a.memory[65284]=0};this.memoryHighWriter[5]=this.memoryWriter[65285]=function(a,b,c){a.memory[65285]=c};this.memoryHighWriter[6]=this.memoryWriter[65286]=function(a,b,c){a.memory[65286]=c};this.memoryHighWriter[7]=this.memoryWriter[65287]=function(a,b,c){a.memory[65287]=c&7;a.TIMAEnabled=4==(c&4);a.TACClocker=Math.pow(4,0!=(c&3)?c&3:4)<<2};this.memoryHighWriter[8]=this.memoryWriter[65288]=this.cartIgnoreWrite;this.memoryHighWriter[9]=this.memoryWriter[65289]=
this.cartIgnoreWrite;this.memoryHighWriter[10]=this.memoryWriter[65290]=this.cartIgnoreWrite;this.memoryHighWriter[11]=this.memoryWriter[65291]=this.cartIgnoreWrite;this.memoryHighWriter[12]=this.memoryWriter[65292]=this.cartIgnoreWrite;this.memoryHighWriter[13]=this.memoryWriter[65293]=this.cartIgnoreWrite;this.memoryHighWriter[14]=this.memoryWriter[65294]=this.cartIgnoreWrite;this.memoryHighWriter[15]=this.memoryWriter[65295]=function(a,b,c){a.interruptsRequested=c;a.checkIRQMatching()};this.memoryHighWriter[16]=
this.memoryWriter[65296]=function(a,b,c){a.soundMasterEnabled&&(a.audioJIT(),a.channel1decreaseSweep&&0==(c&8)&&a.channel1Swept&&(a.channel1SweepFault=!0),a.channel1lastTimeSweep=(c&112)>>4,a.channel1frequencySweepDivider=c&7,a.channel1decreaseSweep=8==(c&8),a.memory[65296]=c,a.channel1EnableCheck())};this.memoryHighWriter[17]=this.memoryWriter[65297]=function(a,b,c){if(a.soundMasterEnabled||!a.cGBC)a.soundMasterEnabled?a.audioJIT():c&=63,a.channel1CachedDuty=a.dutyLookup[c>>6],a.channel1totalLength=
64-(c&63),a.memory[65297]=c,a.channel1EnableCheck()};this.memoryHighWriter[18]=this.memoryWriter[65298]=function(a,b,c){a.soundMasterEnabled&&(a.audioJIT(),a.channel1Enabled&&0==a.channel1envelopeSweeps&&(8==((a.memory[65298]^c)&8)?(0==(a.memory[65298]&8)&&(7==(a.memory[65298]&7)?a.channel1envelopeVolume+=2:++a.channel1envelopeVolume),a.channel1envelopeVolume=16-a.channel1envelopeVolume&15):8==(a.memory[65298]&15)&&(a.channel1envelopeVolume=1+a.channel1envelopeVolume&15),a.channel1OutputLevelCache()),
a.channel1envelopeType=8==(c&8),a.memory[65298]=c,a.channel1VolumeEnableCheck())};this.memoryHighWriter[19]=this.memoryWriter[65299]=function(a,b,c){a.soundMasterEnabled&&(a.audioJIT(),a.channel1frequency=a.channel1frequency&1792|c,a.channel1FrequencyTracker=2048-a.channel1frequency<<2)};this.memoryHighWriter[20]=this.memoryWriter[65300]=function(a,b,c){a.soundMasterEnabled&&(a.audioJIT(),a.channel1consecutive=0==(c&64),a.channel1frequency=(c&7)<<8|a.channel1frequency&255,a.channel1FrequencyTracker=
2048-a.channel1frequency<<2,127<c&&(a.channel1timeSweep=a.channel1lastTimeSweep,a.channel1Swept=!1,b=a.memory[65298],a.channel1envelopeVolume=b>>4,a.channel1OutputLevelCache(),a.channel1envelopeSweepsLast=(b&7)-1,0==a.channel1totalLength&&(a.channel1totalLength=64),a.memory[65318]=0<a.channel1lastTimeSweep||0<a.channel1frequencySweepDivider?a.memory[65318]|1:a.memory[65318]&254,64==(c&64)&&(a.memory[65318]|=1),a.channel1ShadowFrequency=a.channel1frequency,a.channel1SweepFault=!1,a.channel1AudioSweepPerformDummy()),
a.channel1EnableCheck(),a.memory[65300]=c)};this.memoryHighWriter[21]=this.memoryWriter[65301]=this.cartIgnoreWrite;this.memoryHighWriter[22]=this.memoryWriter[65302]=function(a,b,c){if(a.soundMasterEnabled||!a.cGBC)a.soundMasterEnabled?a.audioJIT():c&=63,a.channel2CachedDuty=a.dutyLookup[c>>6],a.channel2totalLength=64-(c&63),a.memory[65302]=c,a.channel2EnableCheck()};this.memoryHighWriter[23]=this.memoryWriter[65303]=function(a,b,c){a.soundMasterEnabled&&(a.audioJIT(),a.channel2Enabled&&0==a.channel2envelopeSweeps&&
(8==((a.memory[65303]^c)&8)?(0==(a.memory[65303]&8)&&(7==(a.memory[65303]&7)?a.channel2envelopeVolume+=2:++a.channel2envelopeVolume),a.channel2envelopeVolume=16-a.channel2envelopeVolume&15):8==(a.memory[65303]&15)&&(a.channel2envelopeVolume=1+a.channel2envelopeVolume&15),a.channel2OutputLevelCache()),a.channel2envelopeType=8==(c&8),a.memory[65303]=c,a.channel2VolumeEnableCheck())};this.memoryHighWriter[24]=this.memoryWriter[65304]=function(a,b,c){a.soundMasterEnabled&&(a.audioJIT(),a.channel2frequency=
a.channel2frequency&1792|c,a.channel2FrequencyTracker=2048-a.channel2frequency<<2)};this.memoryHighWriter[25]=this.memoryWriter[65305]=function(a,b,c){a.soundMasterEnabled&&(a.audioJIT(),127<c&&(b=a.memory[65303],a.channel2envelopeVolume=b>>4,a.channel2OutputLevelCache(),a.channel2envelopeSweepsLast=(b&7)-1,0==a.channel2totalLength&&(a.channel2totalLength=64),64==(c&64)&&(a.memory[65318]|=2)),a.channel2consecutive=0==(c&64),a.channel2frequency=(c&7)<<8|a.channel2frequency&255,a.channel2FrequencyTracker=
2048-a.channel2frequency<<2,a.memory[65305]=c,a.channel2EnableCheck())};this.memoryHighWriter[26]=this.memoryWriter[65306]=function(a,b,c){a.soundMasterEnabled&&(a.audioJIT(),!a.channel3canPlay&&128<=c&&(a.channel3lastSampleLookup=0,a.channel3UpdateCache()),a.channel3canPlay=127<c,a.channel3canPlay&&(127<a.memory[65306]&&!a.channel3consecutive)&&(a.memory[65318]|=4),a.memory[65306]=c)};this.memoryHighWriter[27]=this.memoryWriter[65307]=function(a,b,c){if(a.soundMasterEnabled||!a.cGBC)a.soundMasterEnabled&&
a.audioJIT(),a.channel3totalLength=256-c,a.channel3EnableCheck()};this.memoryHighWriter[28]=this.memoryWriter[65308]=function(a,b,c){a.soundMasterEnabled&&(a.audioJIT(),c&=96,a.memory[65308]=c,a.channel3patternType=0==c?4:(c>>5)-1)};this.memoryHighWriter[29]=this.memoryWriter[65309]=function(a,b,c){a.soundMasterEnabled&&(a.audioJIT(),a.channel3frequency=a.channel3frequency&1792|c,a.channel3FrequencyPeriod=2048-a.channel3frequency<<1)};this.memoryHighWriter[30]=this.memoryWriter[65310]=function(a,
b,c){a.soundMasterEnabled&&(a.audioJIT(),127<c&&(0==a.channel3totalLength&&(a.channel3totalLength=256),a.channel3lastSampleLookup=0,64==(c&64)&&(a.memory[65318]|=4)),a.channel3consecutive=0==(c&64),a.channel3frequency=(c&7)<<8|a.channel3frequency&255,a.channel3FrequencyPeriod=2048-a.channel3frequency<<1,a.memory[65310]=c,a.channel3EnableCheck())};this.memoryHighWriter[31]=this.memoryWriter[65311]=this.cartIgnoreWrite;this.memoryHighWriter[32]=this.memoryWriter[65312]=function(a,b,c){if(a.soundMasterEnabled||
!a.cGBC)a.soundMasterEnabled&&a.audioJIT(),a.channel4totalLength=64-(c&63),a.channel4EnableCheck()};this.memoryHighWriter[33]=this.memoryWriter[65313]=function(a,b,c){a.soundMasterEnabled&&(a.audioJIT(),a.channel4Enabled&&0==a.channel4envelopeSweeps&&(8==((a.memory[65313]^c)&8)?(0==(a.memory[65313]&8)&&(7==(a.memory[65313]&7)?a.channel4envelopeVolume+=2:++a.channel4envelopeVolume),a.channel4envelopeVolume=16-a.channel4envelopeVolume&15):8==(a.memory[65313]&15)&&(a.channel4envelopeVolume=1+a.channel4envelopeVolume&
15),a.channel4currentVolume=a.channel4envelopeVolume<<a.channel4VolumeShifter),a.channel4envelopeType=8==(c&8),a.memory[65313]=c,a.channel4UpdateCache(),a.channel4VolumeEnableCheck())};this.memoryHighWriter[34]=this.memoryWriter[65314]=function(a,b,c){if(a.soundMasterEnabled){a.audioJIT();a.channel4FrequencyPeriod=Math.max((c&7)<<4,8)<<(c>>4);b=c&8;if(8==b&&32767==a.channel4BitRange||0==b&&127==a.channel4BitRange)a.channel4lastSampleLookup=0,a.channel4BitRange=8==b?127:32767,a.channel4VolumeShifter=
8==b?7:15,a.channel4currentVolume=a.channel4envelopeVolume<<a.channel4VolumeShifter,a.noiseSampleTable=8==b?a.LSFR7Table:a.LSFR15Table;a.memory[65314]=c;a.channel4UpdateCache()}};this.memoryHighWriter[35]=this.memoryWriter[65315]=function(a,b,c){a.soundMasterEnabled&&(a.audioJIT(),a.memory[65315]=c,a.channel4consecutive=0==(c&64),127<c&&(b=a.memory[65313],a.channel4envelopeVolume=b>>4,a.channel4currentVolume=a.channel4envelopeVolume<<a.channel4VolumeShifter,a.channel4envelopeSweepsLast=(b&7)-1,0==
a.channel4totalLength&&(a.channel4totalLength=64),64==(c&64)&&(a.memory[65318]|=8)),a.channel4EnableCheck())};this.memoryHighWriter[36]=this.memoryWriter[65316]=function(a,b,c){a.soundMasterEnabled&&a.memory[65316]!=c&&(a.audioJIT(),a.memory[65316]=c,a.VinLeftChannelMasterVolume=(c>>4&7)+1,a.VinRightChannelMasterVolume=(c&7)+1,a.mixerOutputLevelCache())};this.memoryHighWriter[37]=this.memoryWriter[65317]=function(a,b,c){a.soundMasterEnabled&&a.memory[65317]!=c&&(a.audioJIT(),a.memory[65317]=c,a.rightChannel1=
1==(c&1),a.rightChannel2=2==(c&2),a.rightChannel3=4==(c&4),a.rightChannel4=8==(c&8),a.leftChannel1=16==(c&16),a.leftChannel2=32==(c&32),a.leftChannel3=64==(c&64),a.leftChannel4=127<c,a.channel1OutputLevelCache(),a.channel2OutputLevelCache(),a.channel3OutputLevelCache(),a.channel4OutputLevelCache())};this.memoryHighWriter[38]=this.memoryWriter[65318]=function(a,b,c){a.audioJIT();if(!a.soundMasterEnabled&&127<c)a.memory[65318]=128,a.soundMasterEnabled=!0,a.initializeAudioStartState();else if(a.soundMasterEnabled&&
128>c){a.memory[65318]=0;a.soundMasterEnabled=!1;for(b=65296;65318>b;b++)a.memoryWriter[b](a,b,0)}};this.memoryHighWriter[39]=this.memoryWriter[65319]=this.cartIgnoreWrite;this.memoryHighWriter[40]=this.memoryWriter[65320]=this.cartIgnoreWrite;this.memoryHighWriter[41]=this.memoryWriter[65321]=this.cartIgnoreWrite;this.memoryHighWriter[42]=this.memoryWriter[65322]=this.cartIgnoreWrite;this.memoryHighWriter[43]=this.memoryWriter[65323]=this.cartIgnoreWrite;this.memoryHighWriter[44]=this.memoryWriter[65324]=
this.cartIgnoreWrite;this.memoryHighWriter[45]=this.memoryWriter[65325]=this.cartIgnoreWrite;this.memoryHighWriter[46]=this.memoryWriter[65326]=this.cartIgnoreWrite;this.memoryHighWriter[47]=this.memoryWriter[65327]=this.cartIgnoreWrite;this.memoryHighWriter[48]=this.memoryWriter[65328]=function(a,b,c){a.channel3WriteRAM(0,c)};this.memoryHighWriter[49]=this.memoryWriter[65329]=function(a,b,c){a.channel3WriteRAM(1,c)};this.memoryHighWriter[50]=this.memoryWriter[65330]=function(a,b,c){a.channel3WriteRAM(2,
c)};this.memoryHighWriter[51]=this.memoryWriter[65331]=function(a,b,c){a.channel3WriteRAM(3,c)};this.memoryHighWriter[52]=this.memoryWriter[65332]=function(a,b,c){a.channel3WriteRAM(4,c)};this.memoryHighWriter[53]=this.memoryWriter[65333]=function(a,b,c){a.channel3WriteRAM(5,c)};this.memoryHighWriter[54]=this.memoryWriter[65334]=function(a,b,c){a.channel3WriteRAM(6,c)};this.memoryHighWriter[55]=this.memoryWriter[65335]=function(a,b,c){a.channel3WriteRAM(7,c)};this.memoryHighWriter[56]=this.memoryWriter[65336]=
function(a,b,c){a.channel3WriteRAM(8,c)};this.memoryHighWriter[57]=this.memoryWriter[65337]=function(a,b,c){a.channel3WriteRAM(9,c)};this.memoryHighWriter[58]=this.memoryWriter[65338]=function(a,b,c){a.channel3WriteRAM(10,c)};this.memoryHighWriter[59]=this.memoryWriter[65339]=function(a,b,c){a.channel3WriteRAM(11,c)};this.memoryHighWriter[60]=this.memoryWriter[65340]=function(a,b,c){a.channel3WriteRAM(12,c)};this.memoryHighWriter[61]=this.memoryWriter[65341]=function(a,b,c){a.channel3WriteRAM(13,
c)};this.memoryHighWriter[62]=this.memoryWriter[65342]=function(a,b,c){a.channel3WriteRAM(14,c)};this.memoryHighWriter[63]=this.memoryWriter[65343]=function(a,b,c){a.channel3WriteRAM(15,c)};this.memoryHighWriter[66]=this.memoryWriter[65346]=function(a,b,c){a.backgroundY!=c&&(a.midScanLineJIT(),a.backgroundY=c)};this.memoryHighWriter[67]=this.memoryWriter[65347]=function(a,b,c){a.backgroundX!=c&&(a.midScanLineJIT(),a.backgroundX=c)};this.memoryHighWriter[68]=this.memoryWriter[65348]=function(a){a.LCDisOn&&
(a.modeSTAT=2,a.midScanlineOffset=-1,a.totalLinesPassed=a.currentX=a.queuedScanLines=a.lastUnrenderedLine=a.LCDTicks=a.STATTracker=a.actualScanLine=a.memory[65348]=0)};this.memoryHighWriter[69]=this.memoryWriter[65349]=function(a,b,c){a.memory[65349]!=c&&(a.memory[65349]=c,a.LCDisOn&&a.matchLYC())};this.memoryHighWriter[74]=this.memoryWriter[65354]=function(a,b,c){a.windowY!=c&&(a.midScanLineJIT(),a.windowY=c)};this.memoryHighWriter[75]=this.memoryWriter[65355]=function(a,b,c){a.memory[65355]!=c&&
(a.midScanLineJIT(),a.memory[65355]=c,a.windowX=c-7)};this.memoryHighWriter[114]=this.memoryWriter[65394]=function(a,b,c){a.memory[65394]=c};this.memoryHighWriter[115]=this.memoryWriter[65395]=function(a,b,c){a.memory[65395]=c};this.memoryHighWriter[117]=this.memoryWriter[65397]=function(a,b,c){a.memory[65397]=c};this.memoryHighWriter[118]=this.memoryWriter[65398]=this.cartIgnoreWrite;this.memoryHighWriter[119]=this.memoryWriter[65399]=this.cartIgnoreWrite;this.memoryHighWriter[255]=this.memoryWriter[65535]=
function(a,b,c){a.interruptsEnabled=c;a.checkIRQMatching()};this.recompileModelSpecificIOWriteHandling();this.recompileBootIOWriteHandling()};
GameBoyCore.prototype.recompileModelSpecificIOWriteHandling=function(){this.cGBC?(this.memoryHighWriter[2]=this.memoryWriter[65282]=function(a,b,c){1==(c&1)?(a.memory[65282]=c&127,a.serialTimer=0==(c&2)?4096:128,a.serialShiftTimer=a.serialShiftTimerAllocated=0==(c&2)?512:16):(a.memory[65282]=c,a.serialShiftTimer=a.serialShiftTimerAllocated=a.serialTimer=0)},this.memoryHighWriter[64]=this.memoryWriter[65344]=function(a,b,c){a.memory[65344]!=c&&(a.midScanLineJIT(),b=127<c,b!=a.LCDisOn&&(a.LCDisOn=b,
a.memory[65345]&=120,a.midScanlineOffset=-1,a.totalLinesPassed=a.currentX=a.queuedScanLines=a.lastUnrenderedLine=a.STATTracker=a.LCDTicks=a.actualScanLine=a.memory[65348]=0,a.LCDisOn?(a.modeSTAT=2,a.matchLYC(),a.LCDCONTROL=a.LINECONTROL):(a.modeSTAT=0,a.LCDCONTROL=a.DISPLAYOFFCONTROL,a.DisplayShowOff()),a.interruptsRequested&=253),a.gfxWindowCHRBankPosition=64==(c&64)?1024:0,a.gfxWindowDisplay=32==(c&32),a.gfxBackgroundBankOffset=16==(c&16)?0:128,a.gfxBackgroundCHRBankPosition=8==(c&8)?1024:0,a.gfxSpriteNormalHeight=
0==(c&4),a.gfxSpriteShow=2==(c&2),a.BGPriorityEnabled=1==(c&1),a.priorityFlaggingPathRebuild(),a.memory[65344]=c)},this.memoryHighWriter[65]=this.memoryWriter[65345]=function(a,b,c){a.LYCMatchTriggerSTAT=64==(c&64);a.mode2TriggerSTAT=32==(c&32);a.mode1TriggerSTAT=16==(c&16);a.mode0TriggerSTAT=8==(c&8);a.memory[65345]=c&120},this.memoryHighWriter[70]=this.memoryWriter[65350]=function(a,b,c){a.memory[65350]=c;if(224>c){var c=c<<8,b=65024,e=a.modeSTAT,f=a.modeSTAT=0;do if(f=a.memoryReader[c](a,c++),
f!=a.memory[b]){a.modeSTAT=e;a.graphicsJIT();a.modeSTAT=0;a.memory[b++]=f;break}while(65184>++b);if(65184>b){do a.memory[b++]=a.memoryReader[c](a,c++),a.memory[b++]=a.memoryReader[c](a,c++),a.memory[b++]=a.memoryReader[c](a,c++),a.memory[b++]=a.memoryReader[c](a,c++);while(65184>b)}a.modeSTAT=e}},this.memoryHighWriter[77]=this.memoryWriter[65357]=function(a,b,c){a.memory[65357]=c&127|a.memory[65357]&128},this.memoryHighWriter[79]=this.memoryWriter[65359]=function(a,b,c){a.currVRAMBank=c&1;a.BGCHRCurrentBank=
0<a.currVRAMBank?a.BGCHRBank2:a.BGCHRBank1},this.memoryHighWriter[81]=this.memoryWriter[65361]=function(a,b,c){a.hdmaRunning||(a.memory[65361]=c)},this.memoryHighWriter[82]=this.memoryWriter[65362]=function(a,b,c){a.hdmaRunning||(a.memory[65362]=c&240)},this.memoryHighWriter[83]=this.memoryWriter[65363]=function(a,b,c){a.hdmaRunning||(a.memory[65363]=c&31)},this.memoryHighWriter[84]=this.memoryWriter[65364]=function(a,b,c){a.hdmaRunning||(a.memory[65364]=c&240)},this.memoryHighWriter[85]=this.memoryWriter[65365]=
function(a,b,c){a.hdmaRunning?0==(c&128)?(a.hdmaRunning=!1,a.memory[65365]|=128):a.memory[65365]=c&127:0==(c&128)?(a.DMAWrite((c&127)+1),a.memory[65365]=255):(a.hdmaRunning=!0,a.memory[65365]=c&127)},this.memoryHighWriter[104]=this.memoryWriter[65384]=function(a,b,c){a.memory[65385]=a.gbcBGRawPalette[c&63];a.memory[65384]=c},this.memoryHighWriter[105]=this.memoryWriter[65385]=function(a,b,c){a.updateGBCBGPalette(a.memory[65384]&63,c);127<a.memory[65384]?(b=a.memory[65384]+1&63,a.memory[65384]=b|128,
a.memory[65385]=a.gbcBGRawPalette[b]):a.memory[65385]=c},this.memoryHighWriter[106]=this.memoryWriter[65386]=function(a,b,c){a.memory[65387]=a.gbcOBJRawPalette[c&63];a.memory[65386]=c},this.memoryHighWriter[107]=this.memoryWriter[65387]=function(a,b,c){a.updateGBCOBJPalette(a.memory[65386]&63,c);127<a.memory[65386]?(b=a.memory[65386]+1&63,a.memory[65386]=b|128,a.memory[65387]=a.gbcOBJRawPalette[b]):a.memory[65387]=c},this.memoryHighWriter[112]=this.memoryWriter[65392]=function(a,b,c){b=a.memory[65361]<<
8|a.memory[65362];if(!a.hdmaRunning||53248>b||57344<=b)a.gbcRamBank=Math.max(c&7,1),a.gbcRamBankPosition=(a.gbcRamBank-1<<12)-53248,a.gbcRamBankPositionECHO=a.gbcRamBankPosition-8192;a.memory[65392]=c},this.memoryHighWriter[116]=this.memoryWriter[65396]=function(a,b,c){a.memory[65396]=c}):(this.memoryHighWriter[2]=this.memoryWriter[65282]=function(a,b,c){1==(c&1)?(a.memory[65282]=c&127,a.serialTimer=4096,a.serialShiftTimer=a.serialShiftTimerAllocated=512):(a.memory[65282]=c,a.serialShiftTimer=a.serialShiftTimerAllocated=
a.serialTimer=0)},this.memoryHighWriter[64]=this.memoryWriter[65344]=function(a,b,c){a.memory[65344]!=c&&(a.midScanLineJIT(),b=127<c,b!=a.LCDisOn&&(a.LCDisOn=b,a.memory[65345]&=120,a.midScanlineOffset=-1,a.totalLinesPassed=a.currentX=a.queuedScanLines=a.lastUnrenderedLine=a.STATTracker=a.LCDTicks=a.actualScanLine=a.memory[65348]=0,a.LCDisOn?(a.modeSTAT=2,a.matchLYC(),a.LCDCONTROL=a.LINECONTROL):(a.modeSTAT=0,a.LCDCONTROL=a.DISPLAYOFFCONTROL,a.DisplayShowOff()),a.interruptsRequested&=253),a.gfxWindowCHRBankPosition=
64==(c&64)?1024:0,a.gfxWindowDisplay=32==(c&32),a.gfxBackgroundBankOffset=16==(c&16)?0:128,a.gfxBackgroundCHRBankPosition=8==(c&8)?1024:0,a.gfxSpriteNormalHeight=0==(c&4),a.gfxSpriteShow=2==(c&2),a.bgEnabled=1==(c&1),a.memory[65344]=c)},this.memoryHighWriter[65]=this.memoryWriter[65345]=function(a,b,c){a.LYCMatchTriggerSTAT=64==(c&64);a.mode2TriggerSTAT=32==(c&32);a.mode1TriggerSTAT=16==(c&16);a.mode0TriggerSTAT=8==(c&8);a.memory[65345]=c&120;if((!a.usedBootROM||!a.usedGBCBootROM)&&a.LCDisOn&&2>a.modeSTAT)a.interruptsRequested|=
2,a.checkIRQMatching()},this.memoryHighWriter[70]=this.memoryWriter[65350]=function(a,b,c){a.memory[65350]=c;if(127<c&&224>c){var c=c<<8,b=65024,e=a.modeSTAT,f=a.modeSTAT=0;do if(f=a.memoryReader[c](a,c++),f!=a.memory[b]){a.modeSTAT=e;a.graphicsJIT();a.modeSTAT=0;a.memory[b++]=f;break}while(65184>++b);if(65184>b){do a.memory[b++]=a.memoryReader[c](a,c++),a.memory[b++]=a.memoryReader[c](a,c++),a.memory[b++]=a.memoryReader[c](a,c++),a.memory[b++]=a.memoryReader[c](a,c++);while(65184>b)}a.modeSTAT=e}},
this.memoryHighWriter[71]=this.memoryWriter[65351]=function(a,b,c){a.memory[65351]!=c&&(a.midScanLineJIT(),a.updateGBBGPalette(c),a.memory[65351]=c)},this.memoryHighWriter[72]=this.memoryWriter[65352]=function(a,b,c){a.memory[65352]!=c&&(a.midScanLineJIT(),a.updateGBOBJPalette(0,c),a.memory[65352]=c)},this.memoryHighWriter[73]=this.memoryWriter[65353]=function(a,b,c){a.memory[65353]!=c&&(a.midScanLineJIT(),a.updateGBOBJPalette(4,c),a.memory[65353]=c)},this.memoryHighWriter[77]=this.memoryWriter[65357]=
function(a,b,c){a.memory[65357]=c},this.memoryHighWriter[79]=this.memoryWriter[65359]=this.cartIgnoreWrite,this.memoryHighWriter[85]=this.memoryWriter[65365]=this.cartIgnoreWrite,this.memoryHighWriter[104]=this.memoryWriter[65384]=this.cartIgnoreWrite,this.memoryHighWriter[105]=this.memoryWriter[65385]=this.cartIgnoreWrite,this.memoryHighWriter[106]=this.memoryWriter[65386]=this.cartIgnoreWrite,this.memoryHighWriter[107]=this.memoryWriter[65387]=this.cartIgnoreWrite,this.memoryHighWriter[108]=this.memoryWriter[65388]=
this.cartIgnoreWrite,this.memoryHighWriter[112]=this.memoryWriter[65392]=this.cartIgnoreWrite,this.memoryHighWriter[116]=this.memoryWriter[65396]=this.cartIgnoreWrite)};
GameBoyCore.prototype.recompileBootIOWriteHandling=function(){this.inBootstrap?(this.memoryHighWriter[80]=this.memoryWriter[65360]=function(a,b,c){cout("Boot ROM reads blocked: Bootstrap process has ended.",0);a.inBootstrap=!1;a.disableBootROM();a.memory[65360]=c},this.cGBC&&(this.memoryHighWriter[108]=this.memoryWriter[65388]=function(a,b,c){a.inBootstrap&&(a.cGBC=0==(c&1),"Game and Watch 50"==a.name+a.gameCode+a.ROM[323]&&(a.cGBC=!0,cout("Created a boot exception for Game and Watch Gallery 2 (GBC ID byte is wrong on the cartridge).",
1)),cout("Booted to GBC Mode: "+a.cGBC,0));a.memory[65388]=c})):this.memoryHighWriter[80]=this.memoryWriter[65360]=this.cartIgnoreWrite};
GameBoyCore.prototype.toTypedArray=function(a,b){try{if(settings[5])return a;if(!a||!a.length)return[];var c=a.length;switch(b){case "uint8":var e=new Uint8Array(c);break;case "int8":e=new Int8Array(c);break;case "int32":e=new Int32Array(c);break;case "float32":e=new Float32Array(c)}for(var f=0;f<c;f++)e[f]=a[f];return e}catch(h){return cout("Could not convert an array to a typed array: "+h.message,1),a}};
GameBoyCore.prototype.fromTypedArray=function(a){try{if(!a||!a.length)return[];for(var b=[],c=0;c<a.length;++c)b[c]=a[c];return b}catch(e){return cout("Conversion from a typed array failed: "+e.message,1),a}};
GameBoyCore.prototype.getTypedArray=function(a,b,c){try{if(settings[5])throw Error("Settings forced typed arrays to be disabled.");switch(c){case "int8":var e=new Int8Array(a);break;case "uint8":e=new Uint8Array(a);break;case "int32":e=new Int32Array(a);break;case "float32":e=new Float32Array(a)}if(0!=b)for(c=0;c<a;)e[c++]=b}catch(f){cout("Could not convert an array to a typed array: "+f.message,1);e=[];for(c=0;c<a;)e[c++]=b}return e};var gameboy=null,gbRunInterval=null,settings=[!0,!0,!1,1,!0,!1,4,15,30,!1,!1,!1,!1,!0];function start(a,b){clearLastEmulation();autoSave();gameboy=new GameBoyCore(a,b);gameboy.openMBC=openSRAM;gameboy.openRTC=openRTC;gameboy.start();run()}
function run(){GameBoyEmulatorInitialized()?GameBoyEmulatorPlaying()?cout("The GameBoy core is already running.",1):(gameboy.stopEmulator&=1,cout("Starting the iterator.",0),gameboy.firstIteration=(new Date).getTime(),gameboy.iterations=0,gbRunInterval=setInterval(function(){!document.hidden&&(!document.msHidden&&!document.mozHidden&&!document.webkitHidden)&&gameboy.run()},settings[6])):cout("GameBoy core cannot run while it has not been initialized.",1)}
function pause(){GameBoyEmulatorInitialized()?GameBoyEmulatorPlaying()?clearLastEmulation():cout("GameBoy core has already been paused.",1):cout("GameBoy core cannot be paused while it has not been initialized.",1)}function clearLastEmulation(){GameBoyEmulatorInitialized()&&GameBoyEmulatorPlaying()?(clearInterval(gbRunInterval),gameboy.stopEmulator|=2,cout("The previous emulation has been cleared.",0)):cout("No previous emulation was found to be cleared.",0)}
function save(){if(GameBoyEmulatorInitialized())try{for(var a=0;null!=findValue("FREEZE_"+gameboy.name+"_"+a);)a++;setValue("FREEZE_"+gameboy.name+"_"+a,gameboy.saveState());cout("Saved the current state as: FREEZE_"+gameboy.name+"_"+a,0)}catch(b){cout('Could not save the current emulation state("'+b.message+'").',2)}else cout("GameBoy core cannot be saved while it has not been initialized.",1)}
function saveSRAM(){if(GameBoyEmulatorInitialized()){if(gameboy.cBATT)try{var a=gameboy.saveSRAMState();0<a.length?(cout("Saving the SRAM...",0),null!=findValue("SRAM_"+gameboy.name)&&(cout("Deleting the old SRAM save due to outdated format.",0),deleteValue("SRAM_"+gameboy.name)),setValue("B64_SRAM_"+gameboy.name,arrayToBase64(a))):cout("SRAM could not be saved because it was empty.",1)}catch(b){cout('Could not save the current emulation state("'+b.message+'").',2)}else cout("Cannot save a game that does not have battery backed SRAM specified.",
1);saveRTC()}else cout("GameBoy core cannot be saved while it has not been initialized.",1)}function saveRTC(){if(GameBoyEmulatorInitialized()){if(gameboy.cTIMER)try{cout("Saving the RTC...",0),setValue("RTC_"+gameboy.name,gameboy.saveRTCState())}catch(a){cout('Could not save the RTC of the current emulation state("'+a.message+'").',2)}}else cout("GameBoy core cannot be saved while it has not been initialized.",1)}
function autoSave(){GameBoyEmulatorInitialized()&&(cout("Automatically saving the SRAM.",0),saveSRAM(),saveRTC())}
function openSRAM(a){try{if(null!=findValue("B64_SRAM_"+a))return cout("Found a previous SRAM state (Will attempt to load).",0),base64ToArray(findValue("B64_SRAM_"+a));if(null!=findValue("SRAM_"+a))return cout("Found a previous SRAM state (Will attempt to load).",0),findValue("SRAM_"+a);cout("Could not find any previous SRAM copy for the current ROM.",0)}catch(b){cout("Could not open the  SRAM of the saved emulation state.",2)}return[]}
function openRTC(a){try{if(null!=findValue("RTC_"+a))return cout("Found a previous RTC state (Will attempt to load).",0),findValue("RTC_"+a);cout("Could not find any previous RTC copy for the current ROM.",0)}catch(b){cout("Could not open the RTC data of the saved emulation state.",2)}return[]}
function openState(a,b){try{if(null!=findValue(a))try{clearLastEmulation(),cout("Attempting to run a saved emulation state.",0),gameboy=new GameBoyCore(b,""),gameboy.savedStateFileName=a,gameboy.returnFromState(findValue(a)),run()}catch(c){alert(c.message+" file: "+c.fileName+" line: "+c.lineNumber)}else cout("Could not find the save state "+a+'".',2)}catch(e){cout("Could not open the saved emulation state.",2)}}
function import_save(a){if((a=decodeBlob(a))&&a.blobs)if(0<a.blobs.length)for(var b=0;b<a.blobs.length;++b)cout('Importing blob "'+a.blobs[b].blobID+'"',0),a.blobs[b].blobContent?"SRAM_"==a.blobs[b].blobID.substring(0,5)?setValue("B64_"+a.blobs[b].blobID,base64(a.blobs[b].blobContent)):setValue(a.blobs[b].blobID,JSON.parse(a.blobs[b].blobContent)):a.blobs[b].blobID?cout('Save file imported had blob "'+a.blobs[b].blobID+'" with no blob data interpretable.',2):cout("Blob chunk information missing completely.",
2);else cout("Could not decode the imported file.",2);else cout("Could not decode the imported file.",2)}function generateBlob(a,b){var c="EMULATOR_DATA",c=c+to_little_endian_dword(c.length+4+8+(1+a.length+(4+b.length))),c=c+to_byte(7),c=c+"GameBoy"+to_byte(a.length),c=c+a,c=c+to_little_endian_dword(b.length);return c+=b}
function generateMultiBlob(a){for(var b=25,c=to_byte(7),c=c+"GameBoy",e="",f="",h=0;h<a.length;++h)e=a[h][0],f=a[h][1],c+=to_byte(e.length),c+=e,c+=to_little_endian_dword(f.length),c+=f,b+=1+e.length+4+f.length;return c="EMULATOR_DATA"+to_little_endian_dword(b)+c}
function decodeBlob(a){var b=a.length,c={consoleID:null},e=-1;c.blobs=[];if(17<b&&"EMULATOR_DATA"==a.substring(0,13)){var b=Math.min((a.charCodeAt(16)&255)<<24|(a.charCodeAt(15)&255)<<16|(a.charCodeAt(14)&255)<<8|a.charCodeAt(13)&255,b),f=a.charCodeAt(17)&255;if(b>17+f){c.consoleID=a.substring(18,18+f);for(var h=0,h=0,f=18+f;f<b;)if(h=a.charCodeAt(f++)&255,f+h<b)if(c.blobs[++e]={},c.blobs[e].blobID=a.substring(f,f+h),f+=h,f+4<b)if(h=(a.charCodeAt(f+3)&255)<<24|(a.charCodeAt(f+2)&255)<<16|(a.charCodeAt(f+
1)&255)<<8|a.charCodeAt(f)&255,f+=4,f+h<=b)c.blobs[e].blobContent=a.substring(f,f+h),f+=h;else{cout("Blob length check failed, blob determined to be incomplete.",2);break}else{cout("Blob was incomplete, bailing out.",2);break}else{cout("Blob was incomplete, bailing out.",2);break}}}return c}function matchKey(a){for(var b="right left up down a b select start".split(" "),c=0;c<b.length;c++)if(b[c]==a)return c;return-1}
function GameBoyEmulatorInitialized(){return"object"==typeof gameboy&&null!=gameboy}function GameBoyEmulatorPlaying(){return 0==(gameboy.stopEmulator&2)}function GameBoyKeyDown(a){GameBoyEmulatorInitialized()&&GameBoyEmulatorPlaying()&&(a=matchKey(a),0<=a&&8>a&&gameboy.JoyPadEvent(a,!0))}function GameBoyKeyUp(a){GameBoyEmulatorInitialized()&&GameBoyEmulatorPlaying()&&(a=matchKey(a),0<=a&&8>a&&gameboy.JoyPadEvent(a,!1))}
function GameBoyGyroSignalHandler(a){if(GameBoyEmulatorInitialized()&&GameBoyEmulatorPlaying()){a.gamma||a.beta?gameboy.GyroEvent(a.gamma*Math.PI/180,a.beta*Math.PI/180):gameboy.GyroEvent(a.x,a.y);try{a.preventDefault()}catch(b){}}}function initNewCanvas(){GameBoyEmulatorInitialized()&&(gameboy.canvas.width=gameboy.canvas.clientWidth,gameboy.canvas.height=gameboy.canvas.clientHeight)}
function initNewCanvasSize(){GameBoyEmulatorInitialized()&&(settings[12]?(gameboy.onscreenWidth!=gameboy.canvas.clientWidth||gameboy.onscreenHeight!=gameboy.canvas.clientHeight)&&gameboy.initLCD():(160!=gameboy.onscreenWidth||144!=gameboy.onscreenHeight)&&gameboy.initLCD())};
